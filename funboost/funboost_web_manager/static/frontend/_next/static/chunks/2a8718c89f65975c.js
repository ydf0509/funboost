(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,75254,e=>{"use strict";var t=e.i(71645);let r=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},s=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,t.forwardRef)(({color:e="currentColor",size:r=24,strokeWidth:l=2,absoluteStrokeWidth:n,className:i="",children:c,iconNode:o,...d},h)=>(0,t.createElement)("svg",{ref:h,...a,width:r,height:r,stroke:e,strokeWidth:n?24*Number(l)/Number(r):l,className:s("lucide",i),...!c&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(d)&&{"aria-hidden":"true"},...d},[...o.map(([e,r])=>(0,t.createElement)(e,r)),...Array.isArray(c)?c:[c]])),n=(e,a)=>{let n=(0,t.forwardRef)(({className:n,...i},c)=>(0,t.createElement)(l,{ref:c,iconNode:a,className:s(`lucide-${r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,n),...i}));return n.displayName=r(e),n};e.s(["default",()=>n],75254)},18566,(e,t,r)=>{t.exports=e.r(76562)},7670,e=>{"use strict";e.s(["default",0,function(){for(var e,t,r=0,s="",a=arguments.length;r<a;r++)(e=arguments[r])&&(t=function e(t){var r,s,a="";if("string"==typeof t||"number"==typeof t)a+=t;else if("object"==typeof t)if(Array.isArray(t)){var l=t.length;for(r=0;r<l;r++)t[r]&&(s=e(t[r]))&&(a&&(a+=" "),a+=s)}else for(s in t)t[s]&&(a&&(a+=" "),a+=s);return a}(e))&&(s&&(s+=" "),s+=t);return s}])},59544,e=>{"use strict";var t=e.i(43476),r=e.i(7670);let s={primary:"bg-[hsl(var(--accent))] text-white hover:bg-[hsl(var(--accent-2))]",secondary:"bg-[hsl(var(--accent-2))] text-white hover:bg-[hsl(var(--accent))]",outline:"border border-[hsl(var(--line))] text-[hsl(var(--ink))] hover:border-[hsl(var(--accent))] hover:text-[hsl(var(--accent))]",ghost:"text-[hsl(var(--ink))] hover:bg-[hsl(var(--sand-2))]",danger:"bg-[hsl(var(--danger))] text-white hover:bg-[hsl(var(--danger))]/90"},a={sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-5 py-2.5 text-sm"};function l({variant:e="primary",size:l="md",className:n,...i}){return(0,t.jsx)("button",{className:(0,r.default)("inline-flex items-center justify-center gap-2 rounded-full font-medium transition-colors duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--accent))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--sand))]",s[e],a[l],n),...i})}e.s(["Button",()=>l])},55600,e=>{"use strict";function t(e,t){let r=e.startsWith("/")?e:`/${e}`;window.location.port,t?.replace?window.location.replace(r):window.location.href=r}e.s(["navigateTo",()=>t])},3812,e=>{"use strict";var t=e.i(43476),r=e.i(7670);function s({className:e,...s}){return(0,t.jsx)("input",{className:(0,r.default)("w-full rounded-2xl border border-[hsl(var(--line))] bg-[hsl(var(--card))]/80 px-4 py-2 text-sm text-[hsl(var(--ink))] shadow-sm outline-none transition placeholder:text-[hsl(var(--ink-muted))] focus:border-[hsl(var(--accent))] focus:ring-2 focus:ring-[hsl(var(--accent))]/20",e),...s})}e.s(["Input",()=>s])},86536,e=>{"use strict";let t=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],86536)},34252,e=>{"use strict";var t=e.i(47167);let r=t.default.env.NEXT_PUBLIC_API_BASE??"",s=new Set(["localhost","127.0.0.1","::1"]);function a(){let e;if("true"===new URLSearchParams(window.location.search).get("allow_insecure")||"true"===t.default.env.NEXT_PUBLIC_ALLOW_INSECURE_PASSWORD)return{ok:!0,warning:"已开启不安全密码传输，仅用于内网环境。"};let a=window.location.origin,l=r?new URL(r,a):new URL(a),n=(e=l.hostname,s.has(e)),i="https:"===l.protocol;return/^(192\.168\.|10\.|172\.(1[6-9]|2[0-9]|3[01])\.)/.test(l.hostname)?{ok:!0,warning:"当前为内网环境，密码将以明文提交。"}:window.isSecureContext||n?i||n?!i&&n?{ok:!0,warning:"当前为本地开发环境，密码将以明文提交，请勿用于生产环境。"}:{ok:!0}:{ok:!1,message:"检测到后端为非 HTTPS，已阻止提交。请启用 HTTPS。"}:{ok:!1,message:"当前页面不是安全上下文，已阻止提交。请使用 HTTPS 访问前端。"}}e.s(["ensureSecurePasswordTransport",()=>a])},63209,e=>{"use strict";let t=(0,e.i(75254).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],63209)},95468,e=>{"use strict";let t=(0,e.i(75254).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],95468)},3809,e=>{"use strict";let t=e.i(47167).default.env.NEXT_PUBLIC_API_BASE??"",r=null,s=0;async function a(){let e=Date.now();if(r&&e-s<18e5)return r;try{let a=await fetch(`${t}/api/public_key`,{method:"GET",credentials:"include"});if(!a.ok)throw Error(`获取公钥失败: ${a.status}`);let l=await a.json();if(!l.public_key||!l.key_id)throw Error("公钥响应格式无效");return r=l,s=e,l}catch(e){throw r=null,s=0,e}}function l(){r=null,s=0}async function n(e){let t=e.replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","");t=t.replace(/\s/g,"");let r=Uint8Array.from(atob(t),e=>e.charCodeAt(0));return await crypto.subtle.importKey("spki",r,{name:"RSA-OAEP",hash:"SHA-256"},!1,["encrypt"])}async function i(e,t){let r=await n(t),s=new TextEncoder().encode(e),a=new Uint8Array(await crypto.subtle.encrypt({name:"RSA-OAEP"},r,s)),l="";for(let e=0;e<a.length;e++)l+=String.fromCharCode(a[e]);return btoa(l)}function c(){return"undefined"!=typeof crypto&&void 0!==crypto.subtle&&"function"==typeof crypto.subtle.encrypt}async function o(e){if(!c())return console.warn("Web Crypto API 不可用，将使用明文密码"),e;try{l();let t=await a(),r=await i(e,t.public_key);return{encrypted:!0,data:r,key_id:t.key_id}}catch(e){throw console.error("密码加密失败:",e),Error("密码加密失败，请刷新页面重试")}}async function d(e){if(!c())return console.warn("Web Crypto API 不可用，将使用明文密码"),e;try{l();let t=await a(),r={};for(let[s,a]of Object.entries(e)){let e=await i(a,t.public_key);r[s]={encrypted:!0,data:e,key_id:t.key_id}}return r}catch(e){throw console.error("密码加密失败:",e),Error("密码加密失败，请刷新页面重试")}}e.s(["preparePassword",()=>o,"preparePasswords",()=>d])},77705,e=>{"use strict";let t=(0,e.i(75254).default)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);e.s(["EyeOff",()=>t],77705)},83033,e=>{"use strict";var t=e.i(47167),r=e.i(43476),s=e.i(71645),a=e.i(18566),l=e.i(86536),n=e.i(77705),i=e.i(95468),c=e.i(63209),o=e.i(59544),d=e.i(3812),h=e.i(34252),u=e.i(3809),x=e.i(55600);function p(){let e=(0,a.useSearchParams)().get("token")||"",[p,m]=(0,s.useState)(""),[f,v]=(0,s.useState)(""),[y,g]=(0,s.useState)(!1),[w,b]=(0,s.useState)(!1),[k,j]=(0,s.useState)(null),[N,C]=(0,s.useState)(null),[E,A]=(0,s.useState)(null),[S,P]=(0,s.useState)(!1),_=(e=>{if(!e)return{score:0,text:"",color:""};let t=0;return e.length>=8&&t++,e.length>=12&&t++,/[a-z]/.test(e)&&t++,/[A-Z]/.test(e)&&t++,/[0-9]/.test(e)&&t++,/[^a-zA-Z0-9]/.test(e)&&t++,[{score:0,text:"",color:""},{score:1,text:"弱",color:"text-[hsl(var(--danger))]"},{score:2,text:"中等",color:"text-[hsl(var(--warning))]"},{score:3,text:"强",color:"text-[hsl(var(--success))]"},{score:4,text:"很强",color:"text-[hsl(var(--success))]"},{score:5,text:"非常强",color:"text-[hsl(var(--success))]"}][Math.min(t,5)]})(p);if(!e)return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-1 text-center",children:[(0,r.jsx)("h2",{className:"font-display text-lg font-semibold text-[hsl(var(--ink))]",children:"重置密码"}),(0,r.jsx)("p",{className:"text-xs text-[hsl(var(--ink-muted))]",children:"无效的重置链接"})]}),(0,r.jsx)("div",{className:"rounded-lg border border-[hsl(var(--danger))]/30 bg-[hsl(var(--danger))]/10 px-3 py-2",children:(0,r.jsx)("p",{className:"text-xs text-[hsl(var(--danger))]",children:"重置链接无效或已过期，请重新申请密码重置。"})}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("a",{className:"text-xs font-semibold text-[hsl(var(--accent-2))] hover:text-[hsl(var(--accent))]",href:"/forgot-password",children:"重新申请"})})]});let T=async r=>{if(r.preventDefault(),j(null),C(null),A(null),p!==f)return void C("两次输入的密码不一致。");if(p.length<8)return void C("密码长度至少 8 个字符。");P(!0);try{let r,s=(0,h.ensureSecurePasswordTransport)();if(!s.ok){C(s.message??"密码传输不安全。"),P(!1);return}s.warning&&A(s.warning);try{r=await (0,u.preparePasswords)({new_password:p,confirm_password:f})}catch(e){C(e instanceof Error?e.message:"密码加密失败"),P(!1);return}let a=await fetch(`${t.default.env.NEXT_PUBLIC_API_BASE??""}/reset_password/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),credentials:"include"}),l=await a.json();a.ok&&l.success?(j(l.message||"密码已更新，请重新登录。"),setTimeout(()=>(0,x.navigateTo)("/login"),1500)):C(l.error||"重置失败，请稍后重试。")}catch(e){C(e instanceof Error?e.message:"重置失败。")}finally{P(!1)}};return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-1 text-center",children:[(0,r.jsx)("h2",{className:"font-display text-lg font-semibold text-[hsl(var(--ink))]",children:"设置新密码"}),(0,r.jsx)("p",{className:"text-xs text-[hsl(var(--ink-muted))]",children:"请输入一个强密码来保护你的账户"})]}),(0,r.jsxs)("form",{className:"space-y-3",onSubmit:T,children:[(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)("label",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:"新密码"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(d.Input,{type:y?"text":"password",value:p,onChange:e=>m(e.target.value),placeholder:"输入新密码",required:!0,className:"pr-10"}),(0,r.jsx)("button",{type:"button",onClick:()=>g(!y),className:"absolute right-3 top-1/2 -translate-y-1/2 text-[hsl(var(--ink-muted))] hover:text-[hsl(var(--ink))] transition-colors cursor-pointer",children:y?(0,r.jsx)(n.EyeOff,{className:"h-4 w-4"}):(0,r.jsx)(l.Eye,{className:"h-4 w-4"})})]}),p&&(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs px-1",children:[(0,r.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:"强度："}),(0,r.jsx)("span",{className:_.color,children:_.text})]})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)("label",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:"确认新密码"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(d.Input,{type:w?"text":"password",value:f,onChange:e=>v(e.target.value),placeholder:"再次输入密码",required:!0,className:"pr-10"}),(0,r.jsx)("button",{type:"button",onClick:()=>b(!w),className:"absolute right-3 top-1/2 -translate-y-1/2 text-[hsl(var(--ink-muted))] hover:text-[hsl(var(--ink))] transition-colors cursor-pointer",children:w?(0,r.jsx)(n.EyeOff,{className:"h-4 w-4"}):(0,r.jsx)(l.Eye,{className:"h-4 w-4"})})]}),p&&f&&p===f&&(0,r.jsxs)("div",{className:"flex items-center gap-1 text-xs text-[hsl(var(--success))] px-1",children:[(0,r.jsx)(i.CheckCircle2,{className:"h-3 w-3"}),"密码匹配"]})]}),E&&(0,r.jsxs)("div",{className:"rounded-lg border border-[hsl(var(--warning))]/30 bg-[hsl(var(--warning))]/10 px-3 py-2 flex gap-2",children:[(0,r.jsx)(c.AlertCircle,{className:"h-4 w-4 text-[hsl(var(--warning))] flex-shrink-0 mt-0.5"}),(0,r.jsx)("p",{className:"text-xs text-[hsl(var(--warning))]",children:E})]}),k&&(0,r.jsxs)("div",{className:"rounded-lg border border-[hsl(var(--success))]/30 bg-[hsl(var(--success))]/10 px-3 py-2 flex gap-2",children:[(0,r.jsx)(i.CheckCircle2,{className:"h-4 w-4 text-[hsl(var(--success))] flex-shrink-0 mt-0.5"}),(0,r.jsx)("p",{className:"text-xs text-[hsl(var(--success))]",children:k})]}),N&&(0,r.jsxs)("div",{className:"rounded-lg border border-[hsl(var(--danger))]/30 bg-[hsl(var(--danger))]/10 px-3 py-2 flex gap-2",children:[(0,r.jsx)(c.AlertCircle,{className:"h-4 w-4 text-[hsl(var(--danger))] flex-shrink-0 mt-0.5"}),(0,r.jsx)("p",{className:"text-xs text-[hsl(var(--danger))]",children:N})]}),(0,r.jsx)(o.Button,{type:"submit",className:"w-full",disabled:S||!p||!f,children:S?"正在更新...":"更新密码"})]}),(0,r.jsx)("div",{className:"text-center text-xs text-[hsl(var(--ink-muted))]",children:(0,r.jsx)("a",{className:"font-semibold text-[hsl(var(--accent-2))] hover:text-[hsl(var(--accent))] transition-colors",href:"/login",children:"返回登录"})})]})}function m(){return(0,r.jsx)(s.Suspense,{fallback:(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsxs)("div",{className:"space-y-1 text-center",children:[(0,r.jsx)("h2",{className:"font-display text-lg font-semibold text-[hsl(var(--ink))]",children:"设置新密码"}),(0,r.jsx)("p",{className:"text-xs text-[hsl(var(--ink-muted))]",children:"正在加载..."})]})}),children:(0,r.jsx)(p,{})})}e.s(["default",()=>m])}]);