(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,37539,e=>{"use strict";var s=e.i(43476),a=e.i(71645),t=e.i(62162),n=e.i(39964),r=e.i(9165),l=e.i(96640),i=e.i(59544),c=e.i(32098),d=e.i(16703);let o="redis",u={running:"è¿è¡Œä¸­",paused:"å·²æš‚åœ"},m={running:"è°ƒåº¦ä¸­",paused:"å·²æš‚åœ",stopped:"å·²åœæ­¢",unknown:"æœªçŸ¥"},h={weeks:"å‘¨",days:"å¤©",hours:"å°æ—¶",minutes:"åˆ†é’Ÿ",seconds:"ç§’",year:"å¹´",month:"æœˆ",day:"æ—¥",day_of_week:"æ˜ŸæœŸ",hour:"å°æ—¶",minute:"åˆ†é’Ÿ",second:"ç§’"},x={queue_name:"",job_id:"",kwargs:"{}",triggerType:"interval",run_date:"",interval:{weeks:"0",days:"0",hours:"0",minutes:"0",seconds:"0"},cron:{year:"",month:"",day:"",day_of_week:"",hour:"",minute:"",second:""},replace_existing:!0};function p({job:e,funcName:a,onClose:t}){return(0,s.jsx)(c.Modal,{open:!!e,title:"ä»»åŠ¡è¯¦æƒ…",onClose:t,footer:(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)(i.Button,{onClick:t,children:"å…³é—­"})}),children:e&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs uppercase text-[hsl(var(--ink-muted))]",children:"Job ID"}),(0,s.jsx)("div",{className:"font-mono text-sm",children:e.job_id})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs uppercase text-[hsl(var(--ink-muted))]",children:"Queue"}),(0,s.jsx)("div",{className:"font-mono text-sm",children:e.queue_name})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs uppercase text-[hsl(var(--ink-muted))]",children:"Trigger"}),(0,s.jsx)("div",{className:"font-mono text-sm",children:e.trigger})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs uppercase text-[hsl(var(--ink-muted))]",children:"Next Run"}),(0,s.jsx)("div",{className:"font-mono text-sm",children:e.next_run_time||"-"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs uppercase text-[hsl(var(--ink-muted))]",children:"Status"}),(0,s.jsx)(l.Badge,{tone:"running"===e.status?"success":"warning",children:u[e.status]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs uppercase text-[hsl(var(--ink-muted))]",children:"Wait Time"}),(0,s.jsx)("div",{className:"font-mono text-sm",children:"-"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"mb-1 text-xs uppercase text-[hsl(var(--ink-muted))]",children:"Function Name"}),(0,s.jsx)("div",{className:"rounded bg-[hsl(var(--sand))] p-2 text-sm font-mono",children:a})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"mb-1 text-xs uppercase text-[hsl(var(--ink-muted))]",children:"Arguments (kwargs)"}),(0,s.jsx)(d.TextArea,{readOnly:!0,value:JSON.stringify(e.kwargs,null,2),className:"h-32 text-xs font-mono"})]})]})})}var g=e.i(3116),j=e.i(52571),v=e.i(95242),f=e.i(31343),b=e.i(7233),y=e.i(16715),N=e.i(27612),_=e.i(3812),k=e.i(67073);let w=[{value:5,label:"5ç§’"},{value:10,label:"10ç§’"},{value:30,label:"30ç§’"},{value:60,label:"60ç§’"}];function C({queueOptions:e,queueFilter:a,statusFilter:t,search:n,loading:r,autoRefresh:l,refreshInterval:c,canOperate:d=!0,allRunning:o=!1,batchLoading:u=!1,onQueueChange:m,onStatusChange:h,onSearchChange:x,onAdd:p,onRefresh:C,onToggleAutoRefresh:S,onRefreshIntervalChange:q,onDeleteAll:$,onShowHelp:T,onBatchToggle:B}){return(0,s.jsxs)("div",{className:"flex flex-row flex-wrap items-center justify-between gap-3 rounded-3xl border border-[hsl(var(--line))] bg-[hsl(var(--card))]/75 p-4 backdrop-blur-2xl",children:[(0,s.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,s.jsxs)(k.Select,{value:a,onChange:e=>m(e.target.value),className:"h-10 w-48 text-sm",children:[(0,s.jsx)("option",{value:"",children:"æ‰€æœ‰é˜Ÿåˆ—"}),e.map(e=>(0,s.jsxs)("option",{value:e.name,children:[e.name," (",e.count,"ä¸ª)"]},e.name))]}),(0,s.jsxs)(k.Select,{value:t,onChange:e=>h(e.target.value),className:"h-10 w-32 text-sm",children:[(0,s.jsx)("option",{value:"all",children:"æ‰€æœ‰çŠ¶æ€"}),(0,s.jsx)("option",{value:"running",children:"è¿è¡Œä¸­"}),(0,s.jsx)("option",{value:"paused",children:"å·²æš‚åœ"})]}),(0,s.jsx)(_.Input,{placeholder:"æœç´¢ä»»åŠ¡IDæˆ–é˜Ÿåˆ—å...",value:n,onChange:e=>x(e.target.value),className:"h-10 w-56 text-sm"})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsxs)(i.Button,{variant:"primary",size:"sm",onClick:p,className:"h-10 px-4",disabled:!d,children:[(0,s.jsx)(b.Plus,{className:"h-4 w-4"}),"æ·»åŠ ä»»åŠ¡"]}),B&&e.length>0&&(0,s.jsxs)(i.Button,{variant:o?"danger":"primary",size:"sm",onClick:B,className:`h-10 px-4 ${o?"bg-[hsl(var(--warning))] hover:bg-[hsl(var(--warning))]/90":"bg-[hsl(var(--success))] hover:bg-[hsl(var(--success))]/90"}`,disabled:!d||u,children:[u?(0,s.jsx)(y.RefreshCw,{className:"h-4 w-4 animate-spin"}):o?(0,s.jsx)(v.Pause,{className:"h-4 w-4"}):(0,s.jsx)(f.Play,{className:"h-4 w-4"}),o?"æš‚åœå…¨éƒ¨":"å¯åŠ¨å…¨éƒ¨"]}),(0,s.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:C,className:"h-10 px-4",disabled:r,children:[(0,s.jsx)(y.RefreshCw,{className:`h-4 w-4 ${r?"animate-spin":""}`}),"æ•°æ®åˆ·æ–°"]}),(0,s.jsxs)("div",{className:"flex items-center gap-1 rounded-full border border-[hsl(var(--line))] p-0.5",children:[(0,s.jsx)("span",{className:"px-2 text-xs text-[hsl(var(--ink-muted))]",children:"åˆ·æ–°é—´éš”:"}),w.map(e=>(0,s.jsx)("button",{onClick:()=>q(e.value),className:`px-2 py-1 text-xs rounded-full transition cursor-pointer ${c===e.value?"bg-[hsl(var(--accent))] text-white":"text-[hsl(var(--ink-muted))] hover:text-[hsl(var(--ink))]"}`,children:e.label},e.value))]}),(0,s.jsxs)(i.Button,{variant:l?"primary":"outline",size:"sm",onClick:S,className:"h-10 px-4",children:[(0,s.jsx)(g.Clock,{className:"h-4 w-4"}),l?"åˆ·æ–°ä¸­...":"å·²æš‚åœ"]}),(0,s.jsxs)(i.Button,{variant:"danger",size:"sm",onClick:$,className:"h-10 px-4",disabled:!d,children:[(0,s.jsx)(N.Trash2,{className:"h-4 w-4"}),"åˆ é™¤å…¨éƒ¨"]}),(0,s.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:T,className:"h-10 px-4",children:[(0,s.jsx)(j.Info,{className:"h-4 w-4"}),"è¯´æ˜"]})]})]})}var S=e.i(75254);let q=(0,S.default)("calendar-clock",[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]);var $=e.i(58472),T=e.i(52008);let B=(0,S.default)("timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);function O({open:e,editingJobId:a,form:t,availableQueues:n,funcParamsInfo:r,loadingParams:l,formError:o,onClose:u,onSubmit:m,onQueueChange:x,setForm:p}){return(0,s.jsx)(c.Modal,{open:e,title:a?`ç¼–è¾‘ä»»åŠ¡ ${a}`:"æ·»åŠ å®šæ—¶ä»»åŠ¡",onClose:u,size:"lg",footer:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(i.Button,{variant:"outline",onClick:u,children:"å–æ¶ˆ"}),(0,s.jsx)(i.Button,{onClick:m,children:a?"ä¿å­˜ä¿®æ”¹":"æ·»åŠ ä»»åŠ¡"})]}),children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:[(0,s.jsx)($.Code,{className:"mr-1 inline h-4 w-4"}),"é˜Ÿåˆ—åç§° *"]}),(0,s.jsxs)(k.Select,{value:t.queue_name,onChange:e=>x(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"-- è¯·é€‰æ‹©é˜Ÿåˆ— --"}),n.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:"ä»»åŠ¡ IDï¼ˆå¯é€‰ï¼Œç•™ç©ºè‡ªåŠ¨ç”Ÿæˆï¼‰"}),(0,s.jsx)(_.Input,{value:t.job_id,onChange:e=>p(s=>({...s,job_id:e.target.value})),placeholder:"è‡ªåŠ¨ç”ŸæˆUUID"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:[(0,s.jsx)($.Code,{className:"mr-1 inline h-4 w-4"}),"å‡½æ•°å‚æ•° (kwargs) (JSON æ ¼å¼)"]}),(0,s.jsx)(d.TextArea,{value:t.kwargs,onChange:e=>p(s=>({...s,kwargs:e.target.value})),className:"min-h-[160px] font-mono text-sm",placeholder:t.queue_name?"æ­£åœ¨åŠ è½½å‚æ•°æ¨¡æ¿...":"è¯·å…ˆé€‰æ‹©é˜Ÿåˆ—åç§°"}),o?(0,s.jsx)("div",{className:"text-xs text-[hsl(var(--danger))]",role:"alert",children:o}):null,l?(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs text-[hsl(var(--ink-muted))]",children:[(0,s.jsx)("span",{className:"inline-flex h-3 w-3 animate-spin rounded-full border-2 border-[hsl(var(--accent))] border-t-transparent"}),"æ­£åœ¨åŠ è½½å‡½æ•°å‚æ•°ä¿¡æ¯..."]}):r?(0,s.jsxs)("div",{className:"rounded-xl bg-[hsl(var(--sand))] p-4 text-sm",children:[(0,s.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[(0,s.jsx)(j.Info,{className:"h-4 w-4 text-[hsl(var(--accent-2))]"}),(0,s.jsxs)("span",{className:"font-semibold text-[hsl(var(--accent-2))]",children:["å‡½æ•°: ",r.func_name||"æœªçŸ¥"]})]}),r.must_arg_name_list&&r.must_arg_name_list.length>0&&(0,s.jsxs)("div",{className:"mb-1",children:[(0,s.jsx)("span",{className:"text-xs text-[hsl(var(--danger))]",children:"å¿…å¡«å‚æ•°: "}),r.must_arg_name_list.map(e=>(0,s.jsx)("code",{className:"mx-0.5 rounded bg-[hsl(var(--danger))]/10 px-1.5 py-0.5 text-xs text-[hsl(var(--danger))]",children:e},e))]}),r.optional_arg_name_list&&r.optional_arg_name_list.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-xs text-[hsl(var(--warning))]",children:"å¯é€‰å‚æ•°: "}),r.optional_arg_name_list.map(e=>(0,s.jsx)("code",{className:"mx-0.5 rounded bg-[hsl(var(--warning))]/10 px-1.5 py-0.5 text-xs text-[hsl(var(--warning))]",children:e},e))]}),(!r.must_arg_name_list||0===r.must_arg_name_list.length)&&(!r.optional_arg_name_list||0===r.optional_arg_name_list.length)&&(0,s.jsx)("span",{className:"text-xs text-[hsl(var(--success))]",children:"æ— å¿…å¡«å‚æ•°"})]}):t.queue_name?(0,s.jsx)("div",{className:"text-xs text-[hsl(var(--ink-muted))]",children:"æ— æ³•è·å–å‡½æ•°å‚æ•°ä¿¡æ¯"}):null]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("label",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:[(0,s.jsx)(q,{className:"mr-1 inline h-4 w-4"}),"è§¦å‘å™¨ç±»å‹ *"]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,s.jsxs)("label",{className:"flex cursor-pointer items-center gap-2",children:[(0,s.jsx)("input",{type:"radio",name:"triggerType",checked:"date"===t.triggerType,onChange:()=>p(e=>({...e,triggerType:"date"})),className:"h-4 w-4"}),(0,s.jsx)("span",{className:"text-sm",children:"ä¸€æ¬¡æ€§ä»»åŠ¡"})]}),(0,s.jsxs)("label",{className:"flex cursor-pointer items-center gap-2",children:[(0,s.jsx)("input",{type:"radio",name:"triggerType",checked:"interval"===t.triggerType,onChange:()=>p(e=>({...e,triggerType:"interval"})),className:"h-4 w-4"}),(0,s.jsx)("span",{className:"text-sm",children:"é—´éš”æ‰§è¡Œ"})]}),(0,s.jsxs)("label",{className:"flex cursor-pointer items-center gap-2",children:[(0,s.jsx)("input",{type:"radio",name:"triggerType",checked:"cron"===t.triggerType,onChange:()=>p(e=>({...e,triggerType:"cron"})),className:"h-4 w-4"}),(0,s.jsx)("span",{className:"text-sm",children:"å®šæ—¶æ‰§è¡Œ"})]})]})]}),"date"===t.triggerType&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:"æ‰§è¡Œæ—¶é—´"}),(0,s.jsx)(_.Input,{type:"datetime-local",value:t.run_date,onChange:e=>p(s=>({...s,run_date:e.target.value}))})]}),"interval"===t.triggerType&&(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("label",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:[(0,s.jsx)(B,{className:"mr-1 inline h-4 w-4"}),"é—´éš”æ‰§è¡Œé…ç½® ",(0,s.jsx)("span",{className:"font-normal text-[hsl(var(--ink-muted))]",children:"(è‡³å°‘å¡«å†™ä¸€ä¸ª)"})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-5",children:Object.entries(t.interval).map(([e,a])=>(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-xs text-[hsl(var(--ink-muted))]",children:h[e]}),(0,s.jsx)(_.Input,{type:"number",min:"0",value:a,onChange:s=>p(a=>({...a,interval:{...a.interval,[e]:s.target.value}}))})]},e))}),(0,s.jsx)("div",{className:"rounded-lg bg-[hsl(var(--sand))] p-3 text-xs text-[hsl(var(--ink-muted))]",children:"ç¤ºä¾‹: æ¯10åˆ†é’Ÿ â†’ åˆ†é’Ÿå¡« 10 | æ¯2å°æ—¶ â†’ å°æ—¶å¡« 2 | æ¯å¤© â†’ å¤©å¡« 1"})]}),"cron"===t.triggerType&&(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("label",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:"å®šæ—¶æ‰§è¡Œé…ç½® (Cron)"}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-4",children:Object.entries(t.cron).map(([e,a])=>(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-xs text-[hsl(var(--ink-muted))]",children:h[e]}),(0,s.jsx)(_.Input,{value:a,placeholder:"*",onChange:s=>p(a=>({...a,cron:{...a.cron,[e]:s.target.value}}))})]},e))})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("label",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:[(0,s.jsx)(T.Layers,{className:"mr-1 inline h-4 w-4"}),"å­˜å‚¨æ–¹å¼"]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,s.jsxs)("label",{className:"flex cursor-pointer items-center gap-2",children:[(0,s.jsx)("input",{type:"radio",checked:!0,readOnly:!0,className:"h-4 w-4"}),(0,s.jsx)("span",{className:"text-sm",children:"Redis (æ¨èï¼Œæ”¯æŒåˆ†å¸ƒå¼)"})]}),(0,s.jsxs)("label",{className:"flex cursor-not-allowed items-center gap-2 opacity-50",children:[(0,s.jsx)("input",{type:"radio",disabled:!0,className:"h-4 w-4"}),(0,s.jsx)("span",{className:"text-sm",children:"å†…å­˜ (å•æœºï¼Œé‡å¯ä¸¢å¤±)"})]})]})]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm text-[hsl(var(--ink-muted))]",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.replace_existing,onChange:e=>p(s=>({...s,replace_existing:e.target.checked})),className:"h-4 w-4 rounded border-[hsl(var(--line))]"}),"å¦‚æœä»»åŠ¡IDå·²å­˜åœ¨ï¼Œåˆ™æ›¿æ¢"]})]})})}var M=e.i(38171);function P({stats:e}){return(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 lg:grid-cols-3",children:[(0,s.jsx)(M.StatCard,{label:"é˜Ÿåˆ—æ•°",value:e.queues,helper:"æ€»æ•°",tone:"info"}),(0,s.jsx)(M.StatCard,{label:"å®šæ—¶è®¡åˆ’æ€»æ•°",value:e.total,helper:"ä»»åŠ¡",tone:"warning"}),(0,s.jsx)(M.StatCard,{label:"è¿è¡Œä¸­",value:e.running,helper:"æ´»è·ƒ",tone:"success"})]})}let E=(0,S.default)("book-open",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]),F=(0,S.default)("graduation-cap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]),I=(0,S.default)("circle-pause",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]),z=(0,S.default)("rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);var R=e.i(98919),A=e.i(70273);function J({title:e,icon:a,children:t}){return(0,s.jsxs)("div",{className:"rounded-2xl border border-[hsl(var(--line))] bg-[hsl(var(--card))]/75 p-4",children:[(0,s.jsxs)("div",{className:"mb-2 flex items-center gap-2 text-sm font-semibold text-[hsl(var(--ink))]",children:[(0,s.jsx)("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-xl bg-[hsl(var(--accent))]/15 text-[hsl(var(--accent))]",children:a}),e]}),(0,s.jsx)("div",{className:"space-y-2 text-sm text-[hsl(var(--ink-muted))]",children:t})]})}function D({open:e,onClose:a}){return(0,s.jsx)(c.Modal,{open:e,title:"å®šæ—¶ä»»åŠ¡ä½¿ç”¨è¯´æ˜",onClose:a,size:"lg",footer:(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)(i.Button,{onClick:a,children:"æˆ‘çŸ¥é“äº†"})}),children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)(J,{title:"ğŸ“š é‡è¦æç¤ºï¼šå…ˆå­¦ä¹  APSchedulerï¼",icon:(0,s.jsx)(F,{className:"h-4 w-4"}),children:[(0,s.jsx)("p",{children:(0,s.jsxs)("strong",{children:["Funboost çš„å®šæ—¶ä»»åŠ¡åŠŸèƒ½æ˜¯å¯¹ ",(0,s.jsx)("span",{className:"text-[hsl(var(--accent))]",children:"APScheduler"})," çš„è½»åº¦å°è£…ã€‚"]})}),(0,s.jsx)("p",{children:"APScheduler æ˜¯ Python ä¸­æœ€çŸ¥åçš„å®šæ—¶ä»»åŠ¡è°ƒåº¦åº“ï¼ŒFunboost åœ¨å…¶åŸºç¡€ä¸Šè¿›è¡Œäº†å¢å¼ºï¼Œæ”¯æŒåˆ†å¸ƒå¼åœºæ™¯å’Œæ¶ˆæ¯é˜Ÿåˆ—é›†æˆã€‚"}),(0,s.jsxs)("div",{className:"rounded-xl border border-[hsl(var(--line))] bg-[hsl(var(--sand))] p-3",children:[(0,s.jsxs)("div",{className:"mb-1 flex items-center gap-2 text-xs font-semibold text-[hsl(var(--ink))]",children:[(0,s.jsx)(E,{className:"h-4 w-4"}),"å­¦ä¹ èµ„æº"]}),(0,s.jsxs)("p",{className:"text-xs text-[hsl(var(--ink-muted))]",children:["ğŸ“– å®˜æ–¹æ–‡æ¡£ï¼š",(0,s.jsx)("a",{href:"https://apscheduler.readthedocs.io/",target:"_blank",rel:"noreferrer",className:"ml-1 text-[hsl(var(--info))]",children:"https://apscheduler.readthedocs.io/"})]})]})]}),(0,s.jsxs)(J,{title:"ä»€ä¹ˆæ˜¯ã€Œæš‚åœ Schedulerï¼ˆå®šæ—¶å™¨ï¼‰ã€ï¼Ÿ",icon:(0,s.jsx)(g.Clock,{className:"h-4 w-4"}),children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"text-[hsl(var(--accent))]",children:"Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰"})," æ˜¯ç®¡ç†å’Œè§¦å‘æ‰€æœ‰å®šæ—¶ä»»åŠ¡çš„æ ¸å¿ƒç»„ä»¶ã€‚"]}),(0,s.jsxs)("p",{children:["æš‚åœå®šæ—¶å™¨æ„å‘³ç€ï¼š",(0,s.jsx)("strong",{children:"è¯¥é˜Ÿåˆ—ä¸‹çš„æ‰€æœ‰å®šæ—¶ä»»åŠ¡æš‚åœè°ƒåº¦"}),"ï¼Œä½†ä»»åŠ¡é…ç½®ä¿ç•™ã€‚æ¢å¤åç»§ç»­æ‰§è¡Œã€‚"]})]}),(0,s.jsxs)(J,{title:"ä»€ä¹ˆæ˜¯ã€Œæš‚åœ Jobï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰ã€ï¼Ÿ",icon:(0,s.jsx)(I,{className:"h-4 w-4"}),children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"text-[hsl(var(--accent))]",children:"Jobï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰"})," æ˜¯å…·ä½“çš„ä¸€ä¸ªå®šæ—¶æ‰§è¡Œå•å…ƒã€‚"]}),(0,s.jsxs)("p",{children:["æš‚åœæŸä¸ª Job æ„å‘³ç€ï¼š",(0,s.jsx)("strong",{children:"ä»…è¯¥ä»»åŠ¡æš‚åœ"}),"ï¼Œå…¶ä»–ä»»åŠ¡ä¸å—å½±å“ï¼Œå¯éšæ—¶æ¢å¤ã€‚"]})]}),(0,s.jsxs)(J,{title:"æ¨èä½¿ç”¨æ–¹å¼",icon:(0,s.jsx)(A.Star,{className:"h-4 w-4"}),children:[(0,s.jsx)("p",{children:(0,s.jsx)("strong",{className:"text-[hsl(var(--success))]",children:"ğŸ’¡ æ¨èåœ¨ç½‘é¡µç®¡ç†åå°ä¿æŒå®šæ—¶å™¨ä¸ºã€Œæš‚åœã€çŠ¶æ€ï¼"})}),(0,s.jsxs)("p",{children:["ç½‘é¡µåå°çš„å®šä½æ˜¯ ",(0,s.jsx)("span",{className:"text-[hsl(var(--accent))]",children:"å®šæ—¶ä»»åŠ¡çš„ç®¡ç†å·¥å…·"}),"ï¼Œç”¨äºå¢åˆ æ”¹æŸ¥ã€‚"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"æ­£ç¡®åšæ³•ï¼š"}),"åœ¨æ‚¨çš„æ¶ˆè´¹è„šæœ¬ä¸­å¯åŠ¨ booster å’Œå®šæ—¶å™¨ï¼Œç½‘é¡µåå°ä¿æŒæš‚åœçŠ¶æ€ã€‚"]}),(0,s.jsxs)("div",{className:"rounded-xl border border-[hsl(var(--line))] bg-[hsl(var(--sand))] p-3",children:[(0,s.jsxs)("div",{className:"mb-1 flex items-center gap-2 text-xs font-semibold text-[hsl(var(--ink))]",children:[(0,s.jsx)(R.Shield,{className:"h-4 w-4"}),"ä¸ç”¨æ‹…å¿ƒé‡å¤æ‰§è¡Œï¼"]}),(0,s.jsxs)("p",{className:"text-xs text-[hsl(var(--ink-muted))]",children:["Funboost ä½¿ç”¨ ",(0,s.jsx)("span",{className:"rounded bg-[hsl(var(--line))] px-1",children:"Redis åˆ†å¸ƒå¼é”"}),"ï¼Œ å³ä½¿ 100 å°æœºå™¨éƒ¨ç½²ä¹Ÿä¸ä¼šé‡å¤æ‰§è¡Œä»»åŠ¡ï¼"]})]})]}),(0,s.jsxs)(J,{title:"è·¨é¡¹ç›®ç®¡ç† â€”â€” å®Œçˆ†ä¼ ç»Ÿæ–¹æ¡ˆï¼",icon:(0,s.jsx)(z,{className:"h-4 w-4"}),children:[(0,s.jsx)("p",{children:(0,s.jsx)("strong",{className:"text-[hsl(var(--accent-2))]",children:"ğŸš€ Funboost Web Manager å¯ä»¥ç®¡ç†ä»»ä½•é¡¹ç›®çš„å®šæ—¶ä»»åŠ¡ï¼"})}),(0,s.jsxs)("p",{children:["ç®¡ç†å®šæ—¶ä»»åŠ¡ ",(0,s.jsx)("strong",{children:"å®Œå…¨ä¸ä¾èµ–å¯¼å…¥ç”¨æˆ·çš„ä»»åŠ¡å‡½æ•°"}),"ï¼Œæ”¯æŒè·¨é¡¹ç›®ã€è·¨ä»“åº“ç»Ÿä¸€ç®¡ç†ã€‚"]})]})]})})}var U=e.i(7670),L=e.i(64659),H=e.i(92930);let W=(0,S.default)("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);var Q=e.i(40803);function V({page:e,totalPages:a,onChange:t}){if(a<=1)return null;let n=e=>{t(Math.min(Math.max(e,1),a))};return(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-end gap-2 px-4 py-3 text-xs text-[hsl(var(--ink-muted))]",children:[(0,s.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>n(1),disabled:1===e,children:"é¦–é¡µ"}),(0,s.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>n(e-1),disabled:1===e,children:"ä¸Šä¸€é¡µ"}),(0,s.jsxs)("span",{className:"rounded-full border border-[hsl(var(--line))] px-3 py-1 text-[hsl(var(--ink))]",children:[e," / ",a]}),(0,s.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>n(e+1),disabled:e===a,children:"ä¸‹ä¸€é¡µ"}),(0,s.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>n(a),disabled:e===a,children:"æœ«é¡µ"})]})}function K({jobsByQueue:e,loading:t,empty:r,schedulerStatusMap:c,canOperate:d=!0,page:o,totalPages:h,onPageChange:x,onShowDetail:p,onEdit:g,onJobAction:b,onSchedulerAction:_}){let k=(0,a.useMemo)(()=>Object.keys(e),[e]),[w,C]=(0,a.useState)({});(0,a.useEffect)(()=>{C(e=>{let s={...e};return k.forEach(e=>{e in s||(s[e]=!1)}),s})},[k]);let S=(e,s)=>{e.stopPropagation(),s()};return(0,s.jsxs)(n.Card,{className:"p-0",children:[(0,s.jsx)("div",{className:"overflow-x-auto",children:t&&r?(0,s.jsxs)("div",{className:"py-12 text-center text-sm text-[hsl(var(--ink-muted))]",children:[(0,s.jsx)(y.RefreshCw,{className:"mx-auto mb-2 h-8 w-8 animate-spin text-[hsl(var(--accent))]"}),"æ­£åœ¨åŠ è½½ä»»åŠ¡..."]}):r?(0,s.jsx)(Q.EmptyState,{title:"æš‚æ— å®šæ—¶ä»»åŠ¡",subtitle:"ç‚¹å‡»ä¸Šæ–¹æ·»åŠ æŒ‰é’®åˆ›å»ºæ–°çš„å®šæ—¶ä»»åŠ¡ã€‚"}):(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-[hsl(var(--sand-2))] text-left text-xs uppercase tracking-wider text-[hsl(var(--ink-muted))]",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 font-medium",children:"ä»»åŠ¡ID"}),(0,s.jsx)("th",{className:"px-4 py-3 font-medium",children:"è§¦å‘å™¨"}),(0,s.jsx)("th",{className:"px-4 py-3 font-medium",children:"ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´"}),(0,s.jsx)("th",{className:"px-4 py-3 font-medium",children:"çŠ¶æ€"}),(0,s.jsx)("th",{className:"px-4 py-3 text-right font-medium",children:"æ“ä½œ"})]})}),(0,s.jsx)("tbody",{children:k.map(t=>{let n=e[t]||[],r=w[t],o=c[t],h=o?.status||"unknown",x=o?.loading,k=o?.loading?"åŠ è½½ä¸­...":m[o?.status||"unknown"];return(0,s.jsxs)(a.Fragment,{children:[(0,s.jsx)("tr",{className:"cursor-pointer border-y border-[hsl(var(--line))] bg-[hsl(var(--sand))]",onClick:()=>{C(e=>({...e,[t]:!e[t]}))},children:(0,s.jsx)("td",{colSpan:5,className:"px-4 py-2",children:(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(L.ChevronDown,{className:(0,U.default)("h-4 w-4 transition-transform",r?"-rotate-90":"rotate-0")}),(0,s.jsx)(W,{className:"h-4 w-4 text-[hsl(var(--accent))]"}),(0,s.jsx)("span",{className:"font-semibold text-[hsl(var(--ink))]",children:t}),(0,s.jsxs)(l.Badge,{tone:"neutral",children:[n.length," ä¸ªä»»åŠ¡"]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsx)(l.Badge,{tone:o?"running"===o.status?"success":"paused"===o.status?"warning":"stopped"===o.status?"danger":"neutral":"neutral",children:k}),(0,s.jsx)(i.Button,{variant:"outline",size:"sm",onClick:e=>S(e,()=>_(t,"refresh")),children:(0,s.jsx)(y.RefreshCw,{className:(0,U.default)("h-3.5 w-3.5",o?.loading&&"animate-spin")})}),(0,s.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:e=>S(e,()=>_(t,"pause")),disabled:!("running"===h&&!x)||!d,children:[(0,s.jsx)(v.Pause,{className:"h-3.5 w-3.5"}),"æš‚åœ"]}),(0,s.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:e=>S(e,()=>_(t,"resume")),disabled:!(("paused"===h||"stopped"===h)&&!x)||!d,children:[(0,s.jsx)(f.Play,{className:"h-3.5 w-3.5"}),"æ¢å¤"]})]})]})})}),!r&&n.map(e=>(0,s.jsxs)("tr",{className:"border-b border-[hsl(var(--line))] last:border-0 hover:bg-[hsl(var(--sand-2))]/50",children:[(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsx)("code",{className:"rounded bg-[hsl(var(--accent))]/10 px-2 py-1 text-xs text-[hsl(var(--accent-2))]",children:e.job_id})}),(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e.trigger.startsWith("interval")?(0,s.jsx)(l.Badge,{tone:"warning",children:"é—´éš”"}):e.trigger.startsWith("cron")?(0,s.jsx)(l.Badge,{tone:"info",children:"å®šæ—¶"}):(0,s.jsx)(l.Badge,{tone:"neutral",children:"ä¸€æ¬¡æ€§"}),(0,s.jsx)("span",{className:"text-xs text-[hsl(var(--ink-muted))]",children:e.trigger})]})}),(0,s.jsx)("td",{className:"px-4 py-3 text-xs text-[hsl(var(--ink))]",children:e.next_run_time||"-"}),(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsx)(l.Badge,{tone:"running"===e.status?"success":"warning",children:u[e.status]})}),(0,s.jsx)("td",{className:"px-4 py-3 text-right",children:(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[(0,s.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>p(e),children:[(0,s.jsx)(j.Info,{className:"h-3.5 w-3.5"}),"è¯¦æƒ…"]}),(0,s.jsxs)(i.Button,{variant:"secondary",size:"sm",onClick:()=>g(e),disabled:!d,children:[(0,s.jsx)(H.Edit2,{className:"h-3.5 w-3.5"}),"ç¼–è¾‘"]}),(0,s.jsx)(i.Button,{variant:"outline",size:"sm",className:"running"===e.status?"border-[hsl(var(--warning))] text-[hsl(var(--warning))] hover:border-[hsl(var(--warning))]":"border-[hsl(var(--success))] text-[hsl(var(--success))] hover:border-[hsl(var(--success))]",onClick:()=>b(e,"running"===e.status?"pause":"resume"),disabled:!d,children:"running"===e.status?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.Pause,{className:"h-3.5 w-3.5"}),"æš‚åœ"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.Play,{className:"h-3.5 w-3.5"}),"æ¢å¤"]})}),(0,s.jsxs)(i.Button,{variant:"danger",size:"sm",onClick:()=>b(e,"delete"),disabled:!d,children:[(0,s.jsx)(N.Trash2,{className:"h-3.5 w-3.5"}),"åˆ é™¤"]})]})})]},e.job_id))]},t)})})]})}),(0,s.jsx)(V,{page:o,totalPages:h,onChange:x})]})}let G=(e="")=>({...x,queue_name:e}),X=e=>{let s=e.trim();return 0===s.length?"{}":s};var Y=e.i(84030),Z=e.i(68402),ee=e.i(80580);function es(){let[e,l]=(0,a.useState)([]),[i,c]=(0,a.useState)([]),[d,u]=(0,a.useState)(""),[m,h]=(0,a.useState)("all"),[g,j]=(0,a.useState)(""),[v,f]=(0,a.useState)(null),[b,y]=(0,a.useState)(!1),[N,_]=(0,a.useState)(1),[k,w]=(0,a.useState)(!1),[S,q]=(0,a.useState)(G()),[$,T]=(0,a.useState)(null),[B,M]=(0,a.useState)(null),[E,F]=(0,a.useState)(null),[I,z]=(0,a.useState)(!1),[R,A]=(0,a.useState)(null),[J,U]=(0,a.useState)(""),[L,H]=(0,a.useState)(!1),[W,Q]=(0,a.useState)({}),[V,es]=(0,a.useState)(!1),{currentProject:ea,careProjectName:et}=(0,ee.useProject)(),{canExecute:en}=(0,Y.useActionPermissions)("queue"),er=ea?.permission_level??"admin",el=!ea||"write"===er||"admin"===er,ei=en&&el,ec=(0,a.useCallback)(()=>!!ei||(f({type:"warning",message:"å½“å‰é¡¹ç›®æ— å†™æƒé™ï¼Œæ— æ³•æ‰§è¡Œå®šæ—¶ä»»åŠ¡æ“ä½œã€‚"}),!1),[ei]),ed=(0,a.useCallback)(async e=>{Q(s=>({...s,[e]:{status:s[e]?.status??"unknown",loading:!0}}));try{var s;let a=await (0,r.funboostFetch)(`/funboost/get_scheduler_status?queue_name=${encodeURIComponent(e)}&job_store_kind=${o}`),t=(s=a?.status_str,"running"===s||"paused"===s||"stopped"===s?s:"unknown");Q(s=>({...s,[e]:{status:t,loading:!1}}))}catch{Q(s=>({...s,[e]:{status:"unknown",loading:!1}}))}},[]),eo=(0,a.useCallback)(async e=>{await Promise.all(e.map(e=>ed(e)))},[ed]),eu=(0,a.useCallback)(async()=>{y(!0);try{let e=await (0,r.funboostFetch)(`/funboost/get_timing_jobs?job_store_kind=${o}`),s=[...Object.entries(e.jobs_by_queue||{}).flatMap(([e,s])=>s.map(s=>({...s,queue_name:e})))].sort((e,s)=>e.queue_name!==s.queue_name?e.queue_name.localeCompare(s.queue_name):e.job_id.localeCompare(s.job_id));l(s);let a=Object.keys(e.jobs_by_queue||{}).sort();a.length>0&&eo(a)}catch(e){f({type:"error",message:e instanceof Error?e.message:"åŠ è½½ä»»åŠ¡å¤±è´¥ã€‚"})}finally{y(!1)}},[eo]),em=(0,a.useCallback)(()=>{f(null),eu()},[eu]),eh=(0,a.useCallback)(async()=>{try{let e="/queue/params_and_active_consumers";ea?.id&&(e+=`?project_id=${ea.id}`);let s=await (0,r.apiFetch)(e),a=Object.keys(s).sort();c(a)}catch(e){console.error("Failed to load queues:",e)}},[ea?.id,et]);(0,a.useEffect)(()=>{eu(),eh()},[eu,eh]);let{enabled:ex,toggle:ep,intervalMs:eg,setIntervalMs:ej}=(0,Z.useAutoRefresh)(eu,!1,3e4);(0,a.useEffect)(()=>{_(1)},[d,m,g]);let ev=(0,a.useCallback)(async e=>{if(!e)return void F(null);z(!0);try{let s=await (0,r.funboostFetch)(`/funboost/get_one_queue_config?queue_name=${encodeURIComponent(e)}`),a=s?.auto_generate_info?.final_func_input_params_info||null;F(a),a&&q(e=>{let s=X(e.kwargs);if("{}"!==s)return e;let t={};return((a.must_arg_name_list||[]).forEach(e=>{t[e]=""}),(a.optional_arg_name_list||[]).forEach(e=>{t[e]=""}),0===Object.keys(t).length)?e:{...e,kwargs:JSON.stringify(t,null,2)}})}catch(e){console.error("Failed to load func params:",e),F(null)}finally{z(!1)}},[]),ef=(0,a.useMemo)(()=>{let s=e.reduce((e,s)=>(e[s.queue_name]=(e[s.queue_name]||0)+1,e),{});return Object.keys(s).sort().map(e=>({name:e,count:s[e]}))},[e]),eb=(0,a.useMemo)(()=>{let s=g.trim();return e.filter(e=>(!d||e.queue_name===d)&&("all"===m||e.status===m)&&(!s||!!e.job_id.includes(s)||!!e.queue_name.includes(s)))},[e,d,m,g]),ey=Math.max(1,Math.ceil(eb.length/50));(0,a.useEffect)(()=>{N>ey&&_(ey)},[N,ey]);let eN=(0,a.useMemo)(()=>{let e=(N-1)*50;return eb.slice(e,e+50)},[eb,N]),e_=(0,a.useMemo)(()=>{let e={};return eN.forEach(s=>{e[s.queue_name]||(e[s.queue_name]=[]),e[s.queue_name].push(s)}),e},[eN]),ek=(0,a.useMemo)(()=>{let s=e.filter(e=>"running"===e.status).length;return{queues:ef.length,total:e.length,running:s}},[e,ef]),ew=(0,a.useMemo)(()=>{let e=ef.map(e=>e.name);return 0!==e.length&&e.every(e=>W[e]?.status==="running")},[ef,W]),eC=async()=>{if(!ec())return;let e=ef.map(e=>e.name);if(0===e.length)return;let s=ew?"æš‚åœ":"å¯åŠ¨";if(confirm(`ç¡®å®šè¦${s}å…¨éƒ¨ ${e.length} ä¸ªé˜Ÿåˆ—çš„è°ƒåº¦å™¨å—ï¼Ÿ`)){es(!0);try{let a=ew?"pause_scheduler":"resume_scheduler",t=await Promise.allSettled(e.map(e=>(0,r.funboostFetch)(`/funboost/${a}?queue_name=${encodeURIComponent(e)}&job_store_kind=${o}`,{method:"POST"}))),n=t.filter(e=>"fulfilled"===e.status).length,l=t.filter(e=>"rejected"===e.status).length;l>0?f({type:"warning",message:`${s}å®Œæˆï¼šæˆåŠŸ ${n} ä¸ªï¼Œå¤±è´¥ ${l} ä¸ªã€‚`}):f({type:"success",message:`å·²${s}å…¨éƒ¨ ${n} ä¸ªé˜Ÿåˆ—çš„è°ƒåº¦å™¨ã€‚`}),eo(e),eu()}catch(e){f({type:"error",message:e instanceof Error?e.message:`${s}å¤±è´¥ã€‚`})}finally{es(!1)}}},eS=e=>{if(ec()){if(T(null),e){var s;let a,t;M(e),q((a=(s=e.trigger||"").startsWith("cron")?"cron":s.startsWith("interval")?"interval":"date",t={...x,queue_name:e.queue_name,job_id:e.job_id,kwargs:JSON.stringify(e.kwargs||{},null,2),triggerType:a,replace_existing:!0},"interval"===a&&(t.interval=((e,s)=>{let a,t=e.match(/interval\[(.*)\]/);if(!t)return{...s};let n=t[1],r={...s},l=!1,i=/(weeks|days|hours|minutes|seconds)\s*=\s*([^,]+)/g;for(;a=i.exec(n);){l=!0;let e=a[1],s=a[2].replace(/['"]/g,"").trim();s&&(r[e]=s)}if(!l){let e=n.match(/(\d+)\s*week/),s=n.match(/(\d+)\s*day/),a=n.match(/(\d+):(\d+):(\d+)/);e&&(r.weeks=e[1]),s&&(r.days=s[1]),a&&(r.hours=a[1],r.minutes=a[2],r.seconds=a[3])}return r})(e.trigger,t.interval)),"cron"===a&&(t.cron=((e,s)=>{let a,t=e.match(/cron\[(.*)\]/);if(!t)return{...s};let n=t[1],r={...s},l=/(\w+)\s*=\s*([^,]+)/g;for(;a=l.exec(n);){let e=a[1],s=a[2].replace(/['"]/g,"").trim();e in r&&s&&(r[e]=s)}return r})(e.trigger,t.cron)),t)),ev(e.queue_name),w(!0);return}M(null),q(G(d||"")),F(null),d&&ev(d),w(!0)}},eq=()=>{w(!1),M(null),T(null)},e$=async e=>{A(e),U("åŠ è½½ä¸­...");try{let s=await (0,r.funboostFetch)(`/funboost/get_one_queue_config?queue_name=${encodeURIComponent(e.queue_name)}`),a=s?.auto_generate_info?.final_func_input_params_info?.func_name||"-";U(a)}catch{U("-")}},eT=async(e,s)=>{if(ec()&&confirm("pause"===s?`ç¡®å®šè¦æš‚åœä»»åŠ¡ ${e.job_id} å—ï¼Ÿ`:"resume"===s?`ç¡®å®šè¦æ¢å¤ä»»åŠ¡ ${e.job_id} å—ï¼Ÿ`:`ç¡®å®šè¦åˆ é™¤ä»»åŠ¡ ${e.job_id} å—ï¼Ÿ
æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`))try{"pause"===s&&(await (0,r.funboostFetch)(`/funboost/pause_timing_job?job_id=${e.job_id}&queue_name=${e.queue_name}`,{method:"POST"}),f({type:"success",message:"ä»»åŠ¡å·²æš‚åœã€‚"})),"resume"===s&&(await (0,r.funboostFetch)(`/funboost/resume_timing_job?job_id=${e.job_id}&queue_name=${e.queue_name}`,{method:"POST"}),f({type:"success",message:"ä»»åŠ¡å·²æ¢å¤ã€‚"})),"delete"===s&&(await (0,r.funboostFetch)(`/funboost/delete_timing_job?job_id=${e.job_id}&queue_name=${e.queue_name}`,{method:"DELETE"}),f({type:"success",message:"ä»»åŠ¡å·²åˆ é™¤ã€‚"})),eu()}catch(e){f({type:"error",message:e instanceof Error?e.message:"æ“ä½œå¤±è´¥ã€‚"})}},eB=async(e,s)=>{if("refresh"===s)return void ed(e);if(ec()&&confirm("pause"===s?`ç¡®å®šè¦æš‚åœé˜Ÿåˆ— "${e}" çš„æ‰€æœ‰å®šæ—¶ä»»åŠ¡è°ƒåº¦å—ï¼Ÿ`:`ç¡®å®šè¦æ¢å¤é˜Ÿåˆ— "${e}" çš„å®šæ—¶ä»»åŠ¡è°ƒåº¦å—ï¼Ÿ`))try{"pause"===s&&(await (0,r.funboostFetch)(`/funboost/pause_scheduler?queue_name=${encodeURIComponent(e)}&job_store_kind=${o}`,{method:"POST"}),f({type:"success",message:`é˜Ÿåˆ— ${e} è°ƒåº¦å™¨å·²æš‚åœã€‚`})),"resume"===s&&(await (0,r.funboostFetch)(`/funboost/resume_scheduler?queue_name=${encodeURIComponent(e)}&job_store_kind=${o}`,{method:"POST"}),f({type:"success",message:`é˜Ÿåˆ— ${e} è°ƒåº¦å™¨å·²æ¢å¤ã€‚`})),ed(e),eu()}catch(e){f({type:"error",message:e instanceof Error?e.message:"è°ƒåº¦å™¨æ“ä½œå¤±è´¥ã€‚"})}},eO=async()=>{if(ec()&&confirm(d?`ç¡®å®šè¦åˆ é™¤é˜Ÿåˆ— ${d} çš„æ‰€æœ‰ä»»åŠ¡å—ï¼Ÿ
æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`:"ç¡®å®šè¦åˆ é™¤æ‰€æœ‰é˜Ÿåˆ—çš„æ‰€æœ‰ä»»åŠ¡å—ï¼Ÿ\næ­¤æ“ä½œä¸å¯æ’¤é”€ï¼"))try{let e=`/funboost/delete_all_timing_jobs?job_store_kind=${o}`;d&&(e+=`&queue_name=${encodeURIComponent(d)}`);let s=await (0,r.funboostFetch)(e,{method:"DELETE"}),a=s.failed_jobs?.length||0,t=a?`æˆåŠŸåˆ é™¤ ${s.deleted_count} ä¸ªä»»åŠ¡ï¼Œå¤±è´¥ ${a} ä¸ªã€‚`:`æˆåŠŸåˆ é™¤ ${s.deleted_count} ä¸ªä»»åŠ¡ã€‚`;f({type:"success",message:t}),eu()}catch(e){f({type:"error",message:e instanceof Error?e.message:"åˆ é™¤å¤±è´¥ã€‚"})}},eM=async()=>{if(!ec())return;if(T(null),!S.queue_name)return void T("è¯·é€‰æ‹©é˜Ÿåˆ—åç§°ã€‚");let e=(e=>{try{let s=JSON.parse(X(e));if(!s||"object"!=typeof s||Array.isArray(s))return{valid:!1,message:"kwargs å¿…é¡»æ˜¯ JSON å¯¹è±¡ã€‚"};return{valid:!0,data:s}}catch(e){return{valid:!1,message:"kwargs å¿…é¡»æ˜¯åˆæ³•çš„ JSON æ ¼å¼ã€‚"}}})(S.kwargs);if(!e.valid)return void T(e.message||"kwargs æ ¡éªŒå¤±è´¥ã€‚");if("date"===S.triggerType&&!S.run_date)return void T("è¯·é€‰æ‹©æ‰§è¡Œæ—¶é—´ã€‚");if("interval"===S.triggerType&&!Object.values(S.interval).some(e=>Number(e)>0))return void T("é—´éš”æ‰§è¡Œè‡³å°‘å¡«å†™ä¸€ä¸ªæ—¶é—´å•ä½ã€‚");if("cron"===S.triggerType&&!Object.values(S.cron).some(e=>e&&e.trim().length>0))return void T("å®šæ—¶æ‰§è¡Œè‡³å°‘å¡«å†™ä¸€ä¸ªå­—æ®µã€‚");if(confirm(B?"ç¡®å®šè¦ä¿å­˜ä¿®æ”¹å—ï¼Ÿ":"ç¡®å®šè¦æ·»åŠ è¿™ä¸ªå®šæ—¶ä»»åŠ¡å—ï¼Ÿ"))try{let s={queue_name:S.queue_name,job_id:S.job_id||void 0,kwargs:e.data,trigger:S.triggerType,job_store_kind:o,replace_existing:S.replace_existing};"date"===S.triggerType&&(s.run_date=S.run_date),"interval"===S.triggerType&&Object.entries(S.interval).forEach(([e,a])=>{a&&Number(a)>0&&(s[e]=Number(a))}),"cron"===S.triggerType&&Object.entries(S.cron).forEach(([e,a])=>{a&&a.trim().length>0&&(s[e]=a.trim())}),await (0,r.funboostFetch)("/funboost/add_timing_job",{method:"POST",json:s}),eq(),f({type:"success",message:"ä»»åŠ¡ä¿å­˜æˆåŠŸï¼"}),eu()}catch(e){f({type:"error",message:e instanceof Error?e.message:"ä¿å­˜å¤±è´¥ã€‚"})}};return(0,s.jsx)(t.RequirePermission,{permissions:["queue:read"],projectLevel:"read",children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(P,{stats:ek}),(0,s.jsx)(C,{queueOptions:ef,queueFilter:d,statusFilter:m,search:g,loading:b,autoRefresh:ex,refreshInterval:eg/1e3,canOperate:ei,allRunning:ew,batchLoading:V,onQueueChange:u,onStatusChange:h,onSearchChange:j,onAdd:()=>eS(),onRefresh:em,onToggleAutoRefresh:ep,onRefreshIntervalChange:e=>ej(1e3*e),onDeleteAll:eO,onShowHelp:()=>H(!0),onBatchToggle:eC}),v&&(0,s.jsx)(n.Card,{className:`border text-sm ${"success"===v.type?"border-[hsl(var(--success))]/30 bg-[hsl(var(--success))]/10 text-[hsl(var(--success))]":"warning"===v.type?"border-[hsl(var(--warning))]/30 bg-[hsl(var(--warning))]/10 text-[hsl(var(--warning))]":"border-[hsl(var(--danger))]/30 bg-[hsl(var(--danger))]/10 text-[hsl(var(--danger))]"}`,role:"alert",children:v.message}),(0,s.jsx)(K,{jobsByQueue:e_,loading:b,empty:0===eb.length,schedulerStatusMap:W,canOperate:ei,page:N,totalPages:ey,onPageChange:_,onShowDetail:e$,onEdit:eS,onJobAction:eT,onSchedulerAction:eB}),(0,s.jsx)(O,{open:k,editingJobId:B?.job_id||null,form:S,availableQueues:i,funcParamsInfo:E,loadingParams:I,formError:$,onClose:eq,onSubmit:eM,onQueueChange:e=>{T(null),q(s=>({...s,queue_name:e,kwargs:"{}"})),ev(e)},setForm:q}),(0,s.jsx)(p,{job:R,funcName:J,onClose:()=>A(null)}),(0,s.jsx)(D,{open:L,onClose:()=>H(!1)})]})})}e.s(["default",()=>es],37539)}]);