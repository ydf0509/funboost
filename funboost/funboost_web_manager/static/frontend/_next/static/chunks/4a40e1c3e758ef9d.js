(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,96640,e=>{"use strict";var t=e.i(43476),s=e.i(7670);let a={neutral:"bg-[hsl(var(--sand-2))] text-[hsl(var(--ink))]",success:"bg-[hsl(var(--success))]/15 text-[hsl(var(--success))]",warning:"bg-[hsl(var(--warning))]/15 text-[hsl(var(--warning))]",danger:"bg-[hsl(var(--danger))]/15 text-[hsl(var(--danger))]",info:"bg-[hsl(var(--info))]/15 text-[hsl(var(--info))]"};function r({tone:e="neutral",className:r,...n}){return(0,t.jsx)("span",{className:(0,s.default)("inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold uppercase tracking-[0.12em]",a[e],r),...n})}e.s(["Badge",()=>r])},27612,e=>{"use strict";let t=(0,e.i(75254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>t],27612)},32098,37727,e=>{"use strict";var t=e.i(43476),s=e.i(71645);let a=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>a],37727);var r=e.i(7670),n=e.i(59544);let l={sm:"max-w-md",md:"max-w-xl",lg:"max-w-3xl",xl:"max-w-5xl"};function i({open:e,title:i,onClose:c,children:d,footer:o,size:u="lg",subtitle:h}){let m=(0,s.useCallback)(e=>{"Escape"===e.key&&c()},[c]);return((0,s.useEffect)(()=>{if(e)return document.body.style.overflow="hidden",document.addEventListener("keydown",m),()=>{document.body.style.overflow="",document.removeEventListener("keydown",m)}},[e,m]),e)?(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4 py-10",role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-md transition-opacity duration-300 ease-out",onClick:c,"aria-hidden":"true"}),(0,t.jsxs)("div",{className:(0,r.default)("relative w-full rounded-3xl p-8 shadow-2xl","bg-[hsl(var(--card))]/95 backdrop-blur-xl","border border-[hsl(var(--line))]/50","animate-in fade-in-0 zoom-in-95 duration-300 ease-out",l[u]),children:[(0,t.jsxs)("div",{className:"flex items-start justify-between border-b border-[hsl(var(--line))]/60 pb-4 mb-2",children:[(0,t.jsxs)("div",{className:"flex-1 pr-4",children:[(0,t.jsx)("h2",{id:"modal-title",className:"font-display text-xl font-semibold text-[hsl(var(--ink))] tracking-tight",children:i}),h&&(0,t.jsx)("p",{className:"mt-1 text-sm text-[hsl(var(--ink-muted))]",children:h})]}),(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",onClick:c,className:"cursor-pointer -mr-2 -mt-1 hover:bg-[hsl(var(--sand-2))] rounded-xl transition-colors duration-200","aria-label":"关闭弹窗",children:(0,t.jsx)(a,{className:"h-5 w-5"})})]}),(0,t.jsx)("div",{className:(0,r.default)("max-h-[65vh] overflow-y-auto py-4 text-sm text-[hsl(var(--ink))]","scrollbar-thin scrollbar-thumb-[hsl(var(--line))] scrollbar-track-transparent","pr-2 -mr-2"),children:d}),o&&(0,t.jsx)("div",{className:"border-t border-[hsl(var(--line))]/60 pt-5 mt-2",children:o})]})]}):null}e.s(["Modal",()=>i],32098)},86536,e=>{"use strict";let t=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],86536)},39616,e=>{"use strict";let t=(0,e.i(75254).default)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Settings",()=>t],39616)},31343,e=>{"use strict";let t=(0,e.i(75254).default)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);e.s(["Play",()=>t],31343)},52571,95242,e=>{"use strict";var t=e.i(75254);let s=(0,t.default)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);e.s(["Info",()=>s],52571);let a=(0,t.default)("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]]);e.s(["Pause",()=>a],95242)},75379,e=>{"use strict";function t(e){return new Intl.NumberFormat("zh-CN").format(e)}function s(e){if(!e)return"-";let t=new Date("number"==typeof e?1e3*e:e);return Number.isNaN(t.getTime())?"-":new Intl.DateTimeFormat("zh-CN",{dateStyle:"medium",timeStyle:"short"}).format(t)}function a(e){let t=e=>String(e).padStart(2,"0");return`${e.getFullYear()}-${t(e.getMonth()+1)}-${t(e.getDate())}T${t(e.getHours())}:${t(e.getMinutes())}`}function r(e){if(!e)return"";let t=e.includes("T")?e.replace("T"," "):e;return 16===t.length?`${t}:00`:t}e.s(["formatDateTime",()=>s,"formatNumber",()=>t,"toBackendDateTime",()=>r,"toDateTimeInputValue",()=>a])},57998,68402,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(64659),r=e.i(63059),n=e.i(74886),l=e.i(43531),i=e.i(98361),c=e.i(26336),d=e.i(32098),o=e.i(59544);function u({data:e,path:n="",level:l=0,defaultExpanded:i=!0}){let[c,d]=(0,s.useState)(i);if(null===e)return(0,t.jsx)("span",{className:"text-[hsl(var(--danger))]",children:"null"});if("boolean"==typeof e)return(0,t.jsx)("span",{className:"text-[hsl(var(--warning))]",children:e.toString()});if("number"==typeof e)return(0,t.jsx)("span",{className:"text-[hsl(var(--success))]",children:e});if("string"==typeof e)return(0,t.jsxs)("span",{className:"text-[hsl(var(--info))]",children:['"',e,'"']});if(Array.isArray(e))return 0===e.length?(0,t.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:"[]"}):(0,t.jsxs)("span",{children:[(0,t.jsx)("button",{onClick:()=>d(!c),className:"inline-flex items-center text-[hsl(var(--ink-muted))] hover:text-[hsl(var(--accent))] focus:outline-none",children:c?(0,t.jsx)(a.ChevronDown,{className:"h-3 w-3"}):(0,t.jsx)(r.ChevronRight,{className:"h-3 w-3"})}),(0,t.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:"["}),(0,t.jsxs)("span",{className:"text-[hsl(var(--ink-muted))] italic ml-1",children:[e.length," items"]}),c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"ml-4 pl-3 border-l border-[hsl(var(--line))]",children:e.map((s,a)=>(0,t.jsxs)("div",{className:"leading-6",children:[(0,t.jsx)(u,{data:s,path:`${n}[${a}]`,level:l+1,defaultExpanded:i}),a<e.length-1&&(0,t.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:","})]},`${n}[${a}]`))}),(0,t.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:"]"})]})]});if("object"==typeof e){let s=Object.entries(e);return 0===s.length?(0,t.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:"{}"}):(0,t.jsxs)("span",{children:[(0,t.jsx)("button",{onClick:()=>d(!c),className:"inline-flex items-center text-[hsl(var(--ink-muted))] hover:text-[hsl(var(--accent))] focus:outline-none",children:c?(0,t.jsx)(a.ChevronDown,{className:"h-3 w-3"}):(0,t.jsx)(r.ChevronRight,{className:"h-3 w-3"})}),(0,t.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:"{"}),(0,t.jsxs)("span",{className:"text-[hsl(var(--ink-muted))] italic ml-1",children:[s.length," keys"]}),c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"ml-4 pl-3 border-l border-[hsl(var(--line))]",children:s.map(([e,a],r)=>(0,t.jsxs)("div",{className:"leading-6",children:[(0,t.jsxs)("span",{className:"text-[hsl(var(--accent-2))]",children:['"',e,'"']}),(0,t.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:": "}),(0,t.jsx)(u,{data:a,path:`${n}.${e}`,level:l+1,defaultExpanded:i}),r<s.length-1&&(0,t.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:","})]},`${n}.${e}`))}),(0,t.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:"}"})]})]})}return(0,t.jsx)("span",{className:"text-[hsl(var(--ink))]",children:String(e)})}function h({open:e,title:a,content:r,onClose:h}){let[m,x]=(0,s.useState)(!1),[p,v]=(0,s.useState)(!0),{data:f,error:j}=(0,s.useMemo)(()=>(function(e){if(!e||""===e.trim()||"-"===e)return{data:null,error:"No content"};try{return{data:JSON.parse(e),error:null}}catch{try{let t=JSON.parse(`"${e.replace(/"/g,'\\"')}"`);return{data:JSON.parse(t),error:null}}catch{return{data:e,error:null}}}})(r),[r]),g=(0,s.useMemo)(()=>{if(j||null===f)return r;try{return JSON.stringify(f,null,2)}catch{return r}},[f,j,r]),y=(0,s.useCallback)(async()=>{try{await navigator.clipboard.writeText(g),x(!0),setTimeout(()=>x(!1),2e3)}catch{let e=document.createElement("textarea");e.value=g,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),x(!0),setTimeout(()=>x(!1),2e3)}},[g]),b=null===j&&null!==f&&"object"==typeof f;return(0,t.jsx)(d.Modal,{open:e,title:a,onClose:h,size:"xl",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2 pb-3 border-b border-[hsl(var(--line))]",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:b&&(0,t.jsx)(o.Button,{variant:"outline",size:"sm",onClick:()=>v(!p),children:p?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Minimize2,{className:"h-3 w-3"}),"折叠全部"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.Maximize2,{className:"h-3 w-3"}),"展开全部"]})})}),(0,t.jsx)(o.Button,{variant:m?"primary":"outline",size:"sm",onClick:y,children:m?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Check,{className:"h-3 w-3"}),"已复制"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Copy,{className:"h-3 w-3"}),"复制"]})})]}),(0,t.jsx)("div",{className:"rounded-xl bg-[hsl(var(--sand-2))] p-4 overflow-auto max-h-[60vh]",children:b?(0,t.jsx)("pre",{className:"font-mono text-sm whitespace-pre-wrap break-all",children:(0,t.jsx)(u,{data:f,defaultExpanded:p},p?"expanded":"collapsed")}):(0,t.jsx)("pre",{className:"font-mono text-sm whitespace-pre-wrap break-all text-[hsl(var(--ink))]",children:r||"-"})})]})})}function m(e,t=!1,a=1e4){var r,n;let l,[i,c]=(0,s.useState)(t),d=(0,s.useCallback)(()=>c(e=>!e),[]);return r=()=>{i&&e()},n=i?a:null,l=(0,s.useRef)(r),(0,s.useEffect)(()=>{l.current=r},[r]),(0,s.useEffect)(()=>{if(null===n)return;let e=setInterval(()=>l.current(),n);return()=>clearInterval(e)},[n]),{enabled:i,toggle:d,setEnabled:c}}e.s(["JsonViewerModal",()=>h],57998),e.s(["useAutoRefresh",()=>m],68402)},74886,98361,26336,e=>{"use strict";var t=e.i(75254);let s=(0,t.default)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);e.s(["Copy",()=>s],74886);let a=(0,t.default)("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]);e.s(["Maximize2",()=>a],98361);let r=(0,t.default)("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]);e.s(["Minimize2",()=>r],26336)},63059,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["ChevronRight",()=>t],63059)},43531,e=>{"use strict";let t=(0,e.i(75254).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>t],43531)},38171,e=>{"use strict";var t=e.i(43476),s=e.i(7670),a=e.i(39964);let r={success:{border:"border-l-4 border-l-[hsl(var(--success))]",value:"text-[hsl(var(--success))]",bg:"bg-[hsl(var(--success)/0.05)]"},danger:{border:"border-l-4 border-l-[hsl(var(--danger))]",value:"text-[hsl(var(--danger))]",bg:"bg-[hsl(var(--danger)/0.05)]"},warning:{border:"border-l-4 border-l-[hsl(var(--warning))]",value:"text-[hsl(var(--warning))]",bg:"bg-[hsl(var(--warning)/0.05)]"},info:{border:"border-l-4 border-l-[hsl(var(--info))]",value:"text-[hsl(var(--info))]",bg:"bg-[hsl(var(--info)/0.05)]"},neutral:{border:"",value:"text-[hsl(var(--ink))]",bg:""}};function n({label:e,value:n,helper:l,tone:i="neutral"}){let c=r[i];return(0,t.jsxs)(a.Card,{className:(0,s.default)("flex flex-col gap-2 transition-all duration-200 hover:shadow-lg cursor-default",c.border,c.bg),children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.18em] text-[hsl(var(--ink-muted))]",children:e}),(0,t.jsx)("div",{className:(0,s.default)("font-display text-2xl",c.value),children:n}),l?(0,t.jsx)("p",{className:"text-xs text-[hsl(var(--ink-muted))]",children:l}):null]})}e.s(["StatCard",()=>n])},40803,e=>{"use strict";var t=e.i(43476),s=e.i(39964);function a({title:e,subtitle:a,action:r}){return(0,t.jsxs)(s.Card,{className:"flex flex-col items-start gap-3",children:[(0,t.jsx)("h3",{className:"font-display text-lg text-[hsl(var(--ink))]",children:e}),a?(0,t.jsx)("p",{className:"text-sm text-[hsl(var(--ink-muted))]",children:a}):null,r?(0,t.jsx)("div",{children:r}):null]})}e.s(["EmptyState",()=>a])},3812,e=>{"use strict";var t=e.i(43476),s=e.i(7670);function a({className:e,...a}){return(0,t.jsx)("input",{className:(0,s.default)("w-full rounded-2xl border border-[hsl(var(--line))] bg-[hsl(var(--card))]/80 px-4 py-2 text-sm text-[hsl(var(--ink))] shadow-sm outline-none transition placeholder:text-[hsl(var(--ink-muted))] focus:border-[hsl(var(--accent))] focus:ring-2 focus:ring-[hsl(var(--accent))]/20",e),...a})}e.s(["Input",()=>a])},59544,e=>{"use strict";var t=e.i(43476),s=e.i(7670);let a={primary:"bg-[hsl(var(--accent))] text-white hover:bg-[hsl(var(--accent-2))]",secondary:"bg-[hsl(var(--accent-2))] text-white hover:bg-[hsl(var(--accent))]",outline:"border border-[hsl(var(--line))] text-[hsl(var(--ink))] hover:border-[hsl(var(--accent))] hover:text-[hsl(var(--accent))]",ghost:"text-[hsl(var(--ink))] hover:bg-[hsl(var(--sand-2))]",danger:"bg-[hsl(var(--danger))] text-white hover:bg-[hsl(var(--danger))]/90"},r={sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-5 py-2.5 text-sm"};function n({variant:e="primary",size:n="md",className:l,...i}){return(0,t.jsx)("button",{className:(0,s.default)("inline-flex items-center justify-center gap-2 rounded-full font-medium transition-colors duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--accent))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--sand))]",a[e],r[n],l),...i})}e.s(["Button",()=>n])},39964,e=>{"use strict";var t=e.i(43476),s=e.i(7670);function a({glass:e=!0,className:a,...r}){return(0,t.jsx)("div",{className:(0,s.default)("rounded-3xl p-6",e?"glass-card":"bg-[hsl(var(--card))] border border-[hsl(var(--line))]",a),...r})}e.s(["Card",()=>a])},88092,e=>{"use strict";let t=(0,e.i(75254).default)("shield-x",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m14.5 9.5-5 5",key:"17q4r4"}],["path",{d:"m9.5 9.5 5 5",key:"18nt4w"}]]);e.s(["ShieldX",()=>t],88092)},71689,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],71689)},62162,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(93302),r=e.i(80580),n=e.i(88092),l=e.i(71689);let i=(0,e.i(75254).default)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]);var c=e.i(59544),d=e.i(39964),o=e.i(20777);function u({title:e="访问被拒绝",description:s="您没有权限访问此页面。请联系管理员获取相应权限。",requiredPermission:a,showBackButton:r=!0,showHomeButton:u=!0}){return(0,t.jsx)("div",{className:"flex min-h-[60vh] items-center justify-center px-4",children:(0,t.jsx)(d.Card,{className:"max-w-md text-center",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("div",{className:"flex h-16 w-16 items-center justify-center rounded-full bg-[hsl(var(--danger))]/10",children:(0,t.jsx)(n.ShieldX,{className:"h-8 w-8 text-[hsl(var(--danger))]"})}),(0,t.jsx)("h1",{className:"font-display text-2xl text-[hsl(var(--ink))]",children:e}),(0,t.jsx)("p",{className:"text-sm text-[hsl(var(--ink-muted))]",children:s}),a&&(0,t.jsx)("div",{className:"mt-2 rounded-lg bg-[hsl(var(--sand-2))] px-4 py-2",children:(0,t.jsxs)("p",{className:"text-xs text-[hsl(var(--ink-muted))]",children:["所需权限：",(0,t.jsx)("code",{className:"ml-1 rounded bg-[hsl(var(--sand-3))] px-1.5 py-0.5 font-mono text-[hsl(var(--ink))]",children:a})]})}),(r||u)&&(0,t.jsxs)("div",{className:"mt-4 flex flex-wrap justify-center gap-3",children:[r&&(0,t.jsxs)(c.Button,{variant:"outline",size:"sm",onClick:()=>window.history.back(),children:[(0,t.jsx)(l.ArrowLeft,{className:"h-4 w-4"}),"返回上一页"]}),u&&(0,t.jsx)(o.StaticLink,{href:"/queue-op",children:(0,t.jsxs)(c.Button,{variant:"primary",size:"sm",children:[(0,t.jsx)(i,{className:"h-4 w-4"}),"返回首页"]})})]})]})})})}var h=e.i(55600);function m({permissions:e,projectLevel:n,projectId:l,children:i,deniedTitle:c,deniedDescription:d,loadingFallback:o}){let{hasAnyPermission:m,loading:x,isAuthenticated:p}=(0,a.usePermissions)(),{currentProject:v,projects:f,isLoading:j}=(0,r.useProject)(),[g,y]=(0,s.useState)(!1);(0,s.useEffect)(()=>{y(!0)},[]);let b="number"==typeof l?f.find(e=>e.id===l)||null:v,N=(()=>{if(!n)return!0;let e={read:1,write:2,admin:3},t=e[n]??0;return b?.permission_level?(e[b.permission_level]??0)>=t:f.length>0&&Math.max(...f.map(t=>e[t.permission_level??"read"]??0))>=t})();return((0,s.useEffect)(()=>{!g||x||p||(0,h.navigateTo)("/login")},[g,x,p]),!g||x||n&&j)?o?(0,t.jsx)(t.Fragment,{children:o}):(0,t.jsx)("div",{className:"flex min-h-[60vh] items-center justify-center",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-2 border-[hsl(var(--accent))] border-t-transparent"}),(0,t.jsx)("p",{className:"text-sm text-[hsl(var(--ink-muted))]",children:"正在验证权限..."})]})}):p?n&&!N?(0,t.jsx)(u,{title:c||"无项目权限",description:d||"当前项目权限不足，无法访问该页面。",requiredPermission:`项目权限: ${n}`,showBackButton:!0,showHomeButton:!0}):m(e)?(0,t.jsx)(t.Fragment,{children:i}):(0,t.jsx)(u,{title:c,description:d,requiredPermission:e.join(" 或 "),showBackButton:!0,showHomeButton:!0}):(0,t.jsx)("div",{className:"flex min-h-[60vh] items-center justify-center",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-2 border-[hsl(var(--accent))] border-t-transparent"}),(0,t.jsx)("p",{className:"text-sm text-[hsl(var(--ink-muted))]",children:"正在跳转到登录页面..."})]})})}e.s(["RequirePermission",()=>m],62162)},84030,e=>{"use strict";var t=e.i(71645),s=e.i(93302);function a(e,a){let{hasPermission:r}=(0,s.usePermissions)();return(0,t.useMemo)(()=>({canCreate:r(`${e}:create`,a),canRead:r(`${e}:read`,a),canUpdate:r(`${e}:update`,a),canDelete:r(`${e}:delete`,a),canExecute:r(`${e}:execute`,a),canExport:r(`${e}:export`,a)}),[e,a,r])}e.s(["useActionPermissions",()=>a])},64659,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);e.s(["ChevronDown",()=>t],64659)},39312,56660,e=>{"use strict";let t=(0,e.i(75254).default)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);e.s(["Zap",()=>t],39312);var s=e.i(43476),a=e.i(7670);function r({checked:e,onChange:t,label:r,size:n="md",disabled:l=!1}){let i={sm:{track:"w-8 h-4",thumb:"h-3 w-3",translate:"translate-x-4"},md:{track:"w-11 h-6",thumb:"h-5 w-5",translate:"translate-x-5"}}[n];return(0,s.jsxs)("button",{type:"button",role:"switch","aria-checked":e,disabled:l,onClick:()=>!l&&t(!e),className:(0,a.default)("group relative inline-flex items-center gap-2",l&&"opacity-50 cursor-not-allowed"),children:[(0,s.jsx)("span",{className:(0,a.default)("relative inline-flex flex-shrink-0 rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none",i.track,e?"bg-[hsl(var(--accent))]":"bg-[hsl(var(--sand-2))]",!l&&"cursor-pointer"),children:(0,s.jsx)("span",{className:(0,a.default)("pointer-events-none inline-block rounded-full bg-white shadow-lg ring-0 transition duration-200 ease-in-out",i.thumb,e?i.translate:"translate-x-0")})}),r&&(0,s.jsx)("span",{className:"text-sm text-[hsl(var(--ink))]",children:r})]})}e.s(["Toggle",()=>r],56660)},38645,e=>{"use strict";var t=e.i(43476),s=e.i(71645);let a=(0,e.i(75254).default)("chart-line",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);var r=e.i(52571),n=e.i(95242),l=e.i(31343),i=e.i(16715),c=e.i(27612),d=e.i(86536),o=e.i(39312),u=e.i(62162),h=e.i(96640),m=e.i(59544),x=e.i(39964),p=e.i(40803),v=e.i(3812),f=e.i(32098),j=e.i(38171),g=e.i(56660),y=e.i(22726),b=e.i(57998),N=e.i(9165),w=e.i(75379),k=e.i(68402),_=e.i(84030),C=e.i(80580);let S=[60,120,180,360,720,1440,8640];function M(){let[e,M]=(0,s.useState)([]),[q,B]=(0,s.useState)(!1),[$,z]=(0,s.useState)(""),[T,E]=(0,s.useState)(!1),[P,F]=(0,s.useState)(null),[R,D]=(0,s.useState)(null),[I,A]=(0,s.useState)(null),[O,L]=(0,s.useState)(null),[V,J]=(0,s.useState)([]),[U,H]=(0,s.useState)(360),[X,K]=(0,s.useState)(!1),[Z,Q]=(0,s.useState)(()=>{let e=new Date(Date.now()-36e5);return(0,w.toDateTimeInputValue)(e)}),[Y,G]=(0,s.useState)(()=>{let e=new Date;return(0,w.toDateTimeInputValue)(e)}),[W,ee]=(0,s.useState)(1),[et,es]=(0,s.useState)(!1),[ea,er]=(0,s.useState)(""),[en,el]=(0,s.useState)(""),{currentProject:ei,careProjectName:ec}=(0,C.useProject)(),{canExecute:ed}=(0,_.useActionPermissions)("queue"),eo=ei?.permission_level??"admin",eu=!ei||"write"===eo||"admin"===eo,eh=ed&&eu,em=(0,s.useCallback)(async()=>{B(!0);try{let e="/queue/params_and_active_consumers";ei?.id&&(e+=`?project_id=${ei.id}`);let t=await (0,N.apiFetch)(e),s=Object.entries(t).map(([e,t])=>({queue_name:e,...t}));M(s)}catch(e){F(e instanceof Error?e.message:"加载队列失败。")}finally{B(!1)}},[ei?.id,ec]),{enabled:ex,toggle:ep}=(0,k.useAutoRefresh)(em,!1,1e4);(0,s.useEffect)(()=>{em();let e=()=>{em()};return window.addEventListener("careProjectChanged",e),()=>{window.removeEventListener("careProjectChanged",e)}},[em]);let ev=(0,s.useMemo)(()=>{let t=e.filter(e=>(e.active_consumers?.length??0)>0),s=e.filter(e=>(e.active_consumers?.length??0)===0),a=e.reduce((e,t)=>e+(t.active_consumers?.length??0),0),r=e.reduce((e,t)=>e+(t.history_run_fail_count??0),0);return{active:t.length,idle:s.length,consumers:a,retryCount:r}},[e]),ef=(0,s.useMemo)(()=>e.filter(e=>(!T||(e.active_consumers?.length??0)!==0)&&(!$||!!e.queue_name.toLowerCase().includes($.toLowerCase()))),[e,$,T]),ej=Math.ceil(ef.length/20),eg=(0,s.useMemo)(()=>{let e=(W-1)*20;return ef.slice(e,e+20)},[ef,W]),ey=async()=>{F(null);try{let t=await Promise.all(e.map(async e=>{try{let t=`/funboost/get_msg_count?queue_name=${encodeURIComponent(e.queue_name)}`;ei?.id&&(t+=`&project_id=${ei.id}`);let s=await (0,N.funboostFetch)(t);return{...e,msg_num_in_broker:s.count}}catch{return e}}));M(t),F("消息数量已刷新。")}catch(e){F(e instanceof Error?e.message:"刷新失败。")}},eb=async e=>{D(e);try{let t=`/running_consumer/hearbeat_info_by_queue_name?queue_name=${encodeURIComponent(e.queue_name)}`;ei?.id&&(t+=`&project_id=${ei.id}`);let s=await (0,N.apiFetch)(t);A(s)}catch(e){F(e instanceof Error?e.message:"加载消费者失败。")}},eN=async e=>{let t=e||O;if(t){e&&L(e),K(!0);try{let e=Math.floor(new Date(Z).getTime()/1e3),s=Math.floor(new Date(Y).getTime()/1e3),a=`/queue/get_time_series_data/${encodeURIComponent(t.queue_name)}?start_ts=${e}&end_ts=${s}&curve_samples_count=${U}`;ei?.id&&(a+=`&project_id=${ei.id}`);let r=await (0,N.apiFetch)(a);J(r)}catch(e){F(e instanceof Error?e.message:"加载曲线数据失败。")}finally{K(!1)}}},ew=async(e,t)=>{F(null);try{if(("pause"===t||"resume"===t)&&!eh)return void F("当前项目无写权限，无法执行队列操作。");if(("clear"===t||"deprecate"===t)&&!eh)return void F("当前项目无写权限，无法清空或废弃队列。");if("clear"===t&&await (0,N.funboostFetch)("/funboost/clear_queue",{method:"POST",json:{queue_name:e.queue_name,project_id:ei?.id}}),"deprecate"===t&&await (0,N.funboostFetch)("/funboost/deprecate_queue",{method:"DELETE",json:{queue_name:e.queue_name,project_id:ei?.id}}),"pause"===t){let t=`/queue/pause/${encodeURIComponent(e.queue_name)}`;ei?.id&&(t+=`?project_id=${ei.id}`),await (0,N.apiFetch)(t,{method:"POST"})}if("resume"===t){let t=`/queue/resume/${encodeURIComponent(e.queue_name)}`;ei?.id&&(t+=`?project_id=${ei.id}`),await (0,N.apiFetch)(t,{method:"POST"})}await em(),F("操作已完成。")}catch(e){F(e instanceof Error?e.message:"操作失败。")}},ek=async()=>{if(!eh)return void F("当前项目无写权限，无法启动自动消费。");F("正在启动自动消费...");try{await em(),F("自动消费已启动。")}catch(e){F(e instanceof Error?e.message:"启动失败。")}};return(0,t.jsx)(u.RequirePermission,{permissions:["queue:read"],projectLevel:"read",children:(0,t.jsxs)("div",{className:"space-y-6",children:[P?(0,t.jsx)(x.Card,{className:"border border-[hsl(var(--accent))]/30 bg-[hsl(var(--accent))]/10 text-sm text-[hsl(var(--accent-2))]",children:P}):null,(0,t.jsxs)("div",{className:"grid gap-4 grid-cols-2 lg:grid-cols-4",children:[(0,t.jsx)(j.StatCard,{label:"远程队列",value:e.length,helper:"总数",tone:"info"}),(0,t.jsx)(j.StatCard,{label:"消费队列",value:ev.active,helper:"活跃",tone:"success"}),(0,t.jsx)(j.StatCard,{label:"消费者监控",value:ev.consumers,helper:"在线",tone:"warning"}),(0,t.jsx)(j.StatCard,{label:"重试次数",value:ev.retryCount,helper:"累计",tone:"danger"})]}),(0,t.jsx)(x.Card,{children:(0,t.jsx)("div",{className:"flex flex-col gap-4",children:(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-[hsl(var(--ink-muted))]",children:"队列搜索"}),(0,t.jsx)(v.Input,{placeholder:"请输入队列名称搜索...",value:$,onChange:e=>z(e.target.value),className:"w-64"})]}),(0,t.jsx)(g.Toggle,{checked:T,onChange:E,label:"仅显示消费队列"}),(0,t.jsx)("div",{className:"flex-1"}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsxs)(m.Button,{variant:"secondary",size:"sm",onClick:ey,className:"cursor-pointer",children:[(0,t.jsx)(i.RefreshCw,{className:"h-4 w-4"}),"全部队列消息数量"]}),(0,t.jsxs)(m.Button,{variant:"primary",size:"sm",onClick:ek,className:"cursor-pointer",disabled:!eh,children:[(0,t.jsx)(o.Zap,{className:"h-4 w-4"}),"启动自动消费"]}),(0,t.jsxs)(m.Button,{variant:"outline",size:"sm",onClick:em,className:"cursor-pointer",children:[(0,t.jsx)(i.RefreshCw,{className:`h-4 w-4 ${q?"animate-spin":""}`}),"刷新"]})]})]})})}),(0,t.jsxs)(x.Card,{children:[(0,t.jsx)("div",{className:"overflow-x-auto",children:q?(0,t.jsxs)("div",{className:"py-8 text-center text-sm text-[hsl(var(--ink-muted))]",children:[(0,t.jsx)(i.RefreshCw,{className:"h-8 w-8 mx-auto mb-2 animate-spin text-[hsl(var(--accent))]"}),"正在加载队列..."]}):0===ef.length?(0,t.jsx)(p.EmptyState,{title:"未找到队列",subtitle:"调整筛选条件或刷新列表。"}):(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{className:"text-left text-xs uppercase tracking-wider text-[hsl(var(--ink-muted))] bg-[hsl(var(--sand-2))]",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"名称"}),(0,t.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"消费者数量"}),(0,t.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"Broker类型"}),(0,t.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"消费函数"}),(0,t.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"最近执行时间"}),(0,t.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"消息数量"}),(0,t.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"历史运行次数"}),(0,t.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"历史失败次数"}),(0,t.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"近10秒完成"}),(0,t.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"近10秒失败"}),(0,t.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"累计平均耗时"}),(0,t.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"状态"}),(0,t.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"操作"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-[hsl(var(--line))]",children:eg.map(e=>{let s=(e.active_consumers?.length??0)>0,i=1===e.pause_flag,o=e.queue_params?.consuming_function_name??"-";return(0,t.jsxs)("tr",{className:"hover:bg-[hsl(var(--sand-2))]/50 transition-colors",children:[(0,t.jsx)("td",{className:"px-3 py-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-medium text-[hsl(var(--ink))]",children:e.queue_name}),s?(0,t.jsx)(h.Badge,{tone:"success",children:"消费"}):(0,t.jsx)(h.Badge,{tone:"neutral",children:"等待"}),i&&(0,t.jsx)(h.Badge,{tone:"warning",children:"已暂停"})]})}),(0,t.jsx)("td",{className:"px-3 py-3 text-center",children:(0,t.jsx)(h.Badge,{tone:s?"success":"neutral",children:e.active_consumers?.length??0})}),(0,t.jsx)("td",{className:"px-3 py-3",children:(0,t.jsx)(h.Badge,{tone:"info",children:e.queue_params?.broker_kind??"-"})}),(0,t.jsx)("td",{className:"px-3 py-3 text-[hsl(var(--ink))]",children:(0,t.jsx)("code",{className:"text-xs bg-[hsl(var(--sand-2))] px-1.5 py-0.5 rounded",children:o})}),(0,t.jsx)("td",{className:"px-3 py-3 text-xs text-[hsl(var(--ink-muted))] whitespace-nowrap",children:(0,w.formatDateTime)(e.all_consumers_last_execute_task_time??null)}),(0,t.jsx)("td",{className:"px-3 py-3 text-center",children:(0,t.jsx)(h.Badge,{tone:"warning",children:(0,w.formatNumber)(e.msg_num_in_broker??0)})}),(0,t.jsx)("td",{className:"px-3 py-3 text-center text-[hsl(var(--ink))]",children:(0,w.formatNumber)(e.history_run_count??0)}),(0,t.jsx)("td",{className:"px-3 py-3 text-center",children:(0,t.jsx)("span",{className:e.history_run_fail_count?"text-[hsl(var(--danger))]":"text-[hsl(var(--ink-muted))]",children:(0,w.formatNumber)(e.history_run_fail_count??0)})}),(0,t.jsx)("td",{className:"px-3 py-3 text-center text-[hsl(var(--ink))]",children:e.all_consumers_last_x_s_execute_count??0}),(0,t.jsx)("td",{className:"px-3 py-3 text-center",children:(0,t.jsx)("span",{className:e.all_consumers_last_x_s_execute_count_fail?"text-[hsl(var(--danger))]":"text-[hsl(var(--ink-muted))]",children:e.all_consumers_last_x_s_execute_count_fail??0})}),(0,t.jsx)("td",{className:"px-3 py-3 text-center text-[hsl(var(--ink))]",children:e.all_consumers_avarage_function_spend_time_from_start?`${e.all_consumers_avarage_function_spend_time_from_start.toFixed(3)}s`:"-"}),(0,t.jsx)("td",{className:"px-3 py-3",children:i?(0,t.jsx)(h.Badge,{tone:"warning",children:"暂停中"}):s?(0,t.jsx)(h.Badge,{tone:"success",children:"运行中"}):(0,t.jsx)(h.Badge,{tone:"neutral",children:"空闲"})}),(0,t.jsx)("td",{className:"px-3 py-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(m.Button,{variant:"secondary",size:"sm",className:"h-7 px-2",onClick:()=>{er(`队列配置: ${e.queue_name}`),el(JSON.stringify(e.queue_params??{},null,2)),es(!0)},children:(0,t.jsx)(d.Eye,{className:"h-3 w-3"})}),(0,t.jsx)(m.Button,{variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>eN(e),children:(0,t.jsx)(a,{className:"h-3 w-3"})}),(0,t.jsx)(m.Button,{variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>eb(e),children:(0,t.jsx)(r.Info,{className:"h-3 w-3"})}),(0,t.jsx)(m.Button,{variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>ew(e,i?"resume":"pause"),disabled:!eh,children:i?(0,t.jsx)(l.Play,{className:"h-3 w-3"}):(0,t.jsx)(n.Pause,{className:"h-3 w-3"})}),(0,t.jsx)(m.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-[hsl(var(--danger))]",onClick:()=>ew(e,"clear"),disabled:!eh,children:(0,t.jsx)(c.Trash2,{className:"h-3 w-3"})})]})})]},e.queue_name)})})]})}),ej>1&&(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2 mt-4 pt-4 border-t border-[hsl(var(--line))]",children:[(0,t.jsx)(m.Button,{variant:"outline",size:"sm",disabled:1===W,onClick:()=>ee(1),children:"首页"}),(0,t.jsx)(m.Button,{variant:"outline",size:"sm",disabled:1===W,onClick:()=>ee(W-1),children:"上一页"}),(0,t.jsxs)("span",{className:"px-3 py-1 text-sm text-[hsl(var(--ink-muted))]",children:[W," / ",ej]}),(0,t.jsx)(m.Button,{variant:"outline",size:"sm",disabled:W===ej,onClick:()=>ee(W+1),children:"下一页"}),(0,t.jsx)(m.Button,{variant:"outline",size:"sm",disabled:W===ej,onClick:()=>ee(ej),children:"末页"})]})]}),(0,t.jsx)(b.JsonViewerModal,{open:et,title:ea,content:en,onClose:()=>es(!1)}),(0,t.jsx)(f.Modal,{open:null!==R,title:R?`消费者详情: ${R.queue_name}`:"消费者详情",onClose:()=>{D(null),A(null)},footer:(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)(m.Button,{variant:"outline",onClick:()=>D(null),children:"关闭"})}),children:R?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:"队列参数"}),(0,t.jsx)("pre",{className:"mt-2 rounded-2xl bg-[hsl(var(--sand-2))] p-4 text-xs text-[hsl(var(--ink))] overflow-auto max-h-48",children:JSON.stringify(R.queue_params??{},null,2)})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:["活跃消费者 (",I?.length??R.active_consumers?.length??0,")"]}),I?(0,t.jsx)("pre",{className:"mt-2 rounded-2xl bg-[hsl(var(--sand-2))] p-4 text-xs text-[hsl(var(--ink))] overflow-auto max-h-80",children:JSON.stringify(I,null,2)}):(0,t.jsx)("p",{className:"mt-2 text-sm text-[hsl(var(--ink-muted))]",children:"正在加载消费者详情..."})]})]}):null}),(0,t.jsx)(f.Modal,{open:null!==O,title:"",onClose:()=>L(null),size:"xl",footer:(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)(m.Button,{variant:"outline",onClick:()=>L(null),children:"✕ 关闭"})}),children:O&&(0,t.jsx)(y.QueueTimeSeriesChart,{queueName:O.queue_name,data:V,loading:X,startTime:Z,endTime:Y,sampleCount:U,sampleOptions:S,onStartTimeChange:Q,onEndTimeChange:G,onSampleCountChange:H,onRefresh:()=>eN()})})]})})}e.s(["default",()=>M],38645)}]);