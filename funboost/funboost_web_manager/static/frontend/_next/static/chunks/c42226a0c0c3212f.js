(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,34084,e=>{"use strict";var s=e.i(43476),t=e.i(7670);function a({title:e,subtitle:a,actions:r,className:l}){return(0,s.jsxs)("div",{className:(0,t.default)("flex flex-wrap items-start justify-between gap-4",l),children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-display text-lg text-[hsl(var(--ink))]",children:e}),a?(0,s.jsx)("p",{className:"text-sm text-[hsl(var(--ink-muted))]",children:a}):null]}),r?(0,s.jsx)("div",{className:"flex items-center gap-2",children:r}):null]})}e.s(["SectionHeader",()=>a])},27612,e=>{"use strict";let s=(0,e.i(75254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>s],27612)},96640,e=>{"use strict";var s=e.i(43476),t=e.i(7670);let a={neutral:"bg-[hsl(var(--sand-2))] text-[hsl(var(--ink))]",success:"bg-[hsl(var(--success))]/15 text-[hsl(var(--success))]",warning:"bg-[hsl(var(--warning))]/15 text-[hsl(var(--warning))]",danger:"bg-[hsl(var(--danger))]/15 text-[hsl(var(--danger))]",info:"bg-[hsl(var(--info))]/15 text-[hsl(var(--info))]"};function r({tone:e="neutral",className:r,...l}){return(0,s.jsx)("span",{className:(0,t.default)("inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold uppercase tracking-[0.12em]",a[e],r),...l})}e.s(["Badge",()=>r])},59544,e=>{"use strict";var s=e.i(43476),t=e.i(7670);let a={primary:"bg-[hsl(var(--accent))] text-white hover:bg-[hsl(var(--accent-2))]",secondary:"bg-[hsl(var(--accent-2))] text-white hover:bg-[hsl(var(--accent))]",outline:"border border-[hsl(var(--line))] text-[hsl(var(--ink))] hover:border-[hsl(var(--accent))] hover:text-[hsl(var(--accent))]",ghost:"text-[hsl(var(--ink))] hover:bg-[hsl(var(--sand-2))]",danger:"bg-[hsl(var(--danger))] text-white hover:bg-[hsl(var(--danger))]/90",success:"bg-[hsl(var(--success))] text-white hover:bg-[hsl(var(--success))]/90",warning:"bg-[hsl(var(--warning))] text-white hover:bg-[hsl(var(--warning))]/90"},r={sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-5 py-2.5 text-sm"};function l({variant:e="primary",size:l="md",className:n,...i}){return(0,s.jsx)("button",{className:(0,t.default)("inline-flex items-center justify-center gap-2 rounded-full font-medium transition-colors duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--accent))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--sand))]",a[e],r[l],n),...i})}e.s(["Button",()=>l])},39964,e=>{"use strict";var s=e.i(43476),t=e.i(7670);function a({glass:e=!0,className:a,...r}){return(0,s.jsx)("div",{className:(0,t.default)("rounded-3xl p-6",e?"glass-card":"bg-[hsl(var(--card))] border border-[hsl(var(--line))]",a),...r})}e.s(["Card",()=>a])},84030,e=>{"use strict";var s=e.i(71645),t=e.i(93302);function a(e,a){let{hasPermission:r}=(0,t.usePermissions)();return(0,s.useMemo)(()=>({canCreate:r(`${e}:create`,a),canRead:r(`${e}:read`,a),canUpdate:r(`${e}:update`,a),canDelete:r(`${e}:delete`,a),canExecute:r(`${e}:execute`,a),canExport:r(`${e}:export`,a)}),[e,a,r])}e.s(["useActionPermissions",()=>a])},78894,e=>{"use strict";let s=(0,e.i(75254).default)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["AlertTriangle",()=>s],78894)},69775,e=>{"use strict";let s=(0,e.i(75254).default)("cloud-download",[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]]);e.s(["CloudDownload",()=>s],69775)},95468,e=>{"use strict";let s=(0,e.i(75254).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>s],95468)},52008,e=>{"use strict";let s=(0,e.i(75254).default)("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]);e.s(["Layers",()=>s],52008)},202,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(95468),r=e.i(69775),l=e.i(52008),n=e.i(16715),i=e.i(75254);let c=(0,i.default)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),d=(0,i.default)("square-check-big",[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var o=e.i(27612),h=e.i(78894),m=e.i(96640),x=e.i(59544),u=e.i(39964),v=e.i(34084),p=e.i(9165),g=e.i(84030);function j(){let[e,i]=(0,t.useState)(""),[j,f]=(0,t.useState)([]),[b,y]=(0,t.useState)([]),[w,N]=(0,t.useState)(null),[k,C]=(0,t.useState)(!1),[S,$]=(0,t.useState)(!1),[z,_]=(0,t.useState)(!1),[B,E]=(0,t.useState)(!1),[M,P]=(0,t.useState)(null),[R,T]=(0,t.useState)(!1),[A,F]=(0,t.useState)(new Set),[H,O]=(0,t.useState)(!1),{canDelete:q}=(0,g.useActionPermissions)("project");(0,t.useEffect)(()=>{_(!0)},[]);let D=(0,t.useCallback)(async()=>{C(!0),E(!1),P(null);try{let e=await (0,p.funboostFetch)("/funboost/get_care_project_name",{cache:"no-store"});i(e?.care_project_name||"");try{let e=await (0,p.funboostFetch)("/funboost/get_all_project_names",{cache:"no-store"}),s=e?.project_names||[];f(s),E(!0),console.log("[CareProject] Redis projects loaded:",s)}catch(e){console.error("[CareProject] Failed to load Redis projects:",e),f([]),P(e instanceof Error?e.message:"无法连接 Redis"),E(!0)}let s=await (0,p.apiFetch)("/api/user/projects",{cache:"no-store"});s.success&&s.data&&(y(s.data.projects),console.log("[CareProject] User authorized DB projects loaded:",s.data.projects.map(e=>e.code)))}catch(e){N({type:"error",message:e instanceof Error?e.message:"加载项目失败。"})}finally{C(!1)}},[]);(0,t.useEffect)(()=>{D()},[D]);let L=async e=>{if(!R){N(null);try{await (0,p.funboostFetch)("/funboost/set_care_project_name",{method:"POST",json:{care_project_name:e}}),i(e),N({type:"success",message:e?`已切换到项目: ${e}`:"已切换到全部项目"}),window.dispatchEvent(new CustomEvent("careProjectChanged",{detail:{careProjectName:e}}))}catch(e){N({type:"error",message:e instanceof Error?e.message:"更新失败。"})}}},U=async()=>{if(!S){$(!0),N(null);try{let e=await (0,p.apiFetch)("/admin/api/projects/sync",{method:"POST"});if(e.success&&e.data){let{created_count:s,existing_count:t,message:a}=e.data;N({type:"success",message:a||`同步完成：新建 ${s} 个项目，已存在 ${t} 个项目`}),await D()}else throw Error(e.error||"同步失败")}catch(e){N({type:"error",message:e instanceof Error?e.message:"同步失败"})}finally{$(!1)}}},V=()=>{let e=b.filter(e=>"default"!==e.code&&!j.includes(e.code));return console.log("[CareProject] Empty projects (can delete):",e.map(e=>e.code)),e},K=async()=>{if(0!==A.size&&confirm(`确定要删除选中的 ${A.size} 个项目吗？
此操作不可撤销！`)){O(!0),N(null);try{let e=await (0,p.apiFetch)("/admin/api/projects/batch-delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_ids:Array.from(A)})});if(e.success&&e.data){let{deleted_count:s,failed_count:t,failed_projects:a}=e.data;if(t>0){let e=a.map(e=>`${e.name}: ${e.error}`).join("\n");N({type:"info",message:`删除完成：成功 ${s} 个，失败 ${t} 个
${e}`})}else N({type:"success",message:`成功删除 ${s} 个项目`});T(!1),F(new Set),await D()}else throw Error(e.error||"删除失败")}catch(e){N({type:"error",message:e instanceof Error?e.message:"删除失败"})}finally{O(!1)}}},J=V();return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsx)(v.SectionHeader,{title:"关注项目",subtitle:"限定监控范围到指定项目。",actions:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[z&&q&&(0,s.jsxs)(x.Button,{variant:R?"primary":"outline",size:"sm",onClick:()=>{if(!R){if(!B)return void N({type:"error",message:"请等待数据加载完成后再进行删除操作"});if(M)return void N({type:"error",message:`无法进入删除模式：${M}。请刷新页面重试。`})}T(!R),F(new Set)},disabled:!B||k,title:B?M?"Redis 连接失败":"多选删除空项目":"等待数据加载...",children:[R?(0,s.jsx)(d,{className:"h-4 w-4"}):(0,s.jsx)(c,{className:"h-4 w-4"}),R?"取消选择":"多选删除"]}),(0,s.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:U,disabled:S||R,title:"将 Redis 中的项目同步到数据库",children:[(0,s.jsx)(r.CloudDownload,{className:`h-4 w-4 ${S?"animate-pulse":""}`}),S?"同步中...":"同步到数据库"]}),(0,s.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:D,disabled:k||R,children:[(0,s.jsx)(n.RefreshCw,{className:`h-4 w-4 ${k?"animate-spin":""}`}),"刷新"]})]})}),w?(0,s.jsx)(u.Card,{className:`border text-sm whitespace-pre-wrap ${"success"===w.type?"border-[hsl(var(--success))]/30 bg-[hsl(var(--success))]/10 text-[hsl(var(--success))]":"error"===w.type?"border-[hsl(var(--danger))]/30 bg-[hsl(var(--danger))]/10 text-[hsl(var(--danger))]":"border-[hsl(var(--accent))]/30 bg-[hsl(var(--accent))]/10 text-[hsl(var(--accent-2))]"}`,children:w.message}):null,M&&!w&&(0,s.jsx)(u.Card,{className:"border-[hsl(var(--warning))]/30 bg-[hsl(var(--warning))]/10",children:(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-[hsl(var(--warning))]",children:[(0,s.jsx)(h.AlertTriangle,{className:"h-4 w-4"}),(0,s.jsxs)("span",{children:["Redis 连接失败：",M,"。删除功能可能不可用。"]})]})}),R&&(0,s.jsxs)(u.Card,{className:"border-[hsl(var(--warning))]/30 bg-[hsl(var(--warning))]/10",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(h.AlertTriangle,{className:"h-5 w-5 text-[hsl(var(--warning))]"}),(0,s.jsxs)("span",{className:"text-sm font-medium text-[hsl(var(--ink))]",children:["已选择 ",A.size," 个项目"]}),J.length>0&&(0,s.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:()=>{F(new Set(V().map(e=>e.id)))},children:["全选空项目 (",J.length,")"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(x.Button,{variant:"outline",size:"sm",onClick:()=>F(new Set),disabled:0===A.size,children:"清除选择"}),(0,s.jsxs)(x.Button,{variant:"primary",size:"sm",onClick:K,disabled:0===A.size||H,className:"bg-[hsl(var(--danger))] hover:bg-[hsl(var(--danger))]/90",children:[(0,s.jsx)(o.Trash2,{className:`h-4 w-4 ${H?"animate-pulse":""}`}),H?"删除中...":`删除 (${A.size})`]})]})]}),(0,s.jsx)("p",{className:"mt-2 text-xs text-[hsl(var(--ink-muted))]",children:"提示：只能删除空项目（没有队列的项目）。有队列的项目显示为灰色，不可选择。默认项目不可删除。"})]}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsxs)(u.Card,{children:[(0,s.jsx)(v.SectionHeader,{title:"当前范围",subtitle:"应用于所有监控页面。"}),(0,s.jsxs)("div",{className:"mt-4 flex items-center gap-3",children:[(0,s.jsx)(m.Badge,{tone:e?"info":"neutral",children:e||"全部项目"}),(0,s.jsx)("span",{className:"text-sm text-[hsl(var(--ink-muted))]",children:e?"已启用项目筛选":"显示所有项目数据"})]})]}),(0,s.jsxs)(u.Card,{children:[(0,s.jsx)(v.SectionHeader,{title:"快捷操作",subtitle:"一键切换为全部项目。"}),(0,s.jsxs)("div",{className:"mt-4 flex items-center gap-2",children:[(0,s.jsx)(x.Button,{variant:e?"primary":"outline",size:"sm",onClick:()=>L(""),disabled:!e||R,children:"清除筛选"}),e&&(0,s.jsxs)("span",{className:"text-xs text-[hsl(var(--ink-muted))]",children:["当前筛选: ",e]})]})]})]}),(0,s.jsxs)(u.Card,{children:[(0,s.jsx)(v.SectionHeader,{title:"可选项目",subtitle:`共 ${j.length} 个 Redis 项目，${b.length} 个数据库项目。项目来源于队列任务配置中的 project_name 参数。`}),k?(0,s.jsxs)("div",{className:"mt-6 flex items-center justify-center py-8",children:[(0,s.jsx)(n.RefreshCw,{className:"h-6 w-6 animate-spin text-[hsl(var(--accent))]"}),(0,s.jsx)("span",{className:"ml-2 text-sm text-[hsl(var(--ink-muted))]",children:"加载中..."})]}):0===j.length&&0===b.length?(0,s.jsxs)("div",{className:"mt-6 rounded-2xl border border-dashed border-[hsl(var(--line))] bg-[hsl(var(--sand-2))]/50 px-6 py-8 text-center",children:[(0,s.jsx)(l.Layers,{className:"mx-auto h-8 w-8 text-[hsl(var(--ink-muted))]"}),(0,s.jsx)("p",{className:"mt-3 text-sm font-medium text-[hsl(var(--ink))]",children:"暂无项目"}),(0,s.jsx)("p",{className:"mt-1 text-xs text-[hsl(var(--ink-muted))]",children:"在队列任务的 @boost 装饰器中配置 project_name 参数后，项目会自动出现在这里。"})]}):(0,s.jsxs)("div",{className:"mt-6 grid gap-3 md:grid-cols-2 xl:grid-cols-3",children:[!R&&(0,s.jsxs)("button",{onClick:()=>L(""),className:`flex items-center justify-between rounded-2xl border px-4 py-3 text-left transition ${!e?"border-[hsl(var(--accent-2))] bg-[hsl(var(--accent-2))]/10":"border-[hsl(var(--line))] bg-[hsl(var(--card))]/80 hover:border-[hsl(var(--accent))]"}`,children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold text-[hsl(var(--ink))]",children:"全部项目"}),(0,s.jsx)("p",{className:"text-xs text-[hsl(var(--ink-muted))]",children:"显示所有队列数据"})]}),e?null:(0,s.jsx)(a.CheckCircle2,{className:"h-4 w-4 text-[hsl(var(--accent-2))]"})]}),b.map(e=>e.code).filter(e=>"default"!==e).map(t=>{let r,l=e===t,n=(r=b.find(e=>e.code===t),r?.id||null),i=j.includes(t),o=!!n&&A.has(n),h=R&&n&&!i;return(0,s.jsxs)("button",{onClick:()=>{if(R){let e;h&&n&&((e=new Set(A)).has(n)?e.delete(n):e.add(n),F(e))}else L(t)},disabled:R&&!h,className:`flex items-center justify-between rounded-2xl border px-4 py-3 text-left transition ${R?h?o?"border-[hsl(var(--danger))] bg-[hsl(var(--danger))]/10":"border-[hsl(var(--line))] bg-[hsl(var(--card))]/80 hover:border-[hsl(var(--danger))]/50":"border-[hsl(var(--line))]/50 bg-[hsl(var(--sand-2))]/30 opacity-50 cursor-not-allowed":l?"border-[hsl(var(--accent-2))] bg-[hsl(var(--accent-2))]/10":"border-[hsl(var(--line))] bg-[hsl(var(--card))]/80 hover:border-[hsl(var(--accent))]"}`,children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("p",{className:"font-semibold text-[hsl(var(--ink))] truncate",children:t}),!i&&(0,s.jsx)(m.Badge,{tone:"warning",className:"text-xs",children:"空"}),!n&&(0,s.jsx)(m.Badge,{tone:"neutral",className:"text-xs",children:"未同步"})]}),(0,s.jsx)("p",{className:"text-xs text-[hsl(var(--ink-muted))]",children:R?i?"有队列，不可删除":"可删除":"点击切换"})]}),R?h?o?(0,s.jsx)(d,{className:"h-4 w-4 text-[hsl(var(--danger))]"}):(0,s.jsx)(c,{className:"h-4 w-4 text-[hsl(var(--ink-muted))]"}):null:l?(0,s.jsx)(a.CheckCircle2,{className:"h-4 w-4 text-[hsl(var(--accent-2))]"}):null]},t)})]})]}),(0,s.jsxs)(u.Card,{className:"bg-[hsl(var(--sand-2))]/50",children:[(0,s.jsx)(v.SectionHeader,{title:"使用说明",subtitle:"关于项目筛选功能。"}),(0,s.jsxs)("div",{className:"mt-4 space-y-3 text-sm text-[hsl(var(--ink-muted))]",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{className:"text-[hsl(var(--ink))]",children:"项目来源："}),"项目名称来自队列任务配置中的 ",(0,s.jsx)("code",{className:"rounded bg-[hsl(var(--card))] px-1.5 py-0.5 text-xs",children:"project_name"})," 参数。"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{className:"text-[hsl(var(--ink))]",children:"筛选范围："}),"选择项目后，队列运维、消费速率、运行中消费者等页面将只显示该项目的数据。"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{className:"text-[hsl(var(--ink))]",children:"同步到数据库："}),'点击"同步到数据库"按钮可将 Redis 中的项目同步到数据库，用于项目管理和权限分配。']}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{className:"text-[hsl(var(--ink))]",children:"删除空项目："}),'点击"多选删除"可以批量删除没有队列的空项目。有队列的项目不可删除。']})]})]})]})})}e.s(["default",()=>j],202)}]);