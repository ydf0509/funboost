(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,96640,e=>{"use strict";var s=e.i(43476),t=e.i(7670);let a={neutral:"bg-[hsl(var(--sand-2))] text-[hsl(var(--ink))]",success:"bg-[hsl(var(--success))]/15 text-[hsl(var(--success))]",warning:"bg-[hsl(var(--warning))]/15 text-[hsl(var(--warning))]",danger:"bg-[hsl(var(--danger))]/15 text-[hsl(var(--danger))]",info:"bg-[hsl(var(--info))]/15 text-[hsl(var(--info))]"};function r({tone:e="neutral",className:r,...l}){return(0,s.jsx)("span",{className:(0,t.default)("inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold uppercase tracking-[0.12em]",a[e],r),...l})}e.s(["Badge",()=>r])},27612,e=>{"use strict";let s=(0,e.i(75254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>s],27612)},32098,37727,e=>{"use strict";var s=e.i(43476),t=e.i(71645);let a=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>a],37727);var r=e.i(7670),l=e.i(59544);let n={sm:"max-w-md",md:"max-w-xl",lg:"max-w-3xl",xl:"max-w-5xl"};function i({open:e,title:i,onClose:c,children:o,footer:d,size:u="lg",subtitle:h}){let m=(0,t.useCallback)(e=>{"Escape"===e.key&&c()},[c]);return((0,t.useEffect)(()=>{if(e)return document.body.style.overflow="hidden",document.addEventListener("keydown",m),()=>{document.body.style.overflow="",document.removeEventListener("keydown",m)}},[e,m]),e)?(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4 py-10",role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-md transition-opacity duration-300 ease-out",onClick:c,"aria-hidden":"true"}),(0,s.jsxs)("div",{className:(0,r.default)("relative w-full rounded-3xl p-8 shadow-2xl","bg-[hsl(var(--card))]/95 backdrop-blur-xl","border border-[hsl(var(--line))]/50","animate-in fade-in-0 zoom-in-95 duration-300 ease-out",n[u]),children:[(0,s.jsxs)("div",{className:"flex items-start justify-between border-b border-[hsl(var(--line))]/60 pb-4 mb-2",children:[(0,s.jsxs)("div",{className:"flex-1 pr-4",children:[(0,s.jsx)("h2",{id:"modal-title",className:"font-display text-xl font-semibold text-[hsl(var(--ink))] tracking-tight",children:i}),h&&(0,s.jsx)("p",{className:"mt-1 text-sm text-[hsl(var(--ink-muted))]",children:h})]}),(0,s.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:c,className:"cursor-pointer -mr-2 -mt-1 hover:bg-[hsl(var(--sand-2))] rounded-xl transition-colors duration-200","aria-label":"关闭弹窗",children:(0,s.jsx)(a,{className:"h-5 w-5"})})]}),(0,s.jsx)("div",{className:(0,r.default)("max-h-[65vh] overflow-y-auto py-4 text-sm text-[hsl(var(--ink))]","scrollbar-thin scrollbar-thumb-[hsl(var(--line))] scrollbar-track-transparent","pr-2 -mr-2"),children:o}),d&&(0,s.jsx)("div",{className:"border-t border-[hsl(var(--line))]/60 pt-5 mt-2",children:d})]})]}):null}e.s(["Modal",()=>i],32098)},86536,e=>{"use strict";let s=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>s],86536)},63209,e=>{"use strict";let s=(0,e.i(75254).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>s],63209)},39616,e=>{"use strict";let s=(0,e.i(75254).default)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Settings",()=>s],39616)},31343,e=>{"use strict";let s=(0,e.i(75254).default)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);e.s(["Play",()=>s],31343)},52571,95242,e=>{"use strict";var s=e.i(75254);let t=(0,s.default)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);e.s(["Info",()=>t],52571);let a=(0,s.default)("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]]);e.s(["Pause",()=>a],95242)},68402,e=>{"use strict";var s=e.i(71645);function t(e,a=!1,r=1e4){var l,n;let i,[c,o]=(0,s.useState)(a),[d,u]=(0,s.useState)(r),h=(0,s.useCallback)(()=>o(e=>!e),[]);return l=()=>{c&&e()},n=c?d:null,i=(0,s.useRef)(l),(0,s.useEffect)(()=>{i.current=l},[l]),(0,s.useEffect)(()=>{if(null===n)return;let e=setInterval(()=>i.current(),n);return()=>clearInterval(e)},[n]),{enabled:c,toggle:h,setEnabled:o,intervalMs:d,setIntervalMs:u}}e.s(["useAutoRefresh",()=>t],68402)},75379,e=>{"use strict";function s(e){return new Intl.NumberFormat("zh-CN").format(e)}function t(e){if(!e)return"-";let s=new Date("number"==typeof e?1e3*e:e);return Number.isNaN(s.getTime())?"-":new Intl.DateTimeFormat("zh-CN",{dateStyle:"medium",timeStyle:"short"}).format(s)}function a(e){let s=e=>String(e).padStart(2,"0");return`${e.getFullYear()}-${s(e.getMonth()+1)}-${s(e.getDate())}T${s(e.getHours())}:${s(e.getMinutes())}`}function r(e){if(!e)return"";let s=e.includes("T")?e.replace("T"," "):e;return 16===s.length?`${s}:00`:s}e.s(["formatDateTime",()=>t,"formatNumber",()=>s,"toBackendDateTime",()=>r,"toDateTimeInputValue",()=>a])},57998,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(64659),r=e.i(63059),l=e.i(74886),n=e.i(43531),i=e.i(98361),c=e.i(26336),o=e.i(32098),d=e.i(59544);function u({data:e,path:l="",level:n=0,defaultExpanded:i=!0}){let[c,o]=(0,t.useState)(i);if(null===e)return(0,s.jsx)("span",{className:"text-[hsl(var(--danger))]",children:"null"});if("boolean"==typeof e)return(0,s.jsx)("span",{className:"text-[hsl(var(--warning))]",children:e.toString()});if("number"==typeof e)return(0,s.jsx)("span",{className:"text-[hsl(var(--success))]",children:e});if("string"==typeof e)return(0,s.jsxs)("span",{className:"text-[hsl(var(--info))]",children:['"',e,'"']});if(Array.isArray(e))return 0===e.length?(0,s.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:"[]"}):(0,s.jsxs)("span",{children:[(0,s.jsx)("button",{onClick:()=>o(!c),className:"inline-flex items-center text-[hsl(var(--ink-muted))] hover:text-[hsl(var(--accent))] focus:outline-none",children:c?(0,s.jsx)(a.ChevronDown,{className:"h-3 w-3"}):(0,s.jsx)(r.ChevronRight,{className:"h-3 w-3"})}),(0,s.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:"["}),(0,s.jsxs)("span",{className:"text-[hsl(var(--ink-muted))] italic ml-1",children:[e.length," items"]}),c&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"ml-4 pl-3 border-l border-[hsl(var(--line))]",children:e.map((t,a)=>(0,s.jsxs)("div",{className:"leading-6",children:[(0,s.jsx)(u,{data:t,path:`${l}[${a}]`,level:n+1,defaultExpanded:i}),a<e.length-1&&(0,s.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:","})]},`${l}[${a}]`))}),(0,s.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:"]"})]})]});if("object"==typeof e){let t=Object.entries(e);return 0===t.length?(0,s.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:"{}"}):(0,s.jsxs)("span",{children:[(0,s.jsx)("button",{onClick:()=>o(!c),className:"inline-flex items-center text-[hsl(var(--ink-muted))] hover:text-[hsl(var(--accent))] focus:outline-none",children:c?(0,s.jsx)(a.ChevronDown,{className:"h-3 w-3"}):(0,s.jsx)(r.ChevronRight,{className:"h-3 w-3"})}),(0,s.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:"{"}),(0,s.jsxs)("span",{className:"text-[hsl(var(--ink-muted))] italic ml-1",children:[t.length," keys"]}),c&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"ml-4 pl-3 border-l border-[hsl(var(--line))]",children:t.map(([e,a],r)=>(0,s.jsxs)("div",{className:"leading-6",children:[(0,s.jsxs)("span",{className:"text-[hsl(var(--accent-2))]",children:['"',e,'"']}),(0,s.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:": "}),(0,s.jsx)(u,{data:a,path:`${l}.${e}`,level:n+1,defaultExpanded:i}),r<t.length-1&&(0,s.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:","})]},`${l}.${e}`))}),(0,s.jsx)("span",{className:"text-[hsl(var(--ink-muted))]",children:"}"})]})]})}return(0,s.jsx)("span",{className:"text-[hsl(var(--ink))]",children:String(e)})}function h({open:e,title:a,content:r,onClose:h}){let[m,x]=(0,t.useState)(!1),[p,v]=(0,t.useState)(!0),{data:f,error:g}=(0,t.useMemo)(()=>(function(e){if(!e||""===e.trim()||"-"===e)return{data:null,error:"No content"};try{return{data:JSON.parse(e),error:null}}catch{try{let s=JSON.parse(`"${e.replace(/"/g,'\\"')}"`);return{data:JSON.parse(s),error:null}}catch{return{data:e,error:null}}}})(r),[r]),j=(0,t.useMemo)(()=>{if(g||null===f)return r;try{return JSON.stringify(f,null,2)}catch{return r}},[f,g,r]),b=(0,t.useCallback)(async()=>{try{await navigator.clipboard.writeText(j),x(!0),setTimeout(()=>x(!1),2e3)}catch{let e=document.createElement("textarea");e.value=j,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),x(!0),setTimeout(()=>x(!1),2e3)}},[j]),y=null===g&&null!==f&&"object"==typeof f;return(0,s.jsx)(o.Modal,{open:e,title:a,onClose:h,size:"xl",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2 pb-3 border-b border-[hsl(var(--line))]",children:[(0,s.jsx)("div",{className:"flex items-center gap-2",children:y&&(0,s.jsx)(d.Button,{variant:"outline",size:"sm",onClick:()=>v(!p),children:p?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.Minimize2,{className:"h-3 w-3"}),"折叠全部"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Maximize2,{className:"h-3 w-3"}),"展开全部"]})})}),(0,s.jsx)(d.Button,{variant:m?"primary":"outline",size:"sm",onClick:b,children:m?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Check,{className:"h-3 w-3"}),"已复制"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Copy,{className:"h-3 w-3"}),"复制"]})})]}),(0,s.jsx)("div",{className:"rounded-xl bg-[hsl(var(--sand-2))] p-4 overflow-auto max-h-[60vh]",children:y?(0,s.jsx)("pre",{className:"font-mono text-sm whitespace-pre-wrap break-all",children:(0,s.jsx)(u,{data:f,defaultExpanded:p},p?"expanded":"collapsed")}):(0,s.jsx)("pre",{className:"font-mono text-sm whitespace-pre-wrap break-all text-[hsl(var(--ink))]",children:r||"-"})})]})})}e.s(["JsonViewerModal",()=>h])},58700,e=>{"use strict";var s=e.i(43476),t=e.i(7670),a=e.i(75254);let r=(0,a.default)("chevron-first",[["path",{d:"m17 18-6-6 6-6",key:"1yerx2"}],["path",{d:"M7 6v12",key:"1p53r6"}]]),l=(0,a.default)("chevron-last",[["path",{d:"m7 18 6-6-6-6",key:"lwmzdw"}],["path",{d:"M17 6v12",key:"1o0aio"}]]);var n=e.i(73375),i=e.i(63059),c=e.i(71645);let o=[20,50,100,200];function d({currentPage:e,pageSize:t,totalCount:a,pageSizeOptions:d=o,onPageChange:h,onPageSizeChange:m,loading:x=!1}){let p=Math.max(1,Math.ceil(a/t)),v=Math.max(0,Math.min(e,p-1)),f=0===a?0:v*t+1,g=Math.min((v+1)*t,a),j=v>0,b=v<p-1,[y,k]=(0,c.useState)(""),N=(0,c.useCallback)(()=>{if(!y||x)return;let e=parseInt(y,10);isNaN(e)||e<1||e>p||h(e-1),k("")},[y,x,p,h]);return(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4 py-4",children:[(0,s.jsx)("div",{className:"text-sm text-[hsl(var(--ink-muted))]",children:0===a?(0,s.jsx)("span",{children:"共 0 条记录"}):(0,s.jsxs)("span",{children:["显示 ",f,"-",g," 条，共 ",a.toLocaleString()," 条"]})}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-xs text-[hsl(var(--ink-muted))]",children:"每页"}),(0,s.jsx)("select",{value:t,onChange:e=>{m(parseInt(e.target.value,10))},disabled:x,className:"rounded-lg border border-[hsl(var(--line))] bg-[hsl(var(--card))]/80 px-2 py-1 text-sm text-[hsl(var(--ink))] outline-none transition focus:border-[hsl(var(--accent))] disabled:opacity-50",children:d.map(e=>(0,s.jsx)("option",{value:e,children:e},e))}),(0,s.jsx)("span",{className:"text-xs text-[hsl(var(--ink-muted))]",children:"条"})]}),(0,s.jsxs)("div",{className:"text-sm text-[hsl(var(--ink-muted))]",children:["第 ",v+1," / ",p," 页"]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(u,{onClick:()=>{j&&!x&&h(0)},disabled:!j||x,title:"首页",children:(0,s.jsx)(r,{className:"h-4 w-4"})}),(0,s.jsx)(u,{onClick:()=>{j&&!x&&h(v-1)},disabled:!j||x,title:"上一页",children:(0,s.jsx)(n.ChevronLeft,{className:"h-4 w-4"})}),(0,s.jsx)(u,{onClick:()=>{b&&!x&&h(v+1)},disabled:!b||x,title:"下一页",children:(0,s.jsx)(i.ChevronRight,{className:"h-4 w-4"})}),(0,s.jsx)(u,{onClick:()=>{b&&!x&&h(p-1)},disabled:!b||x,title:"末页",children:(0,s.jsx)(l,{className:"h-4 w-4"})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-xs text-[hsl(var(--ink-muted))]",children:"跳至"}),(0,s.jsx)("input",{type:"text",value:y,onChange:e=>{k(e.target.value.replace(/[^0-9]/g,""))},onKeyDown:e=>{"Enter"===e.key&&N()},onBlur:N,disabled:x||p<=1,placeholder:String(v+1),className:"w-14 rounded-lg border border-[hsl(var(--line))] bg-[hsl(var(--card))]/80 px-2 py-1 text-center text-sm text-[hsl(var(--ink))] outline-none transition focus:border-[hsl(var(--accent))] disabled:opacity-50"}),(0,s.jsx)("span",{className:"text-xs text-[hsl(var(--ink-muted))]",children:"页"})]})]})]})}function u({onClick:e,disabled:a,title:r,children:l}){return(0,s.jsx)("button",{onClick:e,disabled:a,title:r,className:(0,t.default)("inline-flex h-8 w-8 items-center justify-center rounded-lg border transition-colors",a?"cursor-not-allowed border-[hsl(var(--line))] bg-[hsl(var(--sand-2))] text-[hsl(var(--ink-muted))]/50":"border-[hsl(var(--line))] bg-[hsl(var(--card))] text-[hsl(var(--ink-muted))] hover:border-[hsl(var(--accent))] hover:text-[hsl(var(--accent))]"),children:l})}e.s(["Pagination",()=>d],58700)},74886,98361,26336,e=>{"use strict";var s=e.i(75254);let t=(0,s.default)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);e.s(["Copy",()=>t],74886);let a=(0,s.default)("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]);e.s(["Maximize2",()=>a],98361);let r=(0,s.default)("minimize-2",[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]]);e.s(["Minimize2",()=>r],26336)},63059,e=>{"use strict";let s=(0,e.i(75254).default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["ChevronRight",()=>s],63059)},43531,e=>{"use strict";let s=(0,e.i(75254).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>s],43531)},38171,e=>{"use strict";var s=e.i(43476),t=e.i(7670),a=e.i(39964);let r={success:{border:"border-l-4 border-l-[hsl(var(--success))]",value:"text-[hsl(var(--success))]",bg:"bg-[hsl(var(--success)/0.05)]"},danger:{border:"border-l-4 border-l-[hsl(var(--danger))]",value:"text-[hsl(var(--danger))]",bg:"bg-[hsl(var(--danger)/0.05)]"},warning:{border:"border-l-4 border-l-[hsl(var(--warning))]",value:"text-[hsl(var(--warning))]",bg:"bg-[hsl(var(--warning)/0.05)]"},info:{border:"border-l-4 border-l-[hsl(var(--info))]",value:"text-[hsl(var(--info))]",bg:"bg-[hsl(var(--info)/0.05)]"},neutral:{border:"",value:"text-[hsl(var(--ink))]",bg:""}};function l({label:e,value:l,helper:n,tone:i="neutral"}){let c=r[i];return(0,s.jsxs)(a.Card,{className:(0,t.default)("flex flex-col gap-2 transition-all duration-200 hover:shadow-lg cursor-default",c.border,c.bg),children:[(0,s.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.18em] text-[hsl(var(--ink-muted))]",children:e}),(0,s.jsx)("div",{className:(0,t.default)("font-display text-2xl",c.value),children:l}),n?(0,s.jsx)("p",{className:"text-xs text-[hsl(var(--ink-muted))]",children:n}):null]})}e.s(["StatCard",()=>l])},40803,e=>{"use strict";var s=e.i(43476),t=e.i(39964);function a({title:e,subtitle:a,action:r}){return(0,s.jsxs)(t.Card,{className:"flex flex-col items-start gap-3",children:[(0,s.jsx)("h3",{className:"font-display text-lg text-[hsl(var(--ink))]",children:e}),a?(0,s.jsx)("p",{className:"text-sm text-[hsl(var(--ink-muted))]",children:a}):null,r?(0,s.jsx)("div",{children:r}):null]})}e.s(["EmptyState",()=>a])},3812,e=>{"use strict";var s=e.i(43476),t=e.i(7670);function a({className:e,...a}){return(0,s.jsx)("input",{className:(0,t.default)("w-full rounded-2xl border border-[hsl(var(--line))] bg-[hsl(var(--card))]/80 px-4 py-2 text-sm text-[hsl(var(--ink))] shadow-sm outline-none transition placeholder:text-[hsl(var(--ink-muted))] focus:border-[hsl(var(--accent))] focus:ring-2 focus:ring-[hsl(var(--accent))]/20",e),...a})}e.s(["Input",()=>a])},59544,e=>{"use strict";var s=e.i(43476),t=e.i(7670);let a={primary:"bg-[hsl(var(--accent))] text-white hover:bg-[hsl(var(--accent-2))]",secondary:"bg-[hsl(var(--accent-2))] text-white hover:bg-[hsl(var(--accent))]",outline:"border border-[hsl(var(--line))] text-[hsl(var(--ink))] hover:border-[hsl(var(--accent))] hover:text-[hsl(var(--accent))]",ghost:"text-[hsl(var(--ink))] hover:bg-[hsl(var(--sand-2))]",danger:"bg-[hsl(var(--danger))] text-white hover:bg-[hsl(var(--danger))]/90",success:"bg-[hsl(var(--success))] text-white hover:bg-[hsl(var(--success))]/90",warning:"bg-[hsl(var(--warning))] text-white hover:bg-[hsl(var(--warning))]/90"},r={sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-5 py-2.5 text-sm"};function l({variant:e="primary",size:l="md",className:n,...i}){return(0,s.jsx)("button",{className:(0,t.default)("inline-flex items-center justify-center gap-2 rounded-full font-medium transition-colors duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--accent))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--sand))]",a[e],r[l],n),...i})}e.s(["Button",()=>l])},39964,e=>{"use strict";var s=e.i(43476),t=e.i(7670);function a({glass:e=!0,className:a,...r}){return(0,s.jsx)("div",{className:(0,t.default)("rounded-3xl p-6",e?"glass-card":"bg-[hsl(var(--card))] border border-[hsl(var(--line))]",a),...r})}e.s(["Card",()=>a])},88092,e=>{"use strict";let s=(0,e.i(75254).default)("shield-x",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m14.5 9.5-5 5",key:"17q4r4"}],["path",{d:"m9.5 9.5 5 5",key:"18nt4w"}]]);e.s(["ShieldX",()=>s],88092)},71689,e=>{"use strict";let s=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>s],71689)},62162,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(93302),r=e.i(80580),l=e.i(88092),n=e.i(71689);let i=(0,e.i(75254).default)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]);var c=e.i(59544),o=e.i(39964),d=e.i(20777);function u({title:e="访问被拒绝",description:t="您没有权限访问此页面。请联系管理员获取相应权限。",requiredPermission:a,showBackButton:r=!0,showHomeButton:u=!0}){return(0,s.jsx)("div",{className:"flex min-h-[60vh] items-center justify-center px-4",children:(0,s.jsx)(o.Card,{className:"max-w-md text-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)("div",{className:"flex h-16 w-16 items-center justify-center rounded-full bg-[hsl(var(--danger))]/10",children:(0,s.jsx)(l.ShieldX,{className:"h-8 w-8 text-[hsl(var(--danger))]"})}),(0,s.jsx)("h1",{className:"font-display text-2xl text-[hsl(var(--ink))]",children:e}),(0,s.jsx)("p",{className:"text-sm text-[hsl(var(--ink-muted))]",children:t}),a&&(0,s.jsx)("div",{className:"mt-2 rounded-lg bg-[hsl(var(--sand-2))] px-4 py-2",children:(0,s.jsxs)("p",{className:"text-xs text-[hsl(var(--ink-muted))]",children:["所需权限：",(0,s.jsx)("code",{className:"ml-1 rounded bg-[hsl(var(--sand-3))] px-1.5 py-0.5 font-mono text-[hsl(var(--ink))]",children:a})]})}),(r||u)&&(0,s.jsxs)("div",{className:"mt-4 flex flex-wrap justify-center gap-3",children:[r&&(0,s.jsxs)(c.Button,{variant:"outline",size:"sm",onClick:()=>window.history.back(),children:[(0,s.jsx)(n.ArrowLeft,{className:"h-4 w-4"}),"返回上一页"]}),u&&(0,s.jsx)(d.StaticLink,{href:"/queue-op",children:(0,s.jsxs)(c.Button,{variant:"primary",size:"sm",children:[(0,s.jsx)(i,{className:"h-4 w-4"}),"返回首页"]})})]})]})})})}var h=e.i(55600);function m({permissions:e,projectLevel:l,projectId:n,children:i,deniedTitle:c,deniedDescription:o,loadingFallback:d}){let{hasAnyPermission:m,loading:x,isAuthenticated:p}=(0,a.usePermissions)(),{currentProject:v,projects:f,isLoading:g}=(0,r.useProject)(),[j,b]=(0,t.useState)(!1);(0,t.useEffect)(()=>{b(!0)},[]);let y="number"==typeof n?f.find(e=>e.id===n)||null:v,k=(()=>{if(!l)return!0;let e={read:1,write:2,admin:3},s=e[l]??0;return y?.permission_level?(e[y.permission_level]??0)>=s:f.length>0&&Math.max(...f.map(s=>e[s.permission_level??"read"]??0))>=s})();return((0,t.useEffect)(()=>{!j||x||p||(0,h.navigateTo)("/login")},[j,x,p]),!j||x||l&&g)?d?(0,s.jsx)(s.Fragment,{children:d}):(0,s.jsx)("div",{className:"flex min-h-[60vh] items-center justify-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-2 border-[hsl(var(--accent))] border-t-transparent"}),(0,s.jsx)("p",{className:"text-sm text-[hsl(var(--ink-muted))]",children:"正在验证权限..."})]})}):p?l&&!k?(0,s.jsx)(u,{title:c||"无项目权限",description:o||"当前项目权限不足，无法访问该页面。",requiredPermission:`项目权限: ${l}`,showBackButton:!0,showHomeButton:!0}):m(e)?(0,s.jsx)(s.Fragment,{children:i}):(0,s.jsx)(u,{title:c,description:o,requiredPermission:e.join(" 或 "),showBackButton:!0,showHomeButton:!0}):(0,s.jsx)("div",{className:"flex min-h-[60vh] items-center justify-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-2 border-[hsl(var(--accent))] border-t-transparent"}),(0,s.jsx)("p",{className:"text-sm text-[hsl(var(--ink-muted))]",children:"正在跳转到登录页面..."})]})})}e.s(["RequirePermission",()=>m],62162)},84030,e=>{"use strict";var s=e.i(71645),t=e.i(93302);function a(e,a){let{hasPermission:r}=(0,t.usePermissions)();return(0,s.useMemo)(()=>({canCreate:r(`${e}:create`,a),canRead:r(`${e}:read`,a),canUpdate:r(`${e}:update`,a),canDelete:r(`${e}:delete`,a),canExecute:r(`${e}:execute`,a),canExport:r(`${e}:export`,a)}),[e,a,r])}e.s(["useActionPermissions",()=>a])},64659,e=>{"use strict";let s=(0,e.i(75254).default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);e.s(["ChevronDown",()=>s],64659)},39312,56660,e=>{"use strict";let s=(0,e.i(75254).default)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);e.s(["Zap",()=>s],39312);var t=e.i(43476),a=e.i(7670);function r({checked:e,onChange:s,label:r,size:l="md",disabled:n=!1}){let i={sm:{track:"w-8 h-4",thumb:"h-3 w-3",translate:"translate-x-4"},md:{track:"w-11 h-6",thumb:"h-5 w-5",translate:"translate-x-5"}}[l];return(0,t.jsxs)("button",{type:"button",role:"switch","aria-checked":e,disabled:n,onClick:()=>!n&&s(!e),className:(0,a.default)("group relative inline-flex items-center gap-2",n&&"opacity-50 cursor-not-allowed"),children:[(0,t.jsx)("span",{className:(0,a.default)("relative inline-flex flex-shrink-0 rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none",i.track,e?"bg-[hsl(var(--accent))]":"bg-[hsl(var(--sand-2))]",!n&&"cursor-pointer"),children:(0,t.jsx)("span",{className:(0,a.default)("pointer-events-none inline-block rounded-full bg-white shadow-lg ring-0 transition duration-200 ease-in-out",i.thumb,e?i.translate:"translate-x-0")})}),r&&(0,t.jsx)("span",{className:"text-sm text-[hsl(var(--ink))]",children:r})]})}e.s(["Toggle",()=>r],56660)},38645,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(62162),r=e.i(59544),l=e.i(32098),n=e.i(38171),i=e.i(22726),c=e.i(57998),o=e.i(75254);let d=(0,o.default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),u=(0,o.default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var h=e.i(63209),m=e.i(37727);function x({message:e,type:a="info",duration:r=3e3,onClose:l}){let[n,i]=(0,t.useState)(!0);(0,t.useEffect)(()=>{let e=setTimeout(()=>{i(!1),setTimeout(l,300)},r);return()=>clearTimeout(e)},[r,l]);let c={success:(0,s.jsx)(d,{className:"h-5 w-5 text-[hsl(var(--success))]"}),error:(0,s.jsx)(u,{className:"h-5 w-5 text-[hsl(var(--danger))]"}),warning:(0,s.jsx)(h.AlertCircle,{className:"h-5 w-5 text-[hsl(var(--warning))]"}),info:(0,s.jsx)(h.AlertCircle,{className:"h-5 w-5 text-[hsl(var(--accent))]"})};return(0,s.jsxs)("div",{className:`flex items-center gap-3 rounded-xl border px-4 py-3 shadow-lg backdrop-blur-sm transition-all duration-300 ${{success:"border-[hsl(var(--success))]/30 bg-[hsl(var(--success))]/10",error:"border-[hsl(var(--danger))]/30 bg-[hsl(var(--danger))]/10",warning:"border-[hsl(var(--warning))]/30 bg-[hsl(var(--warning))]/10",info:"border-[hsl(var(--accent))]/30 bg-[hsl(var(--accent))]/10"}[a]} ${n?"translate-y-0 opacity-100":"translate-y-2 opacity-0"}`,children:[c[a],(0,s.jsx)("span",{className:"text-sm text-[hsl(var(--ink))]",children:e}),(0,s.jsx)("button",{onClick:()=>{i(!1),setTimeout(l,300)},className:"ml-2 p-1 rounded-full hover:bg-[hsl(var(--sand-2))] text-[hsl(var(--ink-muted))] hover:text-[hsl(var(--ink))]",children:(0,s.jsx)(m.X,{className:"h-4 w-4"})})]})}function p({toasts:e,onRemove:t}){return(0,s.jsx)("div",{className:"fixed bottom-4 right-4 z-50 flex flex-col-reverse gap-2",children:e.map(e=>(0,s.jsx)(x,{message:e.message,type:e.type,onClose:()=>t(e.id)},e.id))})}var v=e.i(9165),f=e.i(75379),g=e.i(68402),j=e.i(84030),b=e.i(80580);let y=0,k=[60,120,180,360,720,1440,8640],N=[{value:5,label:"5秒"},{value:10,label:"10秒"},{value:30,label:"30秒"},{value:60,label:"60秒"}];var _=e.i(3116),w=e.i(16715),C=e.i(39312),S=e.i(39964),M=e.i(3812),q=e.i(56660);function z({search:e,activeOnly:t,onSearchChange:a,onActiveOnlyChange:l,loading:n,autoRefresh:i,refreshInterval:c,canOperateQueue:o,onRefresh:d,onRefreshAllMsgCounts:u,onStartAutoConsume:h,onToggleAutoRefresh:m,onIntervalChange:x}){return(0,s.jsx)(S.Card,{children:(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm text-[hsl(var(--ink-muted))]",children:"队列搜索"}),(0,s.jsx)(M.Input,{placeholder:"请输入队列名称搜索...",value:e,onChange:e=>a(e.target.value),className:"w-64"})]}),(0,s.jsx)(q.Toggle,{checked:t,onChange:l,label:"仅显示消费队列"})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsxs)(r.Button,{variant:"secondary",size:"sm",onClick:u,className:"cursor-pointer",children:[(0,s.jsx)(w.RefreshCw,{className:"h-4 w-4"}),"刷新消息数量"]}),(0,s.jsxs)(r.Button,{variant:"primary",size:"sm",onClick:h,className:"cursor-pointer",disabled:!o,children:[(0,s.jsx)(C.Zap,{className:"h-4 w-4"}),"启动自动消费"]}),(0,s.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:d,disabled:n,children:[(0,s.jsx)(w.RefreshCw,{className:`h-4 w-4 ${n?"animate-spin":""}`}),"数据刷新"]}),(0,s.jsxs)("div",{className:"flex items-center gap-1 rounded-full border border-[hsl(var(--line))] p-0.5",children:[(0,s.jsx)("span",{className:"px-2 text-xs text-[hsl(var(--ink-muted))]",children:"刷新间隔:"}),N.map(e=>(0,s.jsx)("button",{onClick:()=>x(e.value),className:`px-2 py-1 text-xs rounded-full transition cursor-pointer ${c===e.value?"bg-[hsl(var(--accent))] text-white":"text-[hsl(var(--ink-muted))] hover:text-[hsl(var(--ink))]"}`,children:e.label},e.value))]}),(0,s.jsxs)(r.Button,{variant:i?"primary":"outline",size:"sm",onClick:m,children:[(0,s.jsx)(_.Clock,{className:"h-4 w-4"}),i?"刷新中...":"已暂停"]})]})]})})}let $=(0,o.default)("chart-line",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);var T=e.i(64659);let B=(0,o.default)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);var E=e.i(86536),P=e.i(52571),R=e.i(95242),A=e.i(31343),D=e.i(27612),F=e.i(96640),I=e.i(40803),O=e.i(58700);function V({queues:e,loading:t,currentPage:a,pageSize:l,totalCount:n,sortField:i,sortDirection:c,canOperateQueue:o,canClearQueue:d,onPageChange:u,onPageSizeChange:h,onSort:m,onViewConfig:x,onViewChart:p,onViewConsumers:v,onQueueAction:g}){let j=({field:e})=>i!==e?(0,s.jsx)(T.ChevronDown,{className:"h-3 w-3 opacity-30"}):"asc"===c?(0,s.jsx)(B,{className:"h-3 w-3"}):(0,s.jsx)(T.ChevronDown,{className:"h-3 w-3"}),b=({field:e,children:t})=>(0,s.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap cursor-pointer hover:text-[hsl(var(--ink))]",onClick:()=>m(e),children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[t,(0,s.jsx)(j,{field:e})]})});return(0,s.jsxs)(S.Card,{children:[(0,s.jsx)("div",{className:"overflow-x-auto",children:t?(0,s.jsxs)("div",{className:"py-8 text-center text-sm text-[hsl(var(--ink-muted))]",children:[(0,s.jsx)(w.RefreshCw,{className:"h-8 w-8 mx-auto mb-2 animate-spin text-[hsl(var(--accent))]"}),"正在加载队列..."]}):0===e.length?(0,s.jsx)(I.EmptyState,{title:"未找到队列",subtitle:"调整筛选条件或刷新列表。"}):(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"text-left text-xs uppercase tracking-wider text-[hsl(var(--ink-muted))] bg-[hsl(var(--sand-2))]",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)(b,{field:"queue_name",children:"名称"}),(0,s.jsx)(b,{field:"active_consumers",children:"消费者数量"}),(0,s.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"Broker类型"}),(0,s.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"消费函数"}),(0,s.jsx)(b,{field:"all_consumers_last_execute_task_time",children:"最近执行时间"}),(0,s.jsx)(b,{field:"msg_num_in_broker",children:"消息数量"}),(0,s.jsx)(b,{field:"history_run_count",children:"历史运行次数"}),(0,s.jsx)(b,{field:"history_run_fail_count",children:"历史失败次数"}),(0,s.jsx)(b,{field:"all_consumers_last_x_s_execute_count",children:"近10秒完成"}),(0,s.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"近10秒失败"}),(0,s.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"累计平均耗时"}),(0,s.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"状态"}),(0,s.jsx)("th",{className:"px-3 py-3 font-medium whitespace-nowrap",children:"操作"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-[hsl(var(--line))]",children:e.map(e=>{let t=(e.active_consumers?.length??0)>0,a=1===e.pause_flag,l=e.queue_params?.consuming_function_name??"-";return(0,s.jsxs)("tr",{className:"hover:bg-[hsl(var(--sand-2))]/50 transition-colors",children:[(0,s.jsx)("td",{className:"px-3 py-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-medium text-[hsl(var(--ink))]",children:e.queue_name}),t?(0,s.jsx)(F.Badge,{tone:"success",children:"消费"}):(0,s.jsx)(F.Badge,{tone:"neutral",children:"等待"}),a&&(0,s.jsx)(F.Badge,{tone:"warning",children:"已暂停"})]})}),(0,s.jsx)("td",{className:"px-3 py-3 text-center",children:(0,s.jsx)(F.Badge,{tone:t?"success":"neutral",children:e.active_consumers?.length??0})}),(0,s.jsx)("td",{className:"px-3 py-3",children:(0,s.jsx)(F.Badge,{tone:"info",children:e.queue_params?.broker_kind??"-"})}),(0,s.jsx)("td",{className:"px-3 py-3 text-[hsl(var(--ink))]",children:(0,s.jsx)("code",{className:"text-xs bg-[hsl(var(--sand-2))] px-1.5 py-0.5 rounded",children:l})}),(0,s.jsx)("td",{className:"px-3 py-3 text-xs text-[hsl(var(--ink-muted))] whitespace-nowrap",children:(0,f.formatDateTime)(e.all_consumers_last_execute_task_time??null)}),(0,s.jsx)("td",{className:"px-3 py-3 text-center",children:(0,s.jsx)(F.Badge,{tone:"warning",children:(0,f.formatNumber)(e.msg_num_in_broker??0)})}),(0,s.jsx)("td",{className:"px-3 py-3 text-center text-[hsl(var(--ink))]",children:(0,f.formatNumber)(e.history_run_count??0)}),(0,s.jsx)("td",{className:"px-3 py-3 text-center",children:(0,s.jsx)("span",{className:e.history_run_fail_count?"text-[hsl(var(--danger))]":"text-[hsl(var(--ink-muted))]",children:(0,f.formatNumber)(e.history_run_fail_count??0)})}),(0,s.jsx)("td",{className:"px-3 py-3 text-center text-[hsl(var(--ink))]",children:e.all_consumers_last_x_s_execute_count??0}),(0,s.jsx)("td",{className:"px-3 py-3 text-center",children:(0,s.jsx)("span",{className:e.all_consumers_last_x_s_execute_count_fail?"text-[hsl(var(--danger))]":"text-[hsl(var(--ink-muted))]",children:e.all_consumers_last_x_s_execute_count_fail??0})}),(0,s.jsx)("td",{className:"px-3 py-3 text-center text-[hsl(var(--ink))]",children:e.all_consumers_avarage_function_spend_time_from_start?`${e.all_consumers_avarage_function_spend_time_from_start.toFixed(3)}s`:"-"}),(0,s.jsx)("td",{className:"px-3 py-3",children:a?(0,s.jsx)(F.Badge,{tone:"warning",children:"暂停中"}):t?(0,s.jsx)(F.Badge,{tone:"success",children:"运行中"}):(0,s.jsx)(F.Badge,{tone:"neutral",children:"空闲"})}),(0,s.jsx)("td",{className:"px-3 py-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(r.Button,{variant:"secondary",size:"sm",className:"h-7 px-2",onClick:()=>x(e),children:(0,s.jsx)(E.Eye,{className:"h-3 w-3"})}),(0,s.jsx)(r.Button,{variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>p(e),children:(0,s.jsx)($,{className:"h-3 w-3"})}),(0,s.jsx)(r.Button,{variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>v(e),children:(0,s.jsx)(P.Info,{className:"h-3 w-3"})}),(0,s.jsx)(r.Button,{variant:"ghost",size:"sm",className:"h-7 px-2",onClick:()=>g(e,a?"resume":"pause"),disabled:!o,children:a?(0,s.jsx)(A.Play,{className:"h-3 w-3"}):(0,s.jsx)(R.Pause,{className:"h-3 w-3"})}),(0,s.jsx)(r.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-[hsl(var(--danger))]",onClick:()=>g(e,"clear"),disabled:!d,children:(0,s.jsx)(D.Trash2,{className:"h-3 w-3"})})]})})]},e.queue_name)})})]})}),(0,s.jsx)(O.Pagination,{currentPage:a,pageSize:l,totalCount:n,onPageChange:u,onPageSizeChange:h,loading:t})]})}function L(){let[e,o]=(0,t.useState)([]),[d,u]=(0,t.useState)(!1),[h,m]=(0,t.useState)(""),[x,N]=(0,t.useState)(!1),[_,w]=(0,t.useState)(0),[C,S]=(0,t.useState)(20),[M,q]=(0,t.useState)("queue_name"),[$,T]=(0,t.useState)("asc"),[B,E]=(0,t.useState)(null),[P,R]=(0,t.useState)(null),[A,D]=(0,t.useState)(null),[F,I]=(0,t.useState)([]),[O,L]=(0,t.useState)(360),[J,U]=(0,t.useState)(!1),[H,Q]=(0,t.useState)(()=>(0,f.toDateTimeInputValue)(new Date(Date.now()-36e5))),[X,K]=(0,t.useState)(()=>(0,f.toDateTimeInputValue)(new Date)),[Z,Y]=(0,t.useState)(!1),[G,W]=(0,t.useState)(""),[ee,es]=(0,t.useState)(""),{currentProject:et,careProjectName:ea}=(0,b.useProject)(),{canExecute:er}=(0,j.useActionPermissions)("queue"),el=et?.permission_level??"admin",en=!et||"write"===el||"admin"===el,ei=er&&en,ec=function(){let[e,s]=(0,t.useState)([]),a=(0,t.useCallback)((e,t="info")=>{let a=++y;s(s=>[...s,{id:a,message:e,type:t}])},[]),r=(0,t.useCallback)(e=>{s(s=>s.filter(s=>s.id!==e))},[]),l=(0,t.useCallback)(e=>a(e,"success"),[a]),n=(0,t.useCallback)(e=>a(e,"error"),[a]),i=(0,t.useCallback)(e=>a(e,"warning"),[a]),c=(0,t.useCallback)(e=>a(e,"info"),[a]);return{toasts:e,showToast:a,removeToast:r,success:l,error:n,warning:i,info:c}}(),eo=(0,t.useRef)(ec);eo.current=ec;let ed=(0,t.useCallback)(async()=>{u(!0);try{let e="/queue/params_and_active_consumers";et?.id&&(e+=`?project_id=${et.id}`);let s=await (0,v.apiFetch)(e),t=Object.entries(s).map(([e,s])=>({queue_name:e,...s}));o(t)}catch(e){eo.current.error(e instanceof Error?e.message:"加载队列失败。")}finally{u(!1)}},[et?.id,ea]),{enabled:eu,toggle:eh,intervalMs:em,setIntervalMs:ex}=(0,g.useAutoRefresh)(ed,!1,3e4);(0,t.useEffect)(()=>{ed()},[ed]);let ep=(0,t.useMemo)(()=>{let s=e.filter(e=>(e.active_consumers?.length??0)>0),t=e.reduce((e,s)=>e+(s.active_consumers?.length??0),0),a=e.reduce((e,s)=>e+(s.history_run_fail_count??0),0);return{active:s.length,idle:e.length-s.length,consumers:t,retryCount:a}},[e]),ev=(0,t.useMemo)(()=>e.filter(e=>(!x||(e.active_consumers?.length??0)!==0)&&(!h||!!e.queue_name.toLowerCase().includes(h.toLowerCase()))),[e,h,x]),ef=(0,t.useMemo)(()=>[...ev].sort((e,s)=>{let t=0,a=0;switch(M){case"queue_name":t=e.queue_name,a=s.queue_name;break;case"active_consumers":t=e.active_consumers?.length??0,a=s.active_consumers?.length??0;break;case"msg_num_in_broker":t=e.msg_num_in_broker??0,a=s.msg_num_in_broker??0;break;case"history_run_count":t=e.history_run_count??0,a=s.history_run_count??0;break;case"history_run_fail_count":t=e.history_run_fail_count??0,a=s.history_run_fail_count??0;break;case"all_consumers_last_x_s_execute_count":t=e.all_consumers_last_x_s_execute_count??0,a=s.all_consumers_last_x_s_execute_count??0;break;case"all_consumers_last_execute_task_time":t=e.all_consumers_last_execute_task_time??0,a=s.all_consumers_last_execute_task_time??0}return"string"==typeof t&&"string"==typeof a?"asc"===$?t.localeCompare(a):a.localeCompare(t):"asc"===$?t-a:a-t}),[ev,M,$]),eg=ef.length,ej=(0,t.useMemo)(()=>{let e=_*C;return ef.slice(e,e+C)},[ef,_,C]),eb=async()=>{try{let s=await Promise.all(e.map(async e=>{try{let s=`/funboost/get_msg_count?queue_name=${encodeURIComponent(e.queue_name)}`;et?.id&&(s+=`&project_id=${et.id}`);let t=await (0,v.funboostFetch)(s);return{...e,msg_num_in_broker:t.count}}catch{return e}}));o(s),ec.success("消息数量已刷新。")}catch(e){ec.error(e instanceof Error?e.message:"刷新失败。")}},ey=async()=>{if(!ei)return void ec.warning("当前项目无写权限。");ec.info("正在启动自动消费...");try{await ed(),ec.success("自动消费已启动。")}catch(e){ec.error(e instanceof Error?e.message:"启动失败。")}},ek=async(e,s)=>{try{if(("pause"===s||"resume"===s)&&!ei||"clear"===s&&!ei)return void ec.warning("当前项目无写权限。");if("clear"===s&&await (0,v.funboostFetch)("/funboost/clear_queue",{method:"POST",json:{queue_name:e.queue_name,project_id:et?.id}}),"pause"===s){let s=`/queue/pause/${encodeURIComponent(e.queue_name)}`;et?.id&&(s+=`?project_id=${et.id}`),await (0,v.apiFetch)(s,{method:"POST"})}if("resume"===s){let s=`/queue/resume/${encodeURIComponent(e.queue_name)}`;et?.id&&(s+=`?project_id=${et.id}`),await (0,v.apiFetch)(s,{method:"POST"})}await ed(),ec.success("操作已完成。")}catch(e){ec.error(e instanceof Error?e.message:"操作失败。")}},eN=async e=>{E(e);try{let s=`/running_consumer/hearbeat_info_by_queue_name?queue_name=${encodeURIComponent(e.queue_name)}`;et?.id&&(s+=`&project_id=${et.id}`);let t=await (0,v.apiFetch)(s);R(t)}catch(e){ec.error(e instanceof Error?e.message:"加载消费者失败。")}},e_=async e=>{let s=e||A;if(s){e&&D(e),U(!0);try{let e=Math.floor(new Date(H).getTime()/1e3),t=Math.floor(new Date(X).getTime()/1e3),a=`/queue/get_time_series_data/${encodeURIComponent(s.queue_name)}?start_ts=${e}&end_ts=${t}&curve_samples_count=${O}`;et?.id&&(a+=`&project_id=${et.id}`);let r=await (0,v.apiFetch)(a);I(r)}catch(e){ec.error(e instanceof Error?e.message:"加载曲线数据失败。")}finally{U(!1)}}};return(0,s.jsx)(a.RequirePermission,{permissions:["queue:read"],projectLevel:"read",children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid gap-4 grid-cols-2 lg:grid-cols-4",children:[(0,s.jsx)(n.StatCard,{label:"远程队列",value:e.length,helper:"总数",tone:"info"}),(0,s.jsx)(n.StatCard,{label:"消费队列",value:ep.active,helper:"活跃",tone:"success"}),(0,s.jsx)(n.StatCard,{label:"消费者监控",value:ep.consumers,helper:"在线",tone:"warning"}),(0,s.jsx)(n.StatCard,{label:"重试次数",value:ep.retryCount,helper:"累计",tone:"danger"})]}),(0,s.jsx)(z,{search:h,activeOnly:x,onSearchChange:m,onActiveOnlyChange:N,loading:d,autoRefresh:eu,refreshInterval:em/1e3,canOperateQueue:ei,onRefresh:ed,onRefreshAllMsgCounts:eb,onStartAutoConsume:ey,onToggleAutoRefresh:eh,onIntervalChange:e=>ex(1e3*e)}),(0,s.jsx)(V,{queues:ej,loading:d,currentPage:_,pageSize:C,totalCount:eg,sortField:M,sortDirection:$,canOperateQueue:ei,canClearQueue:ei,onPageChange:w,onPageSizeChange:e=>{S(e),w(0)},onSort:e=>{M===e?T("asc"===$?"desc":"asc"):(q(e),T("desc"))},onViewConfig:e=>{W(`队列配置: ${e.queue_name}`),es(JSON.stringify(e.queue_params??{},null,2)),Y(!0)},onViewChart:e_,onViewConsumers:eN,onQueueAction:ek}),(0,s.jsx)(c.JsonViewerModal,{open:Z,title:G,content:ee,onClose:()=>Y(!1)}),(0,s.jsx)(l.Modal,{open:null!==B,title:B?`消费者详情: ${B.queue_name}`:"",onClose:()=>{E(null),R(null)},footer:(0,s.jsx)(r.Button,{variant:"outline",onClick:()=>E(null),children:"关闭"}),children:B&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:"队列参数"}),(0,s.jsx)("pre",{className:"mt-2 rounded-2xl bg-[hsl(var(--sand-2))] p-4 text-xs overflow-auto max-h-48",children:JSON.stringify(B.queue_params??{},null,2)})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:["活跃消费者 (",P?.length??B.active_consumers?.length??0,")"]}),P?(0,s.jsx)("pre",{className:"mt-2 rounded-2xl bg-[hsl(var(--sand-2))] p-4 text-xs overflow-auto max-h-80",children:JSON.stringify(P,null,2)}):(0,s.jsx)("p",{className:"mt-2 text-sm text-[hsl(var(--ink-muted))]",children:"正在加载..."})]})]})}),(0,s.jsx)(l.Modal,{open:null!==A,title:"",onClose:()=>D(null),size:"xl",footer:(0,s.jsx)(r.Button,{variant:"outline",onClick:()=>D(null),children:"关闭"}),children:A&&(0,s.jsx)(i.QueueTimeSeriesChart,{queueName:A.queue_name,data:F,loading:J,startTime:H,endTime:X,sampleCount:O,sampleOptions:k,onStartTimeChange:Q,onEndTimeChange:K,onSampleCountChange:L,onRefresh:()=>e_()})}),(0,s.jsx)(p,{toasts:ec.toasts,onRemove:ec.removeToast})]})})}e.s(["default",()=>L],38645)}]);