(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67073,e=>{"use strict";var s=e.i(43476),a=e.i(7670);function t({className:e,...t}){return(0,s.jsx)("select",{className:(0,a.default)("w-full rounded-2xl border border-[hsl(var(--line))] bg-[hsl(var(--card))]/80 px-4 py-2 text-sm text-[hsl(var(--ink))] shadow-sm outline-none transition focus:border-[hsl(var(--accent))] focus:ring-2 focus:ring-[hsl(var(--accent))]/20",e),...t})}e.s(["Select",()=>t])},3812,e=>{"use strict";var s=e.i(43476),a=e.i(7670);function t({className:e,...t}){return(0,s.jsx)("input",{className:(0,a.default)("w-full rounded-2xl border border-[hsl(var(--line))] bg-[hsl(var(--card))]/80 px-4 py-2 text-sm text-[hsl(var(--ink))] shadow-sm outline-none transition placeholder:text-[hsl(var(--ink-muted))] focus:border-[hsl(var(--accent))] focus:ring-2 focus:ring-[hsl(var(--accent))]/20",e),...t})}e.s(["Input",()=>t])},59544,e=>{"use strict";var s=e.i(43476),a=e.i(7670);let t={primary:"bg-[hsl(var(--accent))] text-white hover:bg-[hsl(var(--accent-2))]",secondary:"bg-[hsl(var(--accent-2))] text-white hover:bg-[hsl(var(--accent))]",outline:"border border-[hsl(var(--line))] text-[hsl(var(--ink))] hover:border-[hsl(var(--accent))] hover:text-[hsl(var(--accent))]",ghost:"text-[hsl(var(--ink))] hover:bg-[hsl(var(--sand-2))]",danger:"bg-[hsl(var(--danger))] text-white hover:bg-[hsl(var(--danger))]/90"},r={sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-5 py-2.5 text-sm"};function n({variant:e="primary",size:n="md",className:i,...l}){return(0,s.jsx)("button",{className:(0,a.default)("inline-flex items-center justify-center gap-2 rounded-full font-medium transition-colors duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--accent))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--sand))]",t[e],r[n],i),...l})}e.s(["Button",()=>n])},39964,e=>{"use strict";var s=e.i(43476),a=e.i(7670);function t({glass:e=!0,className:t,...r}){return(0,s.jsx)("div",{className:(0,a.default)("rounded-3xl p-6",e?"glass-card":"bg-[hsl(var(--card))] border border-[hsl(var(--line))]",t),...r})}e.s(["Card",()=>t])},88092,e=>{"use strict";let s=(0,e.i(75254).default)("shield-x",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m14.5 9.5-5 5",key:"17q4r4"}],["path",{d:"m9.5 9.5 5 5",key:"18nt4w"}]]);e.s(["ShieldX",()=>s],88092)},71689,e=>{"use strict";let s=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>s],71689)},62162,e=>{"use strict";var s=e.i(43476),a=e.i(71645),t=e.i(93302),r=e.i(80580),n=e.i(88092),i=e.i(71689);let l=(0,e.i(75254).default)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]);var c=e.i(59544),d=e.i(39964),o=e.i(20777);function m({title:e="访问被拒绝",description:a="您没有权限访问此页面。请联系管理员获取相应权限。",requiredPermission:t,showBackButton:r=!0,showHomeButton:m=!0}){return(0,s.jsx)("div",{className:"flex min-h-[60vh] items-center justify-center px-4",children:(0,s.jsx)(d.Card,{className:"max-w-md text-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)("div",{className:"flex h-16 w-16 items-center justify-center rounded-full bg-[hsl(var(--danger))]/10",children:(0,s.jsx)(n.ShieldX,{className:"h-8 w-8 text-[hsl(var(--danger))]"})}),(0,s.jsx)("h1",{className:"font-display text-2xl text-[hsl(var(--ink))]",children:e}),(0,s.jsx)("p",{className:"text-sm text-[hsl(var(--ink-muted))]",children:a}),t&&(0,s.jsx)("div",{className:"mt-2 rounded-lg bg-[hsl(var(--sand-2))] px-4 py-2",children:(0,s.jsxs)("p",{className:"text-xs text-[hsl(var(--ink-muted))]",children:["所需权限：",(0,s.jsx)("code",{className:"ml-1 rounded bg-[hsl(var(--sand-3))] px-1.5 py-0.5 font-mono text-[hsl(var(--ink))]",children:t})]})}),(r||m)&&(0,s.jsxs)("div",{className:"mt-4 flex flex-wrap justify-center gap-3",children:[r&&(0,s.jsxs)(c.Button,{variant:"outline",size:"sm",onClick:()=>window.history.back(),children:[(0,s.jsx)(i.ArrowLeft,{className:"h-4 w-4"}),"返回上一页"]}),m&&(0,s.jsx)(o.StaticLink,{href:"/queue-op",children:(0,s.jsxs)(c.Button,{variant:"primary",size:"sm",children:[(0,s.jsx)(l,{className:"h-4 w-4"}),"返回首页"]})})]})]})})})}var h=e.i(55600);function u({permissions:e,projectLevel:n,projectId:i,children:l,deniedTitle:c,deniedDescription:d,loadingFallback:o}){let{hasAnyPermission:u,loading:x,isAuthenticated:p}=(0,t.usePermissions)(),{currentProject:v,projects:f,isLoading:j}=(0,r.useProject)(),[g,b]=(0,a.useState)(!1);(0,a.useEffect)(()=>{b(!0)},[]);let y="number"==typeof i?f.find(e=>e.id===i)||null:v,N=(()=>{if(!n)return!0;let e={read:1,write:2,admin:3},s=e[n]??0;return y?.permission_level?(e[y.permission_level]??0)>=s:f.length>0&&Math.max(...f.map(s=>e[s.permission_level??"read"]??0))>=s})();return((0,a.useEffect)(()=>{!g||x||p||(0,h.navigateTo)("/login")},[g,x,p]),!g||x||n&&j)?o?(0,s.jsx)(s.Fragment,{children:o}):(0,s.jsx)("div",{className:"flex min-h-[60vh] items-center justify-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-2 border-[hsl(var(--accent))] border-t-transparent"}),(0,s.jsx)("p",{className:"text-sm text-[hsl(var(--ink-muted))]",children:"正在验证权限..."})]})}):p?n&&!N?(0,s.jsx)(m,{title:c||"无项目权限",description:d||"当前项目权限不足，无法访问该页面。",requiredPermission:`项目权限: ${n}`,showBackButton:!0,showHomeButton:!0}):u(e)?(0,s.jsx)(s.Fragment,{children:l}):(0,s.jsx)(m,{title:c,description:d,requiredPermission:e.join(" 或 "),showBackButton:!0,showHomeButton:!0}):(0,s.jsx)("div",{className:"flex min-h-[60vh] items-center justify-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-2 border-[hsl(var(--accent))] border-t-transparent"}),(0,s.jsx)("p",{className:"text-sm text-[hsl(var(--ink-muted))]",children:"正在跳转到登录页面..."})]})})}e.s(["RequirePermission",()=>u],62162)},84030,e=>{"use strict";var s=e.i(71645),a=e.i(93302);function t(e,t){let{hasPermission:r}=(0,a.usePermissions)();return(0,s.useMemo)(()=>({canCreate:r(`${e}:create`,t),canRead:r(`${e}:read`,t),canUpdate:r(`${e}:update`,t),canDelete:r(`${e}:delete`,t),canExecute:r(`${e}:execute`,t),canExport:r(`${e}:export`,t)}),[e,t,r])}e.s(["useActionPermissions",()=>t])},56909,e=>{"use strict";let s=(0,e.i(75254).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>s],56909)},42758,e=>{"use strict";var s=e.i(43476),a=e.i(71645),t=e.i(63488),r=e.i(16715),n=e.i(56909),i=e.i(62162),l=e.i(59544),c=e.i(39964),d=e.i(3812),o=e.i(67073),m=e.i(9165),h=e.i(84030);let u={smtp_host:"",smtp_port:"587",smtp_username:"",smtp_password:"",encryption:"tls",sender_name:"",sender_email:""};function x(){let[e,x]=(0,a.useState)(u),[p,v]=(0,a.useState)(""),[f,j]=(0,a.useState)(null),[g,b]=(0,a.useState)("success"),[y,N]=(0,a.useState)(!1),[w,k]=(0,a.useState)(!1),[_,C]=(0,a.useState)(!1),{canUpdate:S}=(0,h.useActionPermissions)("config"),P=async()=>{N(!0);try{let e=await (0,m.apiFetch)("/admin/api/email-config");if(e.success&&e.data){let s=e.data;x({smtp_host:s.smtp_host||"",smtp_port:String(s.smtp_port||587),smtp_username:s.smtp_username||"",smtp_password:"",encryption:s.use_ssl?"ssl":s.use_tls?"tls":"none",sender_name:s.sender_name||"",sender_email:s.sender_email||""})}}catch(e){B(e instanceof Error?e.message:"加载配置失败。","error")}finally{N(!1)}};(0,a.useEffect)(()=>{P()},[]);let B=(e,s="success")=>{j(e),b(s)},M=async()=>{if(!S)return void B("您没有权限修改邮件配置。","error");k(!0),j(null);try{let s=await (0,m.apiFetch)("/admin/api/email-config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({smtp_host:e.smtp_host,smtp_port:e.smtp_port,smtp_username:e.smtp_username,smtp_password:e.smtp_password,encryption:e.encryption,sender_name:e.sender_name,sender_email:e.sender_email})});s.success?B(s.message||"邮件配置保存成功！","success"):B(s.error||"保存失败。","error")}catch(e){B(e instanceof Error?e.message:"保存失败。","error")}finally{k(!1)}},T=async()=>{if(!S)return void B("您没有权限发送测试邮件。","error");if(!p)return void B("请输入测试邮箱地址","error");C(!0),j(null);try{let e=await (0,m.apiFetch)("/admin/test-email-ajax",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:p})});B(e.message,e.success?"success":"error")}catch(e){B(e instanceof Error?e.message:"测试失败。","error")}finally{C(!1)}};return(0,s.jsx)(i.RequirePermission,{permissions:["config:read"],children:(0,s.jsxs)("div",{className:"space-y-6",children:[f&&(0,s.jsx)(c.Card,{className:`border text-sm ${"success"===g?"border-[hsl(var(--success))]/30 bg-[hsl(var(--success))]/10 text-[hsl(var(--success))]":"border-[hsl(var(--danger))]/30 bg-[hsl(var(--danger))]/10 text-[hsl(var(--danger))]"}`,children:f}),(0,s.jsxs)(c.Card,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-display text-lg text-[hsl(var(--ink))]",children:"SMTP 服务器设置"}),(0,s.jsx)("p",{className:"text-sm text-[hsl(var(--ink-muted))]",children:"配置邮件发送服务器信息。"})]}),(0,s.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:P,disabled:y,className:"cursor-pointer",children:[(0,s.jsx)(r.RefreshCw,{className:`h-4 w-4 ${y?"animate-spin":""}`}),"刷新"]})]}),(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-[hsl(var(--ink-muted))]",children:"SMTP 服务器 *"}),(0,s.jsx)(d.Input,{placeholder:"例如: smtp.gmail.com",value:e.smtp_host,onChange:e=>x(s=>({...s,smtp_host:e.target.value}))})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-[hsl(var(--ink-muted))]",children:"端口 *"}),(0,s.jsx)(d.Input,{type:"number",placeholder:"587",value:e.smtp_port,onChange:e=>x(s=>({...s,smtp_port:e.target.value}))})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-[hsl(var(--ink-muted))]",children:"用户名"}),(0,s.jsx)(d.Input,{placeholder:"SMTP认证用户名（可选）",value:e.smtp_username,onChange:e=>x(s=>({...s,smtp_username:e.target.value}))})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-[hsl(var(--ink-muted))]",children:"密码"}),(0,s.jsx)(d.Input,{type:"password",placeholder:"SMTP认证密码（可选，留空保持不变）",value:e.smtp_password,onChange:e=>x(s=>({...s,smtp_password:e.target.value}))})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-[hsl(var(--ink-muted))]",children:"加密方式"}),(0,s.jsxs)(o.Select,{value:e.encryption,onChange:e=>x(s=>({...s,encryption:e.target.value})),children:[(0,s.jsx)("option",{value:"tls",children:"TLS (推荐)"}),(0,s.jsx)("option",{value:"ssl",children:"SSL"}),(0,s.jsx)("option",{value:"none",children:"无加密"})]})]})]})})]}),(0,s.jsxs)(c.Card,{children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h3",{className:"font-display text-lg text-[hsl(var(--ink))]",children:"发件人信息"}),(0,s.jsx)("p",{className:"text-sm text-[hsl(var(--ink-muted))]",children:"配置邮件发件人显示信息。"})]}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-[hsl(var(--ink-muted))]",children:"发件人名称"}),(0,s.jsx)(d.Input,{placeholder:"例如: 系统管理员",value:e.sender_name,onChange:e=>x(s=>({...s,sender_name:e.target.value}))})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-[hsl(var(--ink-muted))]",children:"发件人邮箱 *"}),(0,s.jsx)(d.Input,{placeholder:"例如: admin@example.com",value:e.sender_email,onChange:e=>x(s=>({...s,sender_email:e.target.value}))})]})]}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)(l.Button,{onClick:M,disabled:w||!S,children:w?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.RefreshCw,{className:"h-4 w-4 animate-spin"}),"保存中..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Save,{className:"h-4 w-4"}),"保存配置"]})})})]}),(0,s.jsxs)(c.Card,{children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h3",{className:"font-display text-lg text-[hsl(var(--ink))]",children:"发送测试邮件"}),(0,s.jsx)("p",{className:"text-sm text-[hsl(var(--ink-muted))]",children:"验证邮件配置是否正确。"})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-end gap-3",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-[200px] space-y-2",children:[(0,s.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wider text-[hsl(var(--ink-muted))]",children:"收件人邮箱"}),(0,s.jsx)(d.Input,{placeholder:"输入接收测试邮件的邮箱地址",value:p,onChange:e=>v(e.target.value)})]}),(0,s.jsx)(l.Button,{variant:"outline",onClick:T,disabled:_||!S,children:_?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.RefreshCw,{className:"h-4 w-4 animate-spin"}),"发送中..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.Mail,{className:"h-4 w-4"}),"发送测试邮件"]})})]})]})]})})}e.s(["default",()=>x])}]);