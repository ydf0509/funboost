(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,50567,e=>{"use strict";e.s(["default",0,function(){for(var e,t,r=0,a="",n=arguments.length;r<n;r++)(e=arguments[r])&&(t=function e(t){var r,a,n="";if("string"==typeof t||"number"==typeof t)n+=t;else if("object"==typeof t)if(Array.isArray(t)){var s=t.length;for(r=0;r<s;r++)t[r]&&(a=e(t[r]))&&(n&&(n+=" "),n+=a)}else for(a in t)t[a]&&(n&&(n+=" "),n+=a);return n}(e))&&(a&&(a+=" "),a+=t);return a}])},80228,e=>{"use strict";var t=e.i(16311),r=e.i(50567);let a={primary:"bg-[hsl(var(--accent))] text-white hover:bg-[hsl(var(--accent-2))]",secondary:"bg-[hsl(var(--accent-2))] text-white hover:bg-[hsl(var(--accent))]",outline:"border border-[hsl(var(--line))] text-[hsl(var(--ink))] hover:border-[hsl(var(--accent))] hover:text-[hsl(var(--accent))]",ghost:"text-[hsl(var(--ink))] hover:bg-[hsl(var(--sand-2))]",danger:"bg-[hsl(var(--danger))] text-white hover:bg-[hsl(var(--danger))]/90"},n={sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-5 py-2.5 text-sm"};function s({variant:e="primary",size:s="md",className:i,...o}){return(0,t.jsx)("button",{className:(0,r.default)("inline-flex items-center justify-center gap-2 rounded-full font-medium transition-colors duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--accent))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--sand))]",a[e],n[s],i),...o})}e.s(["Button",()=>s])},84646,e=>{"use strict";function t(e,t){let r=e.startsWith("/")?e:`/${e}`;window.location.port,t?.replace?window.location.replace(r):window.location.href=r}e.s(["navigateTo",()=>t])},43140,e=>{"use strict";var t=e.i(16311),r=e.i(50567);function a({className:e,...a}){return(0,t.jsx)("input",{className:(0,r.default)("w-full rounded-2xl border border-[hsl(var(--line))] bg-[hsl(var(--card))]/80 px-4 py-2 text-sm text-[hsl(var(--ink))] shadow-sm outline-none transition placeholder:text-[hsl(var(--ink-muted))] focus:border-[hsl(var(--accent))] focus:ring-2 focus:ring-[hsl(var(--accent))]/20",e),...a})}e.s(["Input",()=>a])},95818,e=>{"use strict";var t=e.i(3153);let r=t.default.env.NEXT_PUBLIC_API_BASE??"",a=new Set(["localhost","127.0.0.1","::1"]);function n(){let e;if("true"===new URLSearchParams(window.location.search).get("allow_insecure")||"true"===t.default.env.NEXT_PUBLIC_ALLOW_INSECURE_PASSWORD)return{ok:!0,warning:"已开启不安全密码传输，仅用于内网环境。"};let n=window.location.origin,s=r?new URL(r,n):new URL(n),i=(e=s.hostname,a.has(e)),o="https:"===s.protocol;return/^(192\.168\.|10\.|172\.(1[6-9]|2[0-9]|3[01])\.)/.test(s.hostname)?{ok:!0,warning:"当前为内网环境，密码将以明文提交。"}:window.isSecureContext||i?o||i?!o&&i?{ok:!0,warning:"当前为本地开发环境，密码将以明文提交，请勿用于生产环境。"}:{ok:!0}:{ok:!1,message:"检测到后端为非 HTTPS，已阻止提交。请启用 HTTPS。"}:{ok:!1,message:"当前页面不是安全上下文，已阻止提交。请使用 HTTPS 访问前端。"}}e.s(["ensureSecurePasswordTransport",()=>n])},81720,e=>{"use strict";let t=e.i(3153).default.env.NEXT_PUBLIC_API_BASE??"",r=null,a=0;async function n(){let e=Date.now();if(r&&e-a<18e5)return r;try{let n=await fetch(`${t}/api/public_key`,{method:"GET",credentials:"include"});if(!n.ok)throw Error(`获取公钥失败: ${n.status}`);let s=await n.json();if(!s.public_key||!s.key_id)throw Error("公钥响应格式无效");return r=s,a=e,s}catch(e){throw r=null,a=0,e}}function s(){r=null,a=0}async function i(e){let t=e.replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","");t=t.replace(/\s/g,"");let r=Uint8Array.from(atob(t),e=>e.charCodeAt(0));return await crypto.subtle.importKey("spki",r,{name:"RSA-OAEP",hash:"SHA-256"},!1,["encrypt"])}async function o(e,t){let r=await i(t),a=new TextEncoder().encode(e),n=new Uint8Array(await crypto.subtle.encrypt({name:"RSA-OAEP"},r,a)),s="";for(let e=0;e<n.length;e++)s+=String.fromCharCode(n[e]);return btoa(s)}function l(){return"undefined"!=typeof crypto&&void 0!==crypto.subtle&&"function"==typeof crypto.subtle.encrypt}async function c(e){if(!l())return console.warn("Web Crypto API 不可用，将使用明文密码"),e;try{s();let t=await n(),r=await o(e,t.public_key);return{encrypted:!0,data:r,key_id:t.key_id}}catch(e){throw console.error("密码加密失败:",e),Error("密码加密失败，请刷新页面重试")}}async function u(e){if(!l())return console.warn("Web Crypto API 不可用，将使用明文密码"),e;try{s();let t=await n(),r={};for(let[a,n]of Object.entries(e)){let e=await o(n,t.public_key);r[a]={encrypted:!0,data:e,key_id:t.key_id}}return r}catch(e){throw console.error("密码加密失败:",e),Error("密码加密失败，请刷新页面重试")}}e.s(["preparePassword",()=>c,"preparePasswords",()=>u])},45017,e=>{"use strict";var t=e.i(16311),r=e.i(16694),a=e.i(80228),n=e.i(43140),s=e.i(95818),i=e.i(81720),o=e.i(84646);function l(){let[e,l]=(0,r.useState)(""),[c,u]=(0,r.useState)(""),[d,h]=(0,r.useState)(!1),[p,f]=(0,r.useState)(null),[x,v]=(0,r.useState)(null),[m,y]=(0,r.useState)(!1),g=async t=>{t.preventDefault(),f(null),v(null),y(!0);try{let t,r=(0,s.ensureSecurePasswordTransport)();if(!r.ok){f(r.message??"密码传输不安全。"),y(!1);return}r.warning&&v(r.warning);try{t=await (0,i.preparePassword)(c)}catch(e){f(e instanceof Error?e.message:"密码加密失败"),y(!1);return}let a=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_name:e,password:t,remember_me:d}),credentials:"include"}),n=await a.json();if(n.success)return void(0,o.navigateTo)(n.redirect||"/queue-op");f(n.error||"登录失败，请检查用户名或密码。")}catch(e){f(e instanceof Error?e.message:"登录失败。")}finally{y(!1)}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2 text-center",children:[(0,t.jsx)("h2",{className:"font-display text-xl text-[hsl(var(--ink))]",children:"欢迎回来"}),(0,t.jsx)("p",{className:"text-sm text-[hsl(var(--ink-muted))]",children:"登录后管理你的队列。"})]}),(0,t.jsxs)("form",{className:"space-y-4",onSubmit:g,children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:"用户名"}),(0,t.jsx)(n.Input,{value:e,onChange:e=>l(e.target.value),required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:"密码"}),(0,t.jsx)(n.Input,{type:"password",value:c,onChange:e=>u(e.target.value),required:!0})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 text-xs text-[hsl(var(--ink-muted))]",children:[(0,t.jsx)("input",{type:"checkbox",checked:d,onChange:e=>h(e.target.checked),className:"h-4 w-4 rounded border-[hsl(var(--line))]"}),"记住我"]}),x?(0,t.jsx)("div",{className:"rounded-2xl border border-[hsl(var(--warning))]/30 bg-[hsl(var(--warning))]/10 px-4 py-2 text-xs text-[hsl(var(--warning))]",children:x}):null,p?(0,t.jsx)("div",{className:"rounded-2xl border border-[hsl(var(--danger))]/30 bg-[hsl(var(--danger))]/10 px-4 py-2 text-xs text-[hsl(var(--danger))]",children:p}):null,(0,t.jsx)(a.Button,{type:"submit",className:"w-full",disabled:m,children:m?"正在登录...":"登录"})]}),(0,t.jsx)("div",{className:"text-center text-xs text-[hsl(var(--ink-muted))]",children:(0,t.jsx)("a",{className:"font-semibold text-[hsl(var(--accent-2))]",href:"/forgot-password",children:"忘记密码？"})})]})}e.s(["default",()=>l])}]);