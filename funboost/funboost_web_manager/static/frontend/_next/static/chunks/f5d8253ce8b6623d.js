(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,3812,e=>{"use strict";var t=e.i(43476),r=e.i(7670);function s({className:e,...s}){return(0,t.jsx)("input",{className:(0,r.default)("w-full rounded-2xl border border-[hsl(var(--line))] bg-[hsl(var(--card))]/80 px-4 py-2 text-sm text-[hsl(var(--ink))] shadow-sm outline-none transition placeholder:text-[hsl(var(--ink-muted))] focus:border-[hsl(var(--accent))] focus:ring-2 focus:ring-[hsl(var(--accent))]/20",e),...s})}e.s(["Input",()=>s])},39964,e=>{"use strict";var t=e.i(43476),r=e.i(7670);function s({glass:e=!0,className:s,...a}){return(0,t.jsx)("div",{className:(0,r.default)("rounded-3xl p-6",e?"glass-card":"bg-[hsl(var(--card))] border border-[hsl(var(--line))]",s),...a})}e.s(["Card",()=>s])},7670,e=>{"use strict";e.s(["default",0,function(){for(var e,t,r=0,s="",a=arguments.length;r<a;r++)(e=arguments[r])&&(t=function e(t){var r,s,a="";if("string"==typeof t||"number"==typeof t)a+=t;else if("object"==typeof t)if(Array.isArray(t)){var n=t.length;for(r=0;r<n;r++)t[r]&&(s=e(t[r]))&&(a&&(a+=" "),a+=s)}else for(s in t)t[s]&&(a&&(a+=" "),a+=s);return a}(e))&&(s&&(s+=" "),s+=t);return s}])},59544,e=>{"use strict";var t=e.i(43476),r=e.i(7670);let s={primary:"bg-[hsl(var(--accent))] text-white hover:bg-[hsl(var(--accent-2))]",secondary:"bg-[hsl(var(--accent-2))] text-white hover:bg-[hsl(var(--accent))]",outline:"border border-[hsl(var(--line))] text-[hsl(var(--ink))] hover:border-[hsl(var(--accent))] hover:text-[hsl(var(--accent))]",ghost:"text-[hsl(var(--ink))] hover:bg-[hsl(var(--sand-2))]",danger:"bg-[hsl(var(--danger))] text-white hover:bg-[hsl(var(--danger))]/90",success:"bg-[hsl(var(--success))] text-white hover:bg-[hsl(var(--success))]/90",warning:"bg-[hsl(var(--warning))] text-white hover:bg-[hsl(var(--warning))]/90"},a={sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-5 py-2.5 text-sm"};function n({variant:e="primary",size:n="md",className:i,...l}){return(0,t.jsx)("button",{className:(0,r.default)("inline-flex items-center justify-center gap-2 rounded-full font-medium transition-colors duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--accent))] focus-visible:ring-offset-2 focus-visible:ring-offset-[hsl(var(--sand))]",s[e],a[n],i),...l})}e.s(["Button",()=>n])},55600,e=>{"use strict";function t(e,t){let r=e.startsWith("/")?e:`/${e}`;window.location.port,t?.replace?window.location.replace(r):window.location.href=r}e.s(["navigateTo",()=>t])},9165,e=>{"use strict";var t=e.i(53956);async function r(e,s={}){let a=`${(0,t.getApiBaseUrl)()}${e}`,n=new Headers(s.headers),i=s.body;void 0!==s.json&&(n.set("Content-Type","application/json"),i=JSON.stringify(s.json));let l=await fetch(a,{...s,headers:n,body:i,credentials:"include"});if(401===l.status){try{localStorage.removeItem("user_permissions_cache"),localStorage.removeItem("current_project");let e=sessionStorage.getItem("last_401_redirect"),t=Date.now();if(e&&t-parseInt(e,10)<2e3)throw console.warn("检测到重定向循环，已阻止自动跳转"),Error("会话已过期，请刷新页面后重新登录");sessionStorage.setItem("last_401_redirect",t.toString())}catch(e){if(e instanceof Error&&e.message.includes("会话已过期"))throw e}throw window.location.href="/login",Error("未登录，请先登录")}let o=(l.headers.get("content-type")||"").includes("application/json")?await l.json():await l.text();if(!l.ok){let e=`请求失败：${l.status}`;throw"object"==typeof o&&o&&(e=o.msg||o.error||o.message||e),Error(e)}return o}async function s(e,t={}){let a=await r(e,t);if(!a.succ)throw Error(a.msg||"请求失败");return a.data}function a(e){let t=new URLSearchParams;return Object.entries(e).forEach(([e,r])=>{null!=r&&""!==r&&t.append(e,String(r))}),t.toString()}e.s(["apiFetch",()=>r,"buildQuery",()=>a,"funboostFetch",()=>s])},53956,e=>{"use strict";function t(){return""}function r(e){let t=e.startsWith("/")?e:`/${e}`;return`${t}`}e.s(["apiConfig",0,{get baseUrl(){return""},credentials:"include",defaultHeaders:{"Content-Type":"application/json"}},"buildApiUrl",()=>r,"getApiBaseUrl",()=>t])},75254,e=>{"use strict";var t=e.i(71645);let r=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},s=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,t.forwardRef)(({color:e="currentColor",size:r=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:l="",children:o,iconNode:c,...d},u)=>(0,t.createElement)("svg",{ref:u,...a,width:r,height:r,stroke:e,strokeWidth:i?24*Number(n)/Number(r):n,className:s("lucide",l),...!o&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(d)&&{"aria-hidden":"true"},...d},[...c.map(([e,r])=>(0,t.createElement)(e,r)),...Array.isArray(o)?o:[o]])),i=(e,a)=>{let i=(0,t.forwardRef)(({className:i,...l},o)=>(0,t.createElement)(n,{ref:o,iconNode:a,className:s(`lucide-${r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,i),...l}));return i.displayName=r(e),i};e.s(["default",()=>i],75254)},86536,e=>{"use strict";let t=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],86536)},78894,e=>{"use strict";let t=(0,e.i(75254).default)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["AlertTriangle",()=>t],78894)},65261,e=>{"use strict";let t=(0,e.i(75254).default)("key-round",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);e.s(["KeyRound",()=>t],65261)},3809,e=>{"use strict";let t=e.i(47167).default.env.NEXT_PUBLIC_API_BASE??"",r=null,s=0;async function a(){let e=Date.now();if(r&&e-s<18e5)return r;try{let a=await fetch(`${t}/api/public_key`,{method:"GET",credentials:"include"});if(!a.ok)throw Error(`获取公钥失败: ${a.status}`);let n=await a.json();if(!n.public_key||!n.key_id)throw Error("公钥响应格式无效");return r=n,s=e,n}catch(e){throw r=null,s=0,e}}function n(){r=null,s=0}async function i(e){let t=e.replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","");t=t.replace(/\s/g,"");let r=Uint8Array.from(atob(t),e=>e.charCodeAt(0));return await crypto.subtle.importKey("spki",r,{name:"RSA-OAEP",hash:"SHA-256"},!1,["encrypt"])}async function l(e,t){let r=await i(t),s=new TextEncoder().encode(e),a=new Uint8Array(await crypto.subtle.encrypt({name:"RSA-OAEP"},r,s)),n="";for(let e=0;e<a.length;e++)n+=String.fromCharCode(a[e]);return btoa(n)}function o(){return"undefined"!=typeof crypto&&void 0!==crypto.subtle&&"function"==typeof crypto.subtle.encrypt}async function c(e){if(!o())return console.warn("Web Crypto API 不可用，将使用明文密码"),e;try{n();let t=await a(),r=await l(e,t.public_key);return{encrypted:!0,data:r,key_id:t.key_id}}catch(e){throw console.error("密码加密失败:",e),Error("密码加密失败，请刷新页面重试")}}async function d(e){if(!o())return console.warn("Web Crypto API 不可用，将使用明文密码"),e;try{n();let t=await a(),r={};for(let[s,a]of Object.entries(e)){let e=await l(a,t.public_key);r[s]={encrypted:!0,data:e,key_id:t.key_id}}return r}catch(e){throw console.error("密码加密失败:",e),Error("密码加密失败，请刷新页面重试")}}e.s(["preparePassword",()=>c,"preparePasswords",()=>d])},77705,e=>{"use strict";let t=(0,e.i(75254).default)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);e.s(["EyeOff",()=>t],77705)},33703,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(65261),a=e.i(86536),n=e.i(77705);let i=(0,e.i(75254).default)("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var l=e.i(78894),o=e.i(59544),c=e.i(39964),d=e.i(3812),u=e.i(9165),h=e.i(3809),p=e.i(55600);function f(){let[e,f]=(0,r.useState)(""),[m,x]=(0,r.useState)(""),[v,y]=(0,r.useState)(""),[g,w]=(0,r.useState)(!1),[b,j]=(0,r.useState)(!1),[k,N]=(0,r.useState)(!1),[E,C]=(0,r.useState)(null),[A,S]=(0,r.useState)(!1),[_,I]=(0,r.useState)(!1),T=async t=>{if(t.preventDefault(),C(null),!e||!m||!v)return void C("所有字段都是必填的");if(m!==v)return void C("两次输入的新密码不一致");if(m.length<8)return void C("新密码长度至少8位");S(!0);try{let t;try{t=await (0,h.preparePasswords)({current_password:e,new_password:m,confirm_password:v})}catch(e){C(e instanceof Error?e.message:"密码加密失败"),S(!1);return}let r=await (0,u.apiFetch)("/api/force_change_password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.success)throw Error(r.error||"修改失败");I(!0),setTimeout(()=>{(0,p.navigateTo)(r.redirect||"/queue-op")},1500)}catch(e){C(e instanceof Error?e.message:"修改失败，请稍后重试")}finally{S(!1)}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"inline-flex items-center justify-center w-14 h-14 rounded-2xl bg-[hsl(var(--warning))]/15 text-[hsl(var(--warning))] mb-4",children:(0,t.jsx)(s.KeyRound,{className:"h-7 w-7"})}),(0,t.jsx)("h2",{className:"font-display text-xl text-[hsl(var(--ink))]",children:"修改密码"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-[hsl(var(--ink-muted))]",children:"安全策略要求您修改密码"})]}),(0,t.jsx)(c.Card,{className:"border-[hsl(var(--warning))]/30 bg-[hsl(var(--warning))]/5 p-4",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(l.AlertTriangle,{className:"h-5 w-5 text-[hsl(var(--warning))] flex-shrink-0"}),(0,t.jsxs)("div",{className:"text-xs text-[hsl(var(--ink-muted))]",children:[(0,t.jsx)("p",{className:"font-semibold text-[hsl(var(--warning))] mb-1",children:"密码要求"}),(0,t.jsxs)("ul",{className:"space-y-0.5 list-disc list-inside",children:[(0,t.jsx)("li",{children:"至少8个字符"}),(0,t.jsx)("li",{children:"包含大小写字母和数字"}),(0,t.jsx)("li",{children:"包含特殊字符（如 @#$%）"})]})]})]})}),_?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"inline-flex items-center justify-center w-14 h-14 rounded-full bg-[hsl(var(--success))]/15 text-[hsl(var(--success))] mb-4",children:(0,t.jsx)(i,{className:"h-7 w-7"})}),(0,t.jsx)("h3",{className:"font-display text-lg text-[hsl(var(--ink))]",children:"密码修改成功"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-[hsl(var(--ink-muted))]",children:"正在跳转..."})]}):(0,t.jsxs)("form",{className:"space-y-4",onSubmit:T,children:[E&&(0,t.jsx)("div",{className:"rounded-xl border border-[hsl(var(--danger))]/30 bg-[hsl(var(--danger))]/10 px-4 py-3 text-sm text-[hsl(var(--danger))]",children:E}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:"当前密码"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(d.Input,{type:g?"text":"password",value:e,onChange:e=>f(e.target.value),placeholder:"请输入当前密码",required:!0}),(0,t.jsx)("button",{type:"button",onClick:()=>w(!g),className:"absolute right-3 top-1/2 -translate-y-1/2 text-[hsl(var(--ink-muted))] hover:text-[hsl(var(--ink))] transition-colors cursor-pointer",children:g?(0,t.jsx)(n.EyeOff,{className:"h-4 w-4"}):(0,t.jsx)(a.Eye,{className:"h-4 w-4"})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:"新密码"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(d.Input,{type:b?"text":"password",value:m,onChange:e=>x(e.target.value),placeholder:"请输入新密码",required:!0}),(0,t.jsx)("button",{type:"button",onClick:()=>j(!b),className:"absolute right-3 top-1/2 -translate-y-1/2 text-[hsl(var(--ink-muted))] hover:text-[hsl(var(--ink))] transition-colors cursor-pointer",children:b?(0,t.jsx)(n.EyeOff,{className:"h-4 w-4"}):(0,t.jsx)(a.Eye,{className:"h-4 w-4"})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-[hsl(var(--ink-muted))]",children:"确认新密码"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(d.Input,{type:k?"text":"password",value:v,onChange:e=>y(e.target.value),placeholder:"请再次输入新密码",required:!0}),(0,t.jsx)("button",{type:"button",onClick:()=>N(!k),className:"absolute right-3 top-1/2 -translate-y-1/2 text-[hsl(var(--ink-muted))] hover:text-[hsl(var(--ink))] transition-colors cursor-pointer",children:k?(0,t.jsx)(n.EyeOff,{className:"h-4 w-4"}):(0,t.jsx)(a.Eye,{className:"h-4 w-4"})})]})]}),(0,t.jsx)(o.Button,{type:"submit",className:"w-full cursor-pointer",disabled:A,children:A?"正在保存...":"确认修改密码"})]}),!_&&(0,t.jsx)("div",{className:"text-center text-xs text-[hsl(var(--ink-muted))]",children:(0,t.jsx)("a",{className:"font-semibold text-[hsl(var(--accent-2))] hover:underline cursor-pointer",href:"/login",children:"返回登录"})})]})}e.s(["default",()=>f],33703)}]);