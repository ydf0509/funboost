# 统一响应格式说明

## 概述

所有 `funboost_router_for_webs` 接口已统一使用以下响应格式：

```json
{
    "succ": true/false,
    "msg": "消息内容",
    "data": {
        // 具体数据字段
    }
}
```

## 响应格式详解

### 公共字段

| 字段 | 类型 | 说明 |
|------|------|------|
| succ | bool | 请求是否成功 |
| msg | str | 响应消息，描述操作结果或错误信息 |
| data | object/null | 具体的响应数据，失败时可能为 null |

### 各接口的 data 字段

#### 1. POST `/funboost/publish` - 发布消息

**成功响应示例：**
```json
{
    "succ": true,
    "msg": "test_queue 队列,消息发布成功",
    "data": {
        "task_id": "abc123...",
        "status_and_result": null  // 或具体结果（RPC模式）
    }
}
```

**失败响应示例：**
```json
{
    "succ": false,
    "msg": "消息发布失败 ...",
    "data": {
        "task_id": null,
        "status_and_result": null
    }
}
```

**data 字段说明：**
- `task_id`: 任务 ID
- `status_and_result`: RPC 模式下的任务执行结果

#### 2. GET `/funboost/get_result` - 获取任务结果

**成功响应示例：**
```json
{
    "succ": true,
    "msg": "获取成功",
    "data": {
        "task_id": "abc123...",
        "status_and_result": {
            "task_id": "abc123...",
            "result": 100,
            "success": true
        }
    }
}
```

**失败响应示例：**
```json
{
    "succ": false,
    "msg": "未获取到结果(可能已过期或未开始执行或超时)",
    "data": {
        "task_id": "abc123...",
        "status_and_result": null
    }
}
```

**data 字段说明：**
- `task_id`: 任务 ID
- `status_and_result`: 任务执行的状态和结果

#### 3. GET `/funboost/get_msg_count` - 获取消息数量

**成功响应示例：**
```json
{
    "succ": true,
    "msg": "获取成功",
    "data": {
        "queue_name": "test_queue",
        "count": 42
    }
}
```

**失败响应示例：**
```json
{
    "succ": false,
    "msg": "获取消息数量失败: ...",
    "data": {
        "queue_name": "test_queue",
        "count": -1
    }
}
```

**data 字段说明：**
- `queue_name`: 队列名称
- `count`: 消息数量，失败时为 -1

#### 4. GET `/funboost/get_all_queues` - 获取所有队列

**成功响应示例：**
```json
{
    "succ": true,
    "msg": "获取成功",
    "data": {
        "queues": ["queue1", "queue2", "queue3"],
        "count": 3
    }
}
```

**失败响应示例：**
```json
{
    "succ": false,
    "msg": "获取所有队列失败: ...",
    "data": {
        "queues": [],
        "count": 0
    }
}
```

**data 字段说明：**
- `queues`: 所有队列名称的列表
- `count`: 队列总数

## 使用示例

### Python 示例

```python
import requests

# 调用接口
response = requests.get("http://127.0.0.1:5000/funboost/get_all_queues")
result = response.json()

# 检查是否成功
if result['succ']:
    # 访问数据
    data = result['data']
    print(f"共有 {data['count']} 个队列")
    for queue_name in data['queues']:
        print(f"  - {queue_name}")
else:
    print(f"请求失败: {result['msg']}")
```

### JavaScript/TypeScript 示例

```javascript
// 调用接口
const response = await fetch('http://127.0.0.1:5000/funboost/get_all_queues');
const result = await response.json();

// 检查是否成功
if (result.succ) {
    // 访问数据
    const { queues, count } = result.data;
    console.log(`共有 ${count} 个队列`);
    queues.forEach(queueName => {
        console.log(`  - ${queueName}`);
    });
} else {
    console.error(`请求失败: ${result.msg}`);
}
```

### TypeScript 类型定义

```typescript
// 基础响应类型
interface BaseResponse<T> {
    succ: boolean;
    msg: string;
    data: T | null;
}

// 发布消息响应
interface PublishData {
    task_id: string | null;
    status_and_result: any | null;
}
type PublishResponse = BaseResponse<PublishData>;

// 获取消息数量响应
interface CountData {
    queue_name: string;
    count: number;
}
type CountResponse = BaseResponse<CountData>;

// 获取所有队列响应
interface AllQueuesData {
    queues: string[];
    count: number;
}
type AllQueuesResponse = BaseResponse<AllQueuesData>;
```

## 优势

采用统一的 `{"succ":xx,"msg":xx,"data":{...}}` 格式有以下优势：

1. **结构清晰**：业务数据统一放在 `data` 字段中，与元数据分离
2. **易于解析**：前端可以统一处理响应格式
3. **类型安全**：更容易定义 TypeScript 类型
4. **扩展性好**：未来可以在顶层添加其他元数据字段（如 `timestamp`、`request_id` 等）
5. **一致性强**：所有接口使用相同的格式，降低学习成本

## 迁移指南

如果你之前使用的是旧版本（数据字段直接在顶层），需要进行以下调整：

### 旧版本
```python
result = response.json()
queues = result['queues']  # 直接访问
count = result['count']
```

### 新版本
```python
result = response.json()
queues = result['data']['queues']  # 通过 data 访问
count = result['data']['count']
```

## 框架支持

所有三个 Web 框架版本都已更新为统一格式：

- ✅ Flask (`flask_funboost_router.py`)
- ✅ FastAPI (`fastapi_funboost_router.py`)
- ✅ Django Ninja (`django_ninja_funboost_router.py`)

## 总结

统一的响应格式让 API 更加规范和易用，建议所有新项目都采用这种格式。如果你有任何问题或建议，欢迎反馈！
